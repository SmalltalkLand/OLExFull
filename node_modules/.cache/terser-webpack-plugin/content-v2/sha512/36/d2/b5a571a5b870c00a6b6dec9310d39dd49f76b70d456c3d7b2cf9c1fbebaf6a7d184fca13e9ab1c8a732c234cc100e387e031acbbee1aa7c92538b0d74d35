{"code":"!function(t){var e={};function i(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var r in t)i.d(o,r,function(e){return t[e]}.bind(null,r));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,\"a\",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p=\"\",i(i.s=1)}([function(module,__webpack_exports__,__webpack_require__){\"use strict\";__webpack_require__.d(__webpack_exports__,\"a\",(function(){return Color})),__webpack_require__.d(__webpack_exports__,\"c\",(function(){return Morph})),__webpack_require__.d(__webpack_exports__,\"e\",(function(){return WorldMorph})),__webpack_require__.d(__webpack_exports__,\"b\",(function(){return HandMorph})),__webpack_require__.d(__webpack_exports__,\"d\",(function(){return Rectangle}));var morphicVersion=\"2020-January-04\",modules={},useBlurredShadows=getBlurredShadowSupport(),standardSettings={minimumFontHeight:getMinimumFontHeight(),globalFontFamily:\"\",menuFontName:\"sans-serif\",menuFontSize:12,bubbleHelpFontSize:10,prompterFontName:\"sans-serif\",prompterFontSize:12,prompterSliderSize:10,handleSize:15,scrollBarSize:12,mouseScrollAmount:40,useSliderForInput:!1,useVirtualKeyboard:!0,isTouchDevice:!1,rasterizeSVGs:!1,isFlat:!1,grabThreshold:5},touchScreenSettings={minimumFontHeight:standardSettings.minimumFontHeight,globalFontFamily:\"\",menuFontName:\"sans-serif\",menuFontSize:24,bubbleHelpFontSize:18,prompterFontName:\"sans-serif\",prompterFontSize:24,prompterSliderSize:20,handleSize:26,scrollBarSize:24,mouseScrollAmount:40,useSliderForInput:!0,useVirtualKeyboard:!0,isTouchDevice:!1,rasterizeSVGs:!1,isFlat:!1,grabThreshold:5},MorphicPreferences=standardSettings;function nop(){return null}function localize(t){return t}function isNil(t){return null==t}function contains(t,e){return-1!==t.indexOf(e)}function detect(t,e){var i,o=t.length;for(i=0;i<o;i+=1)if(e.call(null,t[i]))return t[i];return null}function sizeOf(t){var e,i=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i+=1);return i}function isString(t){return\"string\"==typeof t||t instanceof String}function isObject(t){return null!==t&&(\"object\"==typeof t||t instanceof Object)}function radians(t){return t*Math.PI/180}function degrees(t){return 180*t/Math.PI}function fontHeight(t){return 1.2*Math.max(t,MorphicPreferences.minimumFontHeight)}function isWordChar(t){return t.match(/[A-zÀ-ÿ0-9]/)}function isURLChar(t){return t.match(/[A-z0-9./:?&_+%-]/)}function isURL(t){return/^https?:\\/\\//.test(t)}function newCanvas(t,e,i){var o,r;return e=e||!1,r=(t||(i?new Point(i.width,i.height):new Point(0,0))).floor(),i&&!i.dataset.morphicShare&&(i.isRetinaEnabled||!1)!==e&&r.x===i.width&&r.y===i.height?((o=i).getContext(\"2d\").clearRect(0,0,o.width,o.height),o):((o=document.createElement(\"canvas\")).width=r.x,o.height=r.y,e&&o.isRetinaEnabled&&(o.isRetinaEnabled=!1),o)}function copyCanvas(t){var e;return t&&t.width&&t.height?((e=newCanvas(new Point(t.width,t.height),!t.isRetinaEnabled)).getContext(\"2d\").drawImage(t,0,0),e):t}function getMinimumFontHeight(){var t,e,i,o,r=document.createElement(\"canvas\");for(r.width=50,r.height=50,(t=r.getContext(\"2d\")).font=\"1px serif\",e=t.measureText(\"I\").width,t.fillStyle=\"black\",t.textBaseline=\"bottom\",t.fillText(\"I\",0,50),o=0;o<50;o+=1)for(i=0;i<e;i+=1)if(0!==t.getImageData(i,o,1,1).data[3])return 50-o+1;return 0}function getBlurredShadowSupport(){var t,e,i;return(t=document.createElement(\"canvas\")).width=10,t.height=10,(i=t.getContext(\"2d\")).fillStyle=\"rgb(255, 0, 0)\",i.beginPath(),i.arc(5,5,5,0,2*Math.PI,!0),i.closePath(),i.fill(),(e=document.createElement(\"canvas\")).width=10,e.height=10,(i=e.getContext(\"2d\")).shadowBlur=10,i.shadowColor=\"rgba(0, 0, 255, 1)\",i.drawImage(t,0,0),!!i.getImageData(0,0,1,1).data[3]}function getDocumentPositionOf(t){var e,i;if(null===t)return{x:0,y:0};for(e={x:t.offsetLeft,y:t.offsetTop},i=t.offsetParent;null!==i;)e.x+=i.offsetLeft,e.y+=i.offsetTop,i!==document.body&&i!==document.documentElement&&(e.x-=i.scrollLeft,e.y-=i.scrollTop),i=i.offsetParent;return e}function copy(t){var e,i,o,r,n,s;if(\"object\"!=typeof t)return t;if(e=t.valueOf(),t!==e)return new t.constructor(e);if(t instanceof t.constructor&&t.constructor!==Object)for(i=Object.create(t.constructor.prototype),n=(r=Object.keys(t)).length,s=0;s<n;s+=1)t[o=r[s]]instanceof HTMLCanvasElement&&(t[o].dataset.morphicShare=\"true\"),i[o]=t[o];else for(o in i={},t)i[o]=t[o];return i}function enableRetinaSupport(){var t=document.createElement(\"canvas\").getContext(\"2d\"),e=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,i=Math.ceil(window.devicePixelRatio),o=HTMLCanvasElement.prototype,r=CanvasRenderingContext2D.prototype,n={drawImage:r.drawImage,getImageData:r.getImageData,width:Object.getOwnPropertyDescriptor(o,\"width\"),height:Object.getOwnPropertyDescriptor(o,\"height\"),shadowOffsetX:Object.getOwnPropertyDescriptor(r,\"shadowOffsetX\"),shadowOffsetY:Object.getOwnPropertyDescriptor(r,\"shadowOffsetY\"),shadowBlur:Object.getOwnPropertyDescriptor(r,\"shadowBlur\")};function s(t){return t.isRetinaEnabled?(i||1)/e:1}e!==i&&(Object.keys(n).some((function(t){var e=n[t];return e.hasOwnProperty(\"configurable\")&&!e.configurable}))||(o._isRetinaEnabled=!0,o._bak=n,Object.defineProperty(o,\"isRetinaEnabled\",{get:function(){return this._isRetinaEnabled},set:function(t){var e=s(this),i=this.width,o=this.height;this._isRetinaEnabled=t,s(this)!=e&&(this.width=i,this.height=o)},configurable:!0}),Object.defineProperty(o,\"width\",{get:function(){return n.width.get.call(this)/s(this)},set:function(t){try{var e,i=s(this);n.width.set.call(this,t*i),(e=this.getContext(\"2d\")).restore(),e.save(),e.scale(i,i)}catch(e){console.log(\"Retina Display Support Problem\",e),n.width.set.call(this,t)}}}),Object.defineProperty(o,\"height\",{get:function(){return n.height.get.call(this)/s(this)},set:function(t){var e,i=s(this);n.height.set.call(this,t*i),(e=this.getContext(\"2d\")).restore(),e.save(),e.scale(i,i)}}),r.drawImage=function(t){var e,i,o,r,h,a,l,p,c=s(t);switch(arguments.length){case 9:e=arguments[1],i=arguments[2],o=arguments[3],r=arguments[4],h=arguments[5],a=arguments[6],l=arguments[7],p=arguments[8];break;case 5:e=0,i=0,o=t.width,r=t.height,h=arguments[1],a=arguments[2],l=arguments[3],p=arguments[4];break;case 3:e=0,i=0,o=t.width,r=t.height,h=arguments[1],a=arguments[2],l=t.width,p=t.height;break;default:throw Error(\"Called drawImage() with \"+arguments.length+\" arguments\")}n.drawImage.call(this,t,e*c,i*c,o*c,r*c,h,a,l,p)},r.getImageData=function(t,e,i,o){var r=s(this.canvas);return n.getImageData.call(this,t*r,e*r,i*r,o*r)},Object.defineProperty(r,\"shadowOffsetX\",{get:function(){return n.shadowOffsetX.get.call(this)/s(this.canvas)},set:function(t){var e=s(this.canvas);n.shadowOffsetX.set.call(this,t*e)}}),Object.defineProperty(r,\"shadowOffsetY\",{get:function(){return n.shadowOffsetY.get.call(this)/s(this.canvas)},set:function(t){var e=s(this.canvas);n.shadowOffsetY.set.call(this,t*e)}}),Object.defineProperty(r,\"shadowBlur\",{get:function(){return n.shadowBlur.get.call(this)/s(this.canvas)},set:function(t){var e=s(this.canvas);n.shadowBlur.set.call(this,t*e)}})))}function isRetinaSupported(){var t=document.createElement(\"canvas\").getContext(\"2d\"),e=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,i=HTMLCanvasElement.prototype,o=CanvasRenderingContext2D.prototype,r={drawImage:o.drawImage,getImageData:o.getImageData,width:Object.getOwnPropertyDescriptor(i,\"width\"),height:Object.getOwnPropertyDescriptor(i,\"height\"),shadowOffsetX:Object.getOwnPropertyDescriptor(o,\"shadowOffsetX\"),shadowOffsetY:Object.getOwnPropertyDescriptor(o,\"shadowOffsetY\"),shadowBlur:Object.getOwnPropertyDescriptor(o,\"shadowBlur\")};return e!==window.devicePixelRatio&&!Object.keys(r).some((function(t){var e=r[t];return e.hasOwnProperty(\"configurable\")&&!e.configurable}))}function isRetinaEnabled(){return HTMLCanvasElement.prototype.hasOwnProperty(\"_isRetinaEnabled\")}function disableRetinaSupport(){var t,e,i;isRetinaEnabled()&&(t=HTMLCanvasElement.prototype,e=CanvasRenderingContext2D.prototype,i=t._bak,Object.defineProperty(t,\"width\",i.width),Object.defineProperty(t,\"height\",i.height),e.drawImage=i.drawImage,e.getImageData=i.getImageData,Object.defineProperty(e,\"shadowOffsetX\",i.shadowOffsetX),Object.defineProperty(e,\"shadowOffsetY\",i.shadowOffsetY),Object.defineProperty(e,\"shadowBlur\",i.shadowBlur),delete t._isRetinaEnabled,delete t.isRetinaEnabled,delete t._bak)}function normalizeCanvas(t,e){var i;return t.isRetinaEnabled?((i=newCanvas(new Point(t.width,t.height),!0)).getContext(\"2d\").drawImage(t,0,0),e?i:(t.isRetinaEnabled=!1,t.width=i.width,t.height=i.height,t.getContext(\"2d\").drawImage(i,0,0),t)):t}function Animation(t,e,i,o,r,n){this.setter=t,this.getter=e,this.delta=i||0,this.duration=o||0,this.easing=isString(r)?this.easings[r]||this.easings.sinusoidal:r||this.easings.sinusoidal,this.onComplete=n||null,this.endTime=null,this.destination=null,this.isActive=!1,this.start()}function Color(t,e,i,o){this.r=t||0,this.g=e||0,this.b=i||0,this.a=o||(0===o?0:1)}function Point(t,e){this.x=t||0,this.y=e||0}function Rectangle(t,e,i,o){this.init(new Point(t||0,e||0),new Point(i||0,o||0))}function Node(t,e){this.init(t||null,e||[])}function Morph(){this.init()}function ShadowMorph(){this.init()}function HandleMorph(t,e,i,o,r,n){this.init(t,e,i,o,r,n)}function PenMorph(){this.init()}function ColorPaletteMorph(t,e){this.init(t||null,e||new Point(80,50))}function GrayPaletteMorph(t,e){this.init(t||null,e||new Point(80,10))}function ColorPickerMorph(t){this.init(t||new Color(255,255,255))}function BlinkerMorph(t){this.init(t)}function CursorMorph(t){this.init(t)}function BoxMorph(t,e,i){this.init(t,e,i)}function SpeechBubbleMorph(t,e,i,o,r,n,s){this.init(t,e,i,o,r,n,s)}function DialMorph(t,e,i,o,r){this.init(t,e,i,o,r)}function CircleBoxMorph(t){this.init(t||\"vertical\")}function SliderButtonMorph(t){this.init(t)}function SliderMorph(t,e,i,o,r,n){this.init(t||1,e||100,i||50,o||10,r||\"vertical\",n)}function MouseSensorMorph(t,e,i){this.init(t,e,i)}function InspectorMorph(t){this.init(t)}function MenuMorph(t,e,i,o){this.init(t,e,i,o)}function StringMorph(t,e,i,o,r,n,s,h,a,l){this.init(t,e,i,o,r,n,s,h,a,l)}function TextMorph(t,e,i,o,r,n,s,h,a,l){this.init(t,e,i,o,r,n,s,h,a,l)}function TriggerMorph(t,e,i,o,r,n,s,h,a,l,p){this.init(t,e,i,o,r,n,s,h,a,l,p)}function MenuItemMorph(t,e,i,o,r,n,s,h,a,l,p,c){this.shortcutString=c||null,this.shortcut=null,this.init(t,e,i,o,r,n,s,h,a,l,p)}function FrameMorph(t){this.init(t)}function ScrollFrameMorph(t,e,i){this.init(t,e,i)}function ListMorph(t,e,i,o){this.init(t||[],e||function(t){return isString(t)?t:t.toSource?t.toSource():t.toString()},i||[],o)}function StringFieldMorph(t,e,i,o,r,n,s){this.init(t||\"\",e||100,i||12,o||\"sans-serif\",r||!1,n||!1,s)}function BouncerMorph(){this.init()}function HandMorph(t){this.init(t)}function WorldMorph(t,e){this.init(t,e)}enableRetinaSupport(),Animation.prototype.easings={linear:function(t){return t},sinusoidal:function(t){return 1-Math.cos(radians(90*t))},quadratic:function(t){return t<.5?2*t*t:(4-2*t)*t-1},cubic:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},elastic:function(t){return(t-=.5)<0?(.01+.01/t)*Math.sin(50*t):(.02-.01/t)*Math.sin(50*t)+1},sine_in:function(t){return 1-Math.sin(radians(90+90*t))},quad_in:function(t){return t*t},cubic_in:function(t){return t*t*t},elastic_in:function(t){return(.04-.04/t)*Math.sin(25*t)+1},sine_out:function(t){return Math.sin(radians(90*t))},quad_out:function(t){return t*(2-t)},elastic_out:function(t){return.04*t/--t*Math.sin(25*t)}},Animation.prototype.start=function(){this.endTime=Date.now()+this.duration,this.destination=this.getter.call(this)+this.delta,this.isActive=!0},Animation.prototype.step=function(){if(this.isActive){var t=Date.now();t>this.endTime?(this.setter(this.destination),this.isActive=!1,this.onComplete&&this.onComplete()):this.setter(this.destination-this.delta*this.easing((this.endTime-t)/this.duration))}},Color.prototype.toString=function(){return\"rgba(\"+Math.round(this.r)+\",\"+Math.round(this.g)+\",\"+Math.round(this.b)+\",\"+this.a+\")\"},Color.prototype.toRGBstring=function(){return\"rgb(\"+Math.round(this.r)+\",\"+Math.round(this.g)+\",\"+Math.round(this.b)+\")\"},Color.fromString=function(t){var e=t.split(/[\\(),]/).slice(1,5);return new Color(e[0],e[1],e[2],e[3])},Color.prototype.copy=function(){return new Color(this.r,this.g,this.b,this.a)},Color.prototype.eq=function(t,e){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b&&(!e||this.a===t.a)},Color.prototype.isCloseTo=function(t,e,i){var o=2.55*(i||10);function r(t,e){var i=t-e;return i<0?255+i:i}return t&&r(this.r,t.r)<o&&r(this.g,t.g)<o&&r(this.b,t.b)<o&&(!e||this.a===t.a)},Color.prototype.hsv=function(){var t,e,i,o,r,n,s=this.r/255,h=this.g/255,a=this.b/255;if(i=t=Math.max(s,h,a),t,r=t,n=t-(e=Math.min(s,h,a)),o=0===t?0:n/t,t===e)i=0;else{switch(t){case s:i=(h-a)/n+(h<a?6:0);break;case h:i=(a-s)/n+2;break;case a:i=(s-h)/n+4}i/=6}return[i,o,r]},Color.prototype.set_hsv=function(t,e,i){var o,r,n,s,h;switch(n=i*(1-e),s=i*(1-(r=6*t-(o=Math.floor(6*t)))*e),h=i*(1-(1-r)*e),o%6){case 0:this.r=i,this.g=h,this.b=n;break;case 1:this.r=s,this.g=i,this.b=n;break;case 2:this.r=n,this.g=i,this.b=h;break;case 3:this.r=n,this.g=s,this.b=i;break;case 4:this.r=h,this.g=n,this.b=i;break;case 5:this.r=i,this.g=n,this.b=s}this.r*=255,this.g*=255,this.b*=255},Color.prototype.hsl=function(){var t,e,i,o=this.r/255,r=this.g/255,n=this.b/255,s=Math.max(o,r,n),h=Math.min(o,r,n),a=(s+h)/2;if(s===h)t=0,e=0;else{switch(i=s-h,e=a>.5?i/(2-s-h):i/(s+h),s){case o:t=(r-n)/i+(r<n?6:0);break;case r:t=(n-o)/i+2;break;case n:t=(o-r)/i+4}t/=6}return[t,e,a]},Color.prototype.set_hsl=function(t,e,i){var o,r;function n(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}0==e?(this.r=i,this.g=i,this.b=i):(r=2*i-(o=i<.5?i*(1+e):i+e-i*e),this.r=n(r,o,t+1/3),this.g=n(r,o,t),this.b=n(r,o,t-1/3)),this.r*=255,this.g*=255,this.b*=255},Color.prototype.mixed=function(t,e){var i=Math.min(Math.max(t,0),1),o=1-i;return new Color(this.r*i+e.r*o,this.g*i+e.g*o,this.b*i+e.b*o)},Color.prototype.darker=function(t){var e=.8333;return t&&(e=(100-t)/100),this.mixed(e,new Color(0,0,0))},Color.prototype.lighter=function(t){var e=.8333;return t&&(e=(100-t)/100),this.mixed(e,new Color(255,255,255))},Color.prototype.dansDarker=function(){var t=this.hsv(),e=new Color,i=Math.max(t[2]-.16,0);return e.set_hsv(t[0],t[1],i),e},Color.prototype.inverted=function(){return new Color(255-this.r,255-this.g,255-this.b)},Point.prototype.toString=function(){return Math.round(this.x.toString())+\"@\"+Math.round(this.y.toString())},Point.prototype.copy=function(){return new Point(this.x,this.y)},Point.prototype.eq=function(t){return this.x===t.x&&this.y===t.y},Point.prototype.lt=function(t){return this.x<t.x&&this.y<t.y},Point.prototype.gt=function(t){return this.x>t.x&&this.y>t.y},Point.prototype.ge=function(t){return this.x>=t.x&&this.y>=t.y},Point.prototype.le=function(t){return this.x<=t.x&&this.y<=t.y},Point.prototype.max=function(t){return new Point(Math.max(this.x,t.x),Math.max(this.y,t.y))},Point.prototype.min=function(t){return new Point(Math.min(this.x,t.x),Math.min(this.y,t.y))},Point.prototype.round=function(){return new Point(Math.round(this.x),Math.round(this.y))},Point.prototype.abs=function(){return new Point(Math.abs(this.x),Math.abs(this.y))},Point.prototype.neg=function(){return new Point(-this.x,-this.y)},Point.prototype.mirror=function(){return new Point(this.y,this.x)},Point.prototype.floor=function(){return new Point(Math.max(Math.floor(this.x),0),Math.max(Math.floor(this.y),0))},Point.prototype.ceil=function(){return new Point(Math.ceil(this.x),Math.ceil(this.y))},Point.prototype.add=function(t){return t instanceof Point?new Point(this.x+t.x,this.y+t.y):new Point(this.x+t,this.y+t)},Point.prototype.subtract=function(t){return t instanceof Point?new Point(this.x-t.x,this.y-t.y):new Point(this.x-t,this.y-t)},Point.prototype.multiplyBy=function(t){return t instanceof Point?new Point(this.x*t.x,this.y*t.y):new Point(this.x*t,this.y*t)},Point.prototype.divideBy=function(t){return t instanceof Point?new Point(this.x/t.x,this.y/t.y):new Point(this.x/t,this.y/t)},Point.prototype.floorDivideBy=function(t){return t instanceof Point?new Point(Math.floor(this.x/t.x),Math.floor(this.y/t.y)):new Point(Math.floor(this.x/t),Math.floor(this.y/t))},Point.prototype.r=function(){var t=this.multiplyBy(this);return Math.sqrt(t.x+t.y)},Point.prototype.degrees=function(){var t,e;return 0===this.x?this.y>=0?90:270:(t=this.y/this.x,e=Math.atan(t),this.x>=0?this.y>=0?degrees(e):360+degrees(e):180+degrees(e))},Point.prototype.theta=function(){var t,e;return 0===this.x?this.y>=0?radians(90):radians(270):(t=this.y/this.x,e=Math.atan(t),this.x>=0?this.y>=0?e:radians(360)+e:radians(180)+e)},Point.prototype.crossProduct=function(t){return this.multiplyBy(t.mirror())},Point.prototype.distanceTo=function(t){return t.subtract(this).r()},Point.prototype.rotate=function(t,e){var i=this.subtract(e);return\"right\"===t?new Point(-i.y,i.y).add(e):\"left\"===t?new Point(i.y,-i.y).add(e):e.subtract(i)},Point.prototype.flip=function(t,e){return\"vertical\"===t?new Point(this.x,2*e.y-this.y):new Point(2*e.x-this.x,this.y)},Point.prototype.distanceAngle=function(t,e){var i,o,r=e;return r>270?r-=360:r<-270&&(r+=360),-90<=r&&r<=90?(i=Math.sin(radians(r))*t,o=Math.sqrt(t*t-i*i),new Point(i+this.x,this.y-o)):(i=Math.sin(radians(180-r))*t,o=Math.sqrt(t*t-i*i),new Point(i+this.x,this.y+o))},Point.prototype.scaleBy=function(t){return this.multiplyBy(t)},Point.prototype.translateBy=function(t){return this.add(t)},Point.prototype.rotateBy=function(t,e){var i=e||new Point(0,0),o=this.subtract(i),r=o.r(),n=t-o.theta();return new Point(i.x+r*Math.cos(n),i.y-r*Math.sin(n))},Point.prototype.asArray=function(){return[this.x,this.y]},Rectangle.prototype.init=function(t,e){this.origin=t,this.corner=e},Rectangle.prototype.toString=function(){return\"[\"+this.origin.toString()+\" | \"+this.extent().toString()+\"]\"},Rectangle.prototype.copy=function(){return new Rectangle(this.left(),this.top(),this.right(),this.bottom())},Point.prototype.corner=function(t){return new Rectangle(this.x,this.y,t.x,t.y)},Point.prototype.rectangle=function(t){var e,i;return e=this.min(t),i=this.max(t),new Rectangle(e.x,e.y,i.x,i.y)},Point.prototype.extent=function(t){var e=this.add(t);return new Rectangle(this.x,this.y,e.x,e.y)},Rectangle.prototype.setTo=function(t,e,i,o){this.origin=new Point(t||(0===t?0:this.left()),e||(0===e?0:this.top())),this.corner=new Point(i||(0===i?0:this.right()),o||(0===o?0:this.bottom()))},Rectangle.prototype.area=function(){var t=this.width();return t<0?0:Math.max(t*this.height(),0)},Rectangle.prototype.bottom=function(){return this.corner.y},Rectangle.prototype.bottomCenter=function(){return new Point(this.center().x,this.bottom())},Rectangle.prototype.bottomLeft=function(){return new Point(this.origin.x,this.corner.y)},Rectangle.prototype.bottomRight=function(){return this.corner.copy()},Rectangle.prototype.boundingBox=function(){return this},Rectangle.prototype.center=function(){return this.origin.add(this.corner.subtract(this.origin).floorDivideBy(2))},Rectangle.prototype.corners=function(){return[this.origin,this.bottomLeft(),this.corner,this.topRight()]},Rectangle.prototype.extent=function(){return this.corner.subtract(this.origin)},Rectangle.prototype.height=function(){return this.corner.y-this.origin.y},Rectangle.prototype.left=function(){return this.origin.x},Rectangle.prototype.leftCenter=function(){return new Point(this.left(),this.center().y)},Rectangle.prototype.right=function(){return this.corner.x},Rectangle.prototype.rightCenter=function(){return new Point(this.right(),this.center().y)},Rectangle.prototype.top=function(){return this.origin.y},Rectangle.prototype.topCenter=function(){return new Point(this.center().x,this.top())},Rectangle.prototype.topLeft=function(){return this.origin},Rectangle.prototype.topRight=function(){return new Point(this.corner.x,this.origin.y)},Rectangle.prototype.width=function(){return this.corner.x-this.origin.x},Rectangle.prototype.position=function(){return this.origin},Rectangle.prototype.eq=function(t){return this.origin.eq(t.origin)&&this.corner.eq(t.corner)},Rectangle.prototype.abs=function(){var t,e;return t=this.origin.abs(),e=this.corner.max(t),t.corner(e)},Rectangle.prototype.insetBy=function(t){var e=new Rectangle;return e.origin=this.origin.add(t),e.corner=this.corner.subtract(t),e},Rectangle.prototype.expandBy=function(t){var e=new Rectangle;return e.origin=this.origin.subtract(t),e.corner=this.corner.add(t),e},Rectangle.prototype.growBy=function(t){var e=new Rectangle;return e.origin=this.origin.copy(),e.corner=this.corner.add(t),e},Rectangle.prototype.intersect=function(t){var e=new Rectangle;return e.origin=this.origin.max(t.origin),e.corner=this.corner.min(t.corner),e},Rectangle.prototype.merge=function(t){var e=new Rectangle;return e.origin=this.origin.min(t.origin),e.corner=this.corner.max(t.corner),e},Rectangle.prototype.mergeWith=function(t){this.origin=this.origin.min(t.origin),this.corner=this.corner.max(t.corner)},Rectangle.prototype.round=function(){return this.origin.round().corner(this.corner.round())},Rectangle.prototype.spread=function(){return this.origin.floor().corner(this.corner.ceil()).expandBy(1)},Rectangle.prototype.amountToTranslateWithin=function(t){var e=0,i=0;return this.right()>t.right()&&(e=t.right()-this.right()),this.bottom()>t.bottom()&&(i=t.bottom()-this.bottom()),this.left()+e<t.left()&&(e=t.left()-this.left()),this.top()+i<t.top()&&(i=t.top()-this.top()),new Point(e,i)},Rectangle.prototype.containsPoint=function(t){return this.origin.le(t)&&t.lt(this.corner)},Rectangle.prototype.containsRectangle=function(t){return t.origin.gt(this.origin)&&t.corner.lt(this.corner)},Rectangle.prototype.intersects=function(t){var e=t.origin,i=t.corner;return i.x>=this.origin.x&&i.y>=this.origin.y&&e.x<=this.corner.x&&e.y<=this.corner.y},Rectangle.prototype.isNearTo=function(t,e){var i=t.origin,o=t.corner,r=e||0;return o.x+r>=this.origin.x&&o.y+r>=this.origin.y&&i.x-r<=this.corner.x&&i.y-r<=this.corner.y},Rectangle.prototype.scaleBy=function(t){var e=this.origin.multiplyBy(t),i=this.corner.multiplyBy(t);return new Rectangle(e.x,e.y,i.x,i.y)},Rectangle.prototype.translateBy=function(t){var e=this.origin.add(t),i=this.corner.add(t);return new Rectangle(e.x,e.y,i.x,i.y)},Rectangle.prototype.asArray=function(){return[this.left(),this.top(),this.right(),this.bottom()]},Rectangle.prototype.asArray_xywh=function(){return[this.left(),this.top(),this.width(),this.height()]},Node.prototype.init=function(t,e){this.parent=t||null,this.children=e||[]},Node.prototype.toString=function(){return\"a Node[\"+this.children.length.toString()+\"]\"},Node.prototype.addChild=function(t){this.children.push(t),t.parent=this},Node.prototype.addChildFirst=function(t){this.children.splice(0,null,t),t.parent=this},Node.prototype.removeChild=function(t){var e=this.children.indexOf(t);-1!==e&&this.children.splice(e,1)},Node.prototype.root=function(){return null===this.parent?this:this.parent.root()},Node.prototype.depth=function(){return null===this.parent?0:this.parent.depth()+1},Node.prototype.allChildren=function(){var t=[this];return this.children.forEach((function(e){t=t.concat(e.allChildren())})),t},Node.prototype.forAllChildren=function(t){this.children.length>0&&this.children.forEach((function(e){e.forAllChildren(t)})),t.call(null,this)},Node.prototype.anyChild=function(t){var e;if(t.call(null,this))return!0;for(e=0;e<this.children.length;e+=1)if(this.children[e].anyChild(t))return!0;return!1},Node.prototype.allLeafs=function(){var t=[];return this.allChildren().forEach((function(e){0===e.children.length&&t.push(e)})),t},Node.prototype.allParents=function(){var t=[this];return null!==this.parent&&(t=t.concat(this.parent.allParents())),t},Node.prototype.siblings=function(){var t=this;return null===this.parent?[]:this.parent.children.filter((function(e){return e!==t}))},Node.prototype.parentThatIsA=function(){var t;for(t=0;t<arguments.length;t+=1)if(this instanceof arguments[t])return this;return this.parent?this.parentThatIsA.apply(this.parent,arguments):null},Node.prototype.parentThatIsAnyOf=function(t){return this.parentThatIsA.apply(this,t)},Morph.prototype=new Node,Morph.prototype.constructor=Morph,Morph.uber=Node.prototype,Morph.prototype.trackChanges=!0,Morph.prototype.shadowBlur=4,Morph.prototype.init=function(t){Morph.uber.init.call(this),this.isMorph=!0,this.image=null,this.bounds=new Rectangle(0,0,50,40),this.cachedFullImage=null,this.cachedFullBounds=null,this.color=new Color(80,80,80),this.texture=null,this.cachedTexture=null,this.alpha=1,this.isVisible=!0,this.isDraggable=!1,this.isTemplate=!1,this.acceptsDrops=!1,this.noticesTransparentClick=!1,t||this.drawNew(),this.fps=0,this.customContextMenu=null,this.lastTime=Date.now(),this.onNextStep=null},Morph.prototype.toString=function(){return\"a \"+(this.constructor.name||this.constructor.toString().split(\" \")[1].split(\"(\")[0])+\" \"+this.children.length.toString()+\" \"+this.bounds},Morph.prototype.destroy=function(){null!==this.parent&&(this.fullChanged(),this.parent.removeChild(this))},Morph.prototype.stepFrame=function(){if(!this.step)return null;var t,e,i;e=(t=Date.now())-this.lastTime,(this.fps>0?1e3/this.fps-e:0)<1&&(this.lastTime=t,this.onNextStep&&(i=this.onNextStep,this.onNextStep=null,i.call(this)),this.step(),this.children.forEach((function(t){t.stepFrame()})))},Morph.prototype.nextSteps=function(t){var e=t||[],i=e.shift(),o=this;i&&(this.onNextStep=function(){i.call(o),o.nextSteps(e)})},Morph.prototype.step=nop,Morph.prototype.left=function(){return this.bounds.left()},Morph.prototype.right=function(){return this.bounds.right()},Morph.prototype.top=function(){return this.bounds.top()},Morph.prototype.bottom=function(){return this.bounds.bottom()},Morph.prototype.center=function(){return this.bounds.center()},Morph.prototype.bottomCenter=function(){return this.bounds.bottomCenter()},Morph.prototype.bottomLeft=function(){return this.bounds.bottomLeft()},Morph.prototype.bottomRight=function(){return this.bounds.bottomRight()},Morph.prototype.boundingBox=function(){return this.bounds},Morph.prototype.corners=function(){return this.bounds.corners()},Morph.prototype.leftCenter=function(){return this.bounds.leftCenter()},Morph.prototype.rightCenter=function(){return this.bounds.rightCenter()},Morph.prototype.topCenter=function(){return this.bounds.topCenter()},Morph.prototype.topLeft=function(){return this.bounds.topLeft()},Morph.prototype.topRight=function(){return this.bounds.topRight()},Morph.prototype.position=function(){return this.bounds.origin},Morph.prototype.extent=function(){return this.bounds.extent()},Morph.prototype.width=function(){return this.bounds.width()},Morph.prototype.height=function(){return this.bounds.height()},Morph.prototype.fullBounds=function(){var t;return t=this.bounds,this.children.forEach((function(e){e.isVisible&&(t=t.merge(e.fullBounds()))})),t},Morph.prototype.fullBoundsNoShadow=function(){var t;return t=this.bounds,this.children.forEach((function(e){e instanceof ShadowMorph||!e.isVisible||(t=t.merge(e.fullBounds()))})),t},Morph.prototype.visibleBounds=function(){var t=this.bounds;return this.allParents().filter((function(t){return t instanceof FrameMorph})).forEach((function(e){t=t.intersect(e.bounds)})),t},Morph.prototype.moveBy=function(t){this.fullChanged(),this.silentMoveBy(t),this.fullChanged()},Morph.prototype.silentMoveBy=function(t){var e=this.children,i=e.length;for(this.bounds=this.bounds.translateBy(t),this.cachedFullBounds&&(this.cachedFullBounds=this.cachedFullBounds.translateBy(t));i>0;i-=1)e[i-1].silentMoveBy(t)},Morph.prototype.setPosition=function(t){var e=t.subtract(this.topLeft());0===e.x&&0===e.y||this.moveBy(e)},Morph.prototype.silentSetPosition=function(t){var e=t.subtract(this.topLeft());0===e.x&&0===e.y||this.silentMoveBy(e)},Morph.prototype.setLeft=function(t){this.setPosition(new Point(t,this.top()))},Morph.prototype.setRight=function(t){this.setPosition(new Point(t-this.width(),this.top()))},Morph.prototype.setTop=function(t){this.setPosition(new Point(this.left(),t))},Morph.prototype.setBottom=function(t){this.setPosition(new Point(this.left(),t-this.height()))},Morph.prototype.setCenter=function(t){this.setPosition(t.subtract(this.extent().floorDivideBy(2)))},Morph.prototype.setFullCenter=function(t){this.setPosition(t.subtract(this.fullBounds().extent().floorDivideBy(2)))},Morph.prototype.keepWithin=function(t){var e,i,o,r;(i=this.fullBounds().right()-t.right())>0&&this.moveBy(new Point(-i,0)),(e=this.fullBounds().left()-t.left())<0&&this.moveBy(new Point(-e,0)),(r=this.fullBounds().bottom()-t.bottom())>0&&this.moveBy(new Point(0,-r)),(o=this.fullBounds().top()-t.top())<0&&this.moveBy(new Point(0,-o))},Morph.prototype.scrollIntoView=function(){var t,e,i,o,r=this.parentThatIsA(ScrollFrameMorph);r&&((e=Math.min(this.fullBounds().right()-r.right(),r.contents.right()-r.right()))>0&&r.contents.moveBy(new Point(-e,0)),(t=this.fullBounds().left()-r.left())<0&&r.contents.moveBy(new Point(-t,0)),(i=this.fullBounds().top()-r.top())<0&&r.contents.moveBy(new Point(0,-i)),(o=this.fullBounds().bottom()-r.bottom())>0&&r.contents.moveBy(new Point(0,-o)),r.adjustScrollBars())},Morph.prototype.setExtent=function(t,e){e?this.silentSetExtent(t):t.eq(this.extent())||(this.changed(),this.silentSetExtent(t),this.changed(),this.drawNew())},Morph.prototype.silentSetExtent=function(t){var e,i,o;e=t.round(),i=Math.max(e.x,0),o=Math.max(e.y,0),this.bounds.corner=new Point(this.bounds.origin.x+i,this.bounds.origin.y+o)},Morph.prototype.setWidth=function(t){this.setExtent(new Point(t||0,this.height()))},Morph.prototype.silentSetWidth=function(t){var e=Math.max(Math.round(t||0),0);this.bounds.corner=new Point(this.bounds.origin.x+e,this.bounds.corner.y)},Morph.prototype.setHeight=function(t){this.setExtent(new Point(this.width(),t||0))},Morph.prototype.silentSetHeight=function(t){var e=Math.max(Math.round(t||0),0);this.bounds.corner=new Point(this.bounds.corner.x,this.bounds.origin.y+e)},Morph.prototype.setColor=function(t){t&&(this.color.eq(t)||(this.color=t,this.changed(),this.drawNew()))},Morph.prototype.drawNew=function(){this.image=newCanvas(this.extent(),!1,this.image);var t=this.image.getContext(\"2d\");t.fillStyle=this.color.toString(),t.fillRect(0,0,this.width(),this.height()),this.cachedTexture?this.drawCachedTexture():this.texture&&this.drawTexture(this.texture)},Morph.prototype.drawTexture=function(t){var e=this;this.cachedTexture=new Image,this.cachedTexture.onload=function(){e.drawCachedTexture()},this.cachedTexture.src=this.texture=t},Morph.prototype.drawCachedTexture=function(){var t,e,i=this.cachedTexture,o=Math.floor(this.image.width/i.width),r=Math.floor(this.image.height/i.height),n=this.image.getContext(\"2d\");for(e=0;e<=r;e+=1)for(t=0;t<=o;t+=1)n.drawImage(i,t*i.width,e*i.height);this.changed()},Morph.prototype.drawOn=function(t,e){var i,o,r,n,s,h,a,l,p=this.cachedFullImage||this.image,c=this.cachedFullBounds||this.bounds;if(!this.isVisible)return null;if((i=(e||c).intersect(c)).extent().gt(new Point(0,0))){if(o=c.position().neg(),r=i.copy().translateBy(o),(n=t.getContext(\"2d\")).globalAlpha=this.alpha,a=r.left(),l=r.top(),s=Math.min(r.width(),p.width-a),h=Math.min(r.height(),p.height-l),s<1||h<1)return null;n.drawImage(p,a,l,s,h,i.left(),i.top(),s,h)}},Morph.prototype.fullDrawOn=function(t,e){var i;if(!this.isVisible)return null;i=e||this.cachedFullBounds||this.fullBounds(),this.drawOn(t,i),this.cachedFullImage||this.children.forEach((function(e){e.fullDrawOn(t,i)}))},Morph.prototype.hide=function(){this.isVisible=!1,this.changed(),this.children.forEach((function(t){t.hide()}))},Morph.prototype.show=function(){this.isVisible=!0,this.changed(),this.children.forEach((function(t){t.show()}))},Morph.prototype.toggleVisibility=function(){this.isVisible=!this.isVisible,this.changed(),this.children.forEach((function(t){t.toggleVisibility()}))},Morph.prototype.fullImageClassic=function(){var t=this.cachedFullBounds||this.fullBounds(),e=newCanvas(t.extent());return e.getContext(\"2d\").translate(-t.origin.x,-t.origin.y),this.fullDrawOn(e,t),e.globalAlpha=this.alpha,e},Morph.prototype.fullImage=function(){var t,e,i;return t=newCanvas(this.fullBounds().extent()),e=t.getContext(\"2d\"),i=this.fullBounds(),this.allChildren().forEach((function(t){t.isVisible&&(e.globalAlpha=t.alpha,t.image.width&&t.image.height&&e.drawImage(t.image,t.bounds.origin.x-i.origin.x,t.bounds.origin.y-i.origin.y))})),t},Morph.prototype.shadowImage=function(t,e){var i,o,r,n,s,h=t||new Point(7,7),a=e||new Color(0,0,0);return i=this.fullBounds().extent(),o=this.fullImage(),(s=(r=newCanvas(i)).getContext(\"2d\")).drawImage(o,0,0),s.globalCompositeOperation=\"destination-out\",s.drawImage(o,-h.x,-h.y),(s=(n=newCanvas(i)).getContext(\"2d\")).drawImage(r,0,0),s.globalCompositeOperation=\"source-atop\",s.fillStyle=a.toString(),s.fillRect(0,0,i.x,i.y),n},Morph.prototype.shadowImageBlurred=function(t,e){var i,o,r,n,s=t||new Point(7,7),h=this.shadowBlur,a=e||new Color(0,0,0);return i=this.fullBounds().extent().add(2*h),o=this.fullImage(),(n=(r=newCanvas(i)).getContext(\"2d\")).shadowOffsetX=s.x,n.shadowOffsetY=s.y,n.shadowBlur=h,n.shadowColor=a.toString(),n.drawImage(o,h-s.x,h-s.y),n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=0,n.globalCompositeOperation=\"destination-out\",n.drawImage(o,h-s.x,h-s.y),r},Morph.prototype.shadow=function(t,e,i){var o=new ShadowMorph,r=t||new Point(7,7),n=e||(0===e?0:.2),s=this.fullBounds();return o.setExtent(s.extent().add(2*this.shadowBlur)),useBlurredShadows&&!MorphicPreferences.isFlat?(o.image=this.shadowImageBlurred(r,i),o.alpha=n,o.setPosition(s.origin.add(r).subtract(this.shadowBlur))):(o.image=this.shadowImage(r,i),o.alpha=n,o.setPosition(s.origin.add(r))),o},Morph.prototype.addShadow=function(t,e,i){var o,r=t||new Point(7,7),n=e||(0===e?0:.2);return o=this.shadow(r,n,i),this.addBack(o),this.fullChanged(),o},Morph.prototype.getShadow=function(){var t;return 0!==(t=this.children.slice(0).reverse().filter((function(t){return t instanceof ShadowMorph}))).length?t[0]:null},Morph.prototype.removeShadow=function(){var t=this.getShadow();null!==t&&(this.fullChanged(),this.removeChild(t))},Morph.prototype.penTrails=function(){return this.image},Morph.prototype.changed=function(){if(this.trackChanges){var t=this.root();t instanceof WorldMorph&&t.broken.push(this.visibleBounds().spread())}this.parent&&this.parent.childChanged(this)},Morph.prototype.fullChanged=function(){if(this.trackChanges){var t=this.root();t instanceof WorldMorph&&t.broken.push((this.cachedFullBounds||this.fullBounds()).spread())}},Morph.prototype.childChanged=function(){this.parent&&this.parent.childChanged(this)},Morph.prototype.world=function(){var t=this.root();return t instanceof WorldMorph?t:t instanceof HandMorph?t.world:null},Morph.prototype.add=function(t){var e=t.parent;null!==e&&e.removeChild(t),this.addChild(t)},Morph.prototype.addBack=function(t){var e=t.parent;null!==e&&e.removeChild(t),this.addChildFirst(t)},Morph.prototype.topMorphAt=function(t){var e,i;if(!this.isVisible)return null;for(e=this.children.length-1;e>=0;e-=1)if(i=this.children[e].topMorphAt(t))return i;return!this.bounds.containsPoint(t)||!this.noticesTransparentClick&&this.isTransparentAt(t)?null:this},Morph.prototype.topMorphSuchThat=function(t){var e;return t.call(null,this)?(e=detect(this.children.slice(0).reverse(),t))?e.topMorphSuchThat(t):this:null},Morph.prototype.overlappedMorphs=function(){var t=this.world(),e=this.fullBounds(),i=this,o=this.allParents(),r=this.allChildren();return t.allChildren().filter((function(n){return n.isVisible&&n!==i&&n!==t&&!contains(o,n)&&!contains(r,n)&&n.fullBounds().intersects(e)}))},Morph.prototype.getPixelColor=function(t){var e,i;return e=t.subtract(this.bounds.origin),new Color((i=this.image.getContext(\"2d\").getImageData(e.x,e.y,1,1)).data[0],i.data[1],i.data[2],i.data[3]/255)},Morph.prototype.isTransparentAt=function(t){var e;return!!this.bounds.containsPoint(t)&&(!this.texture&&(e=t.subtract(this.bounds.origin),0===this.image.getContext(\"2d\").getImageData(Math.floor(e.x),Math.floor(e.y),1,1).data[3]))},Morph.prototype.copy=function(){var t=copy(this);return t.parent=null,t.children=[],t.bounds=this.bounds.copy(),t},Morph.prototype.fullCopy=function(){var t,e=new Map;return(t=this.copyRecordingReferences(e)).forAllChildren((function(t){t.updateReferences(e)})),t},Morph.prototype.copyRecordingReferences=function(t){var e=this.copy();return t.set(this,e),this.children.forEach((function(i){e.add(i.copyRecordingReferences(t))})),e},Morph.prototype.updateReferences=function(t){var e,i,o,r,n=Object.keys(this),s=n.length;for(r=0;r<s;r+=1)(i=this[e=n[r]])&&i.isMorph&&(o=t.get(i))&&(this[e]=o)},Morph.prototype.rootForGrab=function(){return this instanceof ShadowMorph?this.parent.rootForGrab():this.parent instanceof ScrollFrameMorph?this.parent:null===this.parent||this.parent instanceof WorldMorph||this.parent instanceof FrameMorph||!0===this.isDraggable?this:this.parent.rootForGrab()},Morph.prototype.isCorrectingOutsideDrag=function(){return!0},Morph.prototype.wantsDropOf=function(t){return!(t instanceof HandleMorph||t instanceof MenuMorph||t instanceof InspectorMorph)&&this.acceptsDrops},Morph.prototype.pickUp=function(t){var e=t||this.world();this.setPosition(e.hand.position().subtract(this.extent().floorDivideBy(2))),e.hand.grab(this)},Morph.prototype.isPickedUp=function(){return null!==this.parentThatIsA(HandMorph)},Morph.prototype.situation=function(){return this.parent?{origin:this.parent,position:this.position().subtract(this.parent.position())}:null},Morph.prototype.slideBackTo=function(t,e,i,o){var r=t.origin.position().add(t.position),n=this;this.glideTo(r,e,null,(function(){t.origin.add(n),i&&i(),n.justDropped&&n.justDropped(),t.origin.reactToDropOf&&t.origin.reactToDropOf(n),o&&o()}))},Morph.prototype.glideTo=function(t,e,i,o){var r=this.world(),n=this,s=new Animation((function(t){n.setLeft(t)}),(function(){return n.left()}),-(this.left()-t.x),e||100,i);r.animations.push(s),r.animations.push(new Animation((function(t){n.setTop(t)}),(function(){return n.top()}),-(this.top()-t.y),e||100,i,(function(){s.setter(s.destination),s.isActive=!1,o()})))},Morph.prototype.fadeTo=function(t,e,i,o){var r=this.world(),n=this,s=this.alpha;this.children.forEach((function(o){o.fadeTo(t,e,i)})),r.animations.push(new Animation((function(t){n.alpha=t,n.changed()}),(function(){return n.alpha}),t-this.alpha,e||200,i,(function(){n.alpha=s,o&&o()})))},Morph.prototype.perish=function(t,e){var i=this;this.fadeTo(0,t||100,null,(function(){i.destroy(),e&&e()}))},Morph.prototype.nop=nop,Morph.prototype.resize=function(){this.world().activeHandle=new HandleMorph(this)},Morph.prototype.move=function(){this.world().activeHandle=new HandleMorph(this,null,null,null,null,\"move\")},Morph.prototype.moveCenter=function(){this.world().activeHandle=new HandleMorph(this,null,null,null,null,\"moveCenter\")},Morph.prototype.hint=function(t){var e,i;i=t,t?t.toString&&(i=t.toString()):i=\"NULL\",(e=new MenuMorph(this,i)).isDraggable=!0,e.popUpCenteredAtHand(this.world())},Morph.prototype.inform=function(t){var e,i;i=t,t?t.toString&&(i=t.toString()):i=\"NULL\",(e=new MenuMorph(this,i)).addItem(\"Ok\"),e.isDraggable=!0,e.popUpCenteredAtHand(this.world())},Morph.prototype.prompt=function(t,e,i,o,r,n,s,h){var a,l,p,c;s&&(c=!0),a=new MenuMorph(e||null,t||\"\",i||null),l=new StringFieldMorph(o||\"\",r||100,MorphicPreferences.prompterFontSize,MorphicPreferences.prompterFontName,!1,!1,c),a.items.push(l),(s||MorphicPreferences.useSliderForInput)&&((p=new SliderMorph(n||0,s,parseFloat(o),Math.floor((s-n)/4),\"horizontal\")).alpha=1,p.color=new Color(225,225,225),p.button.color=a.borderColor,p.button.highlightColor=p.button.color.copy(),p.button.highlightColor.b+=100,p.button.pressColor=p.button.color.copy(),p.button.pressColor.b+=150,p.setHeight(MorphicPreferences.prompterSliderSize),p.action=h?function(t){l.changed(),l.text.text=Math.round(t).toString(),l.text.drawNew(),l.text.changed(),l.text.edit()}:function(t){l.changed(),l.text.text=t.toString(),l.text.drawNew(),l.text.changed()},a.items.push(p)),a.addLine(2),a.addItem(\"Ok\",(function(){return l.string()})),a.addItem(\"Cancel\",(function(){return null})),a.isDraggable=!0,a.popUpAtHand(this.world()),l.text.edit()},Morph.prototype.pickColor=function(t,e,i,o){var r,n;r=new MenuMorph(e||null,t||\"\",i||null),n=new ColorPickerMorph(o),r.items.push(n),r.addLine(2),r.addItem(\"Ok\",(function(){return n.getChoice()})),r.addItem(\"Cancel\",(function(){return null})),r.isDraggable=!0,r.popUpAtHand(this.world())},Morph.prototype.inspect=function(t){var e,i=this.world instanceof Function?this.world():this.root()||this.world,o=this;t&&(o=t),(e=new InspectorMorph(o)).setPosition(i.hand.position()),e.keepWithin(i),i.add(e),e.changed()},Morph.prototype.contextMenu=function(){var t;return this.customContextMenu?this.customContextMenu:(t=this.world instanceof Function?this.world():this.world)&&t.isDevMode?this.parent===t?this.developersMenu():this.hierarchyMenu():this.userMenu()||this.parent&&this.parent.userMenu()},Morph.prototype.hierarchyMenu=function(){var t=this.allParents(),e=this.world instanceof Function?this.world():this.world,i=new MenuMorph(this,null);return t.forEach((function(t){t.developersMenu&&t!==e&&i.addMenu(t.toString().slice(0,50),t.developersMenu())})),i},Morph.prototype.developersMenu=function(){var t=this.world instanceof Function?this.world():this.world,e=this.userMenu()||this.parent&&this.parent.userMenu(),i=new MenuMorph(this,this.constructor.name||this.constructor.toString().split(\" \")[1].split(\"(\")[0]);return e&&(i.addMenu(\"user features\",e),i.addLine()),i.addItem(\"color...\",(function(){this.pickColor(i.title+localize(\"\\ncolor:\"),this.setColor,this,this.color)}),\"choose another color \\nfor this morph\"),i.addItem(\"transparency...\",(function(){this.prompt(i.title+localize(\"\\nalpha\\nvalue:\"),this.setAlphaScaled,this,(100*this.alpha).toString(),null,1,100,!0)}),\"set this morph's\\nalpha value\"),i.addItem(\"resize...\",\"resize\",\"show a handle\\nwhich can be dragged\\nto change this morph's extent\"),i.addLine(),i.addItem(\"duplicate\",(function(){this.fullCopy().pickUp(this.world())}),\"make a copy\\nand pick it up\"),i.addItem(\"pick up\",\"pickUp\",\"detach and put \\ninto the hand\"),i.addItem(\"attach...\",\"attach\",\"stick this morph\\nto another one\"),i.addItem(\"move...\",\"move\",\"show a handle\\nwhich can be dragged\\nto move this morph\"),i.addItem(\"inspect...\",\"inspect\",\"open a window\\non all properties\"),i.addItem(\"pic...\",(function(){window.open(this.fullImageClassic().toDataURL())}),\"open a new window\\nwith a picture of this morph\"),i.addLine(),this.isDraggable?i.addItem(\"lock\",\"toggleIsDraggable\",\"make this morph\\nunmovable\"):i.addItem(\"unlock\",\"toggleIsDraggable\",\"make this morph\\nmovable\"),i.addItem(\"hide\",\"hide\"),i.addItem(\"delete\",\"destroy\"),this instanceof WorldMorph||(i.addLine(),i.addItem(\"World...\",(function(){t.contextMenu().popUpAtHand(t)}),\"show the\\nWorld's menu\")),i},Morph.prototype.userMenu=function(){return null},Morph.prototype.setAlphaScaled=function(t){var e,i;\"number\"==typeof t?(i=t/100,this.alpha=Math.min(Math.max(i,.1),1)):(e=parseFloat(t),isNaN(e)||(i=e/100,this.alpha=Math.min(Math.max(i,.1),1))),this.changed()},Morph.prototype.attach=function(){var t=this.overlappedMorphs(),e=new MenuMorph(this,\"choose new parent:\"),i=this;t.forEach((function(t){e.addItem(t.toString().slice(0,50),(function(){t.add(i),i.isDraggable=!1}))})),t.length>0&&e.popUpAtHand(this.world())},Morph.prototype.toggleIsDraggable=function(){this.isDraggable=!this.isDraggable},Morph.prototype.colorSetters=function(){return[\"color\"]},Morph.prototype.numericalSetters=function(){return[\"setLeft\",\"setTop\",\"setWidth\",\"setHeight\",\"setAlphaScaled\"]},Morph.prototype.allEntryFields=function(){return this.allChildren().filter((function(t){return t.isEditable&&(t instanceof StringMorph||t instanceof TextMorph)}))},Morph.prototype.nextEntryField=function(t){var e=this.allEntryFields(),i=e.indexOf(t);return-1!==i&&e.length>i+1?e[i+1]:e[0]},Morph.prototype.previousEntryField=function(t){var e=this.allEntryFields(),i=e.indexOf(t);return-1!==i?i>0?e[i-1]:e[e.length-1]:e[0]},Morph.prototype.tab=function(t){this.nextTab?this.nextTab(t):this.parent&&this.parent.tab(t)},Morph.prototype.backTab=function(t){this.previousTab?this.previousTab(t):this.parent&&this.parent.backTab(t)},Morph.prototype.escalateEvent=function(t,e){for(var i=this.parent;!i[t]&&null!==i.parent;)i=i.parent;i[t]&&i[t](e)},Morph.prototype.evaluateString=function(code){var result;try{result=eval(code),this.drawNew(),this.changed()}catch(t){this.inform(t)}return result},Morph.prototype.isTouching=function(t){var e,i,o=this.overlappingPixels(t);if(!o)return!1;for(e=o[0].length,i=3;i<e;i+=4)if(o[0][i]&&o[1][i])return!0;return!1},Morph.prototype.overlappingPixels=function(t){var e,i,o=this.fullBounds(),r=t.fullBounds(),n=o.intersect(r);return!!(!(n.width()<1||n.height()<1)&&this.image&&t.image&&this.image.width&&this.image.height&&t.image.width&&t.image.height)&&(e=this.fullImage(),i=t.fullImage(),e.isRetinaEnabled!==i.isRetinaEnabled&&(e=normalizeCanvas(e,!0),i=normalizeCanvas(i,!0)),[e.getContext(\"2d\").getImageData(n.left()-this.left(),n.top()-this.top(),n.width(),n.height()).data,i.getContext(\"2d\").getImageData(n.left()-t.left(),n.top()-t.top(),n.width(),n.height()).data])},ShadowMorph.prototype=new Morph,ShadowMorph.prototype.constructor=ShadowMorph,ShadowMorph.uber=Morph.prototype,ShadowMorph.prototype.topMorphAt=function(){return null},HandleMorph.prototype=new Morph,HandleMorph.prototype.constructor=HandleMorph,HandleMorph.uber=Morph.prototype,HandleMorph.prototype.init=function(t,e,i,o,r,n){var s=MorphicPreferences.handleSize;this.target=t||null,this.minExtent=new Point(e||0,i||0),this.inset=new Point(o||0,r||o||0),this.type=n||\"resize\",HandleMorph.uber.init.call(this),this.color=new Color(255,255,255),this.isDraggable=!1,this.noticesTransparentClick=!0,\"movePivot\"===this.type&&(s*=2),this.setExtent(new Point(s,s))},HandleMorph.prototype.drawNew=function(){this.normalImage=newCanvas(this.extent(),!1,this.normalImage),this.highlightImage=newCanvas(this.extent(),!1,this.highlightImage),\"movePivot\"===this.type?(this.drawCrosshairsOnCanvas(this.normalImage,.6),this.drawCrosshairsOnCanvas(this.highlightImage,.5)):(this.drawOnCanvas(this.normalImage,this.color,new Color(100,100,100)),this.drawOnCanvas(this.highlightImage,new Color(100,100,255),new Color(255,255,255))),this.image=this.normalImage,this.target&&(\"moveCenter\"===this.type?this.setCenter(this.target.center()):\"movePivot\"===this.type?this.setCenter(this.target.rotationCenter()):this.setPosition(this.target.bottomRight().subtract(this.extent().add(this.inset))),this.target.add(this),this.target.changed())},HandleMorph.prototype.drawCrosshairsOnCanvas=function(t,e){var i=t.getContext(\"2d\"),o=t.width/2;i.fillStyle=\"rgba(255, 255, 255, 0.5)\",i.arc(o,o,.9*o,radians(0),radians(360),!1),i.fill(),i.strokeStyle=\"black\",i.lineWidth=1,i.beginPath(),i.arc(o,o,o*e,radians(0),radians(360),!1),i.stroke(),i.moveTo(0,o),i.lineTo(t.width,o),i.stroke(),i.moveTo(o,0),i.lineTo(o,t.height),i.stroke()},HandleMorph.prototype.drawOnCanvas=function(t,e,i){var o,r,n,s,h,a=t.getContext(\"2d\"),l=0===this.type.indexOf(\"move\");if(a.lineWidth=1,a.lineCap=\"round\",a.strokeStyle=e.toString(),l)for(r=(o=this.bottomLeft().subtract(this.position())).copy(),s=(n=this.topRight().subtract(this.position())).copy(),h=0;h<=this.height();h+=6)r.y=o.y-h,s.y=n.y-h,a.beginPath(),a.moveTo(r.x,r.y),a.lineTo(s.x,s.y),a.closePath(),a.stroke();for(r=(o=this.bottomLeft().subtract(this.position())).copy(),s=(n=this.topRight().subtract(this.position())).copy(),h=0;h<=this.width();h+=6)r.x=o.x+h,s.x=n.x+h,a.beginPath(),a.moveTo(r.x,r.y),a.lineTo(s.x,s.y),a.closePath(),a.stroke();if(a.strokeStyle=i.toString(),l)for(r=(o=this.bottomLeft().subtract(this.position())).copy(),s=(n=this.topRight().subtract(this.position())).copy(),h=-2;h<=this.height();h+=6)r.y=o.y-h,s.y=n.y-h,a.beginPath(),a.moveTo(r.x,r.y),a.lineTo(s.x,s.y),a.closePath(),a.stroke();for(r=(o=this.bottomLeft().subtract(this.position())).copy(),s=(n=this.topRight().subtract(this.position())).copy(),h=2;h<=this.width();h+=6)r.x=o.x+h,s.x=n.x+h,a.beginPath(),a.moveTo(r.x,r.y),a.lineTo(s.x,s.y),a.closePath(),a.stroke()},HandleMorph.prototype.step=null,HandleMorph.prototype.mouseDownLeft=function(t){var e,i=this.root(),o=this;if(!this.target)return null;e=0===this.type.indexOf(\"move\")?t.subtract(this.center()):t.subtract(this.bounds.origin),this.step=function(){var t,r;i.hand.mouseButton?(t=i.hand.bounds.origin.copy().subtract(e),\"resize\"===this.type?(r=(r=t.add(o.extent().add(o.inset)).subtract(o.target.bounds.origin)).max(o.minExtent),o.target.setExtent(r),o.setPosition(o.target.bottomRight().subtract(o.extent().add(o.inset)))):\"moveCenter\"===this.type?o.target.setCenter(t):\"movePivot\"===this.type?(o.target.setPivot(t),o.setCenter(this.target.rotationCenter())):o.target.setPosition(t.subtract(this.target.extent()).add(this.extent()))):this.step=null},this.target.step||(this.target.step=function(){nop()})},HandleMorph.prototype.rootForGrab=function(){return this},HandleMorph.prototype.mouseEnter=function(){this.image=this.highlightImage,this.changed()},HandleMorph.prototype.mouseLeave=function(){this.image=this.normalImage,this.changed()},HandleMorph.prototype.attach=function(){var t=this.overlappedMorphs(),e=new MenuMorph(this,\"choose target:\"),i=this;t.forEach((function(t){e.addItem(t.toString().slice(0,50),(function(){i.isDraggable=!1,i.target=t,i.drawNew(),i.noticesTransparentClick=!0}))})),t.length>0&&e.popUpAtHand(this.world())},PenMorph.prototype=new Morph,PenMorph.prototype.constructor=PenMorph,PenMorph.uber=Morph.prototype,PenMorph.prototype.init=function(){var t=4*MorphicPreferences.handleSize;this.isWarped=!1,this.heading=0,this.isDown=!0,this.size=1,this.wantsRedraw=!1,this.penPoint=\"tip\",this.penBounds=null,HandleMorph.uber.init.call(this),this.setExtent(new Point(t,t))},PenMorph.prototype.changed=function(){if(!1===this.isWarped){var t=this.root();t instanceof WorldMorph&&t.broken.push(this.visibleBounds().spread()),this.parent&&this.parent.childChanged(this)}},PenMorph.prototype.drawNew=function(t,e){var i,o,r,n,s,h,a=t||this.heading;this.isWarped?this.wantsRedraw=!0:(this.image=newCanvas(this.extent(),null,e),i=this.image.getContext(\"2d\"),h=this.width()/2,o=this.center().subtract(this.bounds.origin),\"tip\"===this.penPoint?(r=o.distanceAngle(.75*h,a-180),n=o.distanceAngle(h,a+195),s=o.distanceAngle(h,a-195)):(r=o.distanceAngle(.75*h,a),n=o.distanceAngle(.33*h,a+230),s=o.distanceAngle(.33*h,a-230)),this.penBounds=new Rectangle(Math.min(o.x,r.x,n.x,s.x),Math.min(o.y,r.y,n.y,s.y),Math.max(o.x,r.x,n.x,s.x),Math.max(o.y,r.y,n.y,s.y)),i.fillStyle=this.color.toString(),i.beginPath(),i.moveTo(o.x,o.y),i.lineTo(n.x,n.y),i.lineTo(r.x,r.y),i.lineTo(s.x,s.y),i.closePath(),i.strokeStyle=\"white\",i.lineWidth=3,i.stroke(),i.strokeStyle=\"black\",i.lineWidth=1,i.stroke(),i.fill())},PenMorph.prototype.setHeading=function(t){this.heading=(+t%360+360)%360,this.drawNew(),this.changed()},PenMorph.prototype.numericalSetters=function(){return[\"setLeft\",\"setTop\",\"setWidth\",\"setHeight\",\"setAlphaScaled\",\"setHeading\"]},PenMorph.prototype.developersMenu=function(){var t=PenMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem(\"set rotation\",\"setRotation\",\"interactively turn this morph\\nusing a dial widget\"),t},PenMorph.prototype.setRotation=function(){var t,e,i=this.name||this.constructor.name;i.length>10&&(i=i.slice(0,9)+\"...\"),t=new MenuMorph(this,i),(e=new DialMorph(null,null,this.heading)).rootForGrab=function(){return this},e.target=this,e.action=\"setHeading\",t.items.push(e),t.addLine(),t.addItem(\"(90) right\",(function(){this.setHeading(90)})),t.addItem(\"(-90) left\",(function(){this.setHeading(-90)})),t.addItem(\"(0) up\",(function(){this.setHeading(0)})),t.addItem(\"(180) down\",(function(){this.setHeading(180)})),t.isDraggable=!0,t.popUpAtHand(this.world())},PenMorph.prototype.drawLine=function(t,e){var i=this.parent.penTrails().getContext(\"2d\"),o=t.subtract(this.parent.bounds.origin),r=e.subtract(this.parent.bounds.origin);this.isDown&&(i.lineWidth=this.size,i.strokeStyle=this.color.toString(),i.lineCap=\"round\",i.lineJoin=\"round\",i.beginPath(),i.moveTo(o.x,o.y),i.lineTo(r.x,r.y),i.stroke(),!1===this.isWarped&&this.world().broken.push(t.rectangle(e).expandBy(Math.max(this.size/2,1)).intersect(this.parent.visibleBounds()).spread()))},PenMorph.prototype.turn=function(t){this.setHeading(this.heading+parseFloat(t))},PenMorph.prototype.forward=function(t){var e,i=this.center(),o=parseFloat(t);e=o>=0?this.position().distanceAngle(o,this.heading):this.position().distanceAngle(Math.abs(o),this.heading-180),this.setPosition(e),this.drawLine(i,this.center())},PenMorph.prototype.down=function(){this.isDown=!0},PenMorph.prototype.up=function(){this.isDown=!1},PenMorph.prototype.clear=function(){this.parent.drawNew(),this.parent.changed()},PenMorph.prototype.startWarp=function(){this.wantsRedraw=!1,this.isWarped=!0},PenMorph.prototype.endWarp=function(){this.isWarped=!1,this.wantsRedraw&&(this.drawNew(),this.wantsRedraw=!1),this.parent.changed()},PenMorph.prototype.warp=function(t){this.startWarp(),t.call(this),this.endWarp()},PenMorph.prototype.warpOp=function(t,e){this.startWarp(),this[t].apply(this,e),this.endWarp()},PenMorph.prototype.warpSierpinski=function(t,e){this.warpOp(\"sierpinski\",[t,e])},PenMorph.prototype.sierpinski=function(t,e){var i;if(t>e)for(i=0;i<3;i+=1)this.sierpinski(.5*t,e),this.turn(120),this.forward(t)},PenMorph.prototype.warpTree=function(t,e,i){this.warpOp(\"tree\",[t,e,i])},PenMorph.prototype.tree=function(t,e,i){t>0&&(this.size=t,this.forward(e),this.turn(i),this.tree(t-1,.75*e,i),this.turn(-2*i),this.tree(t-1,.75*e,i),this.turn(i),this.forward(-e))},ColorPaletteMorph.prototype=new Morph,ColorPaletteMorph.prototype.constructor=ColorPaletteMorph,ColorPaletteMorph.uber=Morph.prototype,ColorPaletteMorph.prototype.init=function(t,e){ColorPaletteMorph.uber.init.call(this),this.target=t,this.targetSetter=\"color\",this.silentSetExtent(e),this.choice=null,this.drawNew()},ColorPaletteMorph.prototype.drawNew=function(){var t,e,i,o,r,n;for(e=this.extent(),this.image=newCanvas(this.extent(),!1,this.image),t=this.image.getContext(\"2d\"),this.choice=new Color,i=0;i<=e.x;i+=1)for(r=360*i/e.x,o=0;o<=e.y;o+=1)n=100-o/e.y*100,t.fillStyle=\"hsl(\"+r+\",100%,\"+n+\"%)\",t.fillRect(i,o,1,1)},ColorPaletteMorph.prototype.mouseMove=function(t){this.choice=this.getPixelColor(t),this.updateTarget()},ColorPaletteMorph.prototype.mouseDownLeft=function(t){this.choice=this.getPixelColor(t),this.updateTarget()},ColorPaletteMorph.prototype.updateTarget=function(){this.target instanceof Morph&&null!==this.choice&&(this.target[this.targetSetter]instanceof Function?this.target[this.targetSetter](this.choice):(this.target[this.targetSetter]=this.choice,this.target.drawNew(),this.target.changed()))},ColorPaletteMorph.prototype.developersMenu=function(){var t=ColorPaletteMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem(\"set target\",\"setTarget\",\"choose another morph\\nwhose color property\\n will be controlled by this one\"),t},ColorPaletteMorph.prototype.setTarget=function(){var t=this.overlappedMorphs(),e=new MenuMorph(this,\"choose target:\"),i=this;t.push(this.world()),t.forEach((function(t){e.addItem(t.toString().slice(0,50),(function(){i.target=t,i.setTargetSetter()}))})),1===t.length?(this.target=t[0],this.setTargetSetter()):t.length>0&&e.popUpAtHand(this.world())},ColorPaletteMorph.prototype.setTargetSetter=function(){var t=this.target.colorSetters(),e=new MenuMorph(this,\"choose target property:\"),i=this;t.forEach((function(t){e.addItem(t,(function(){i.targetSetter=t}))})),1===t.length?this.targetSetter=t[0]:t.length>0&&e.popUpAtHand(this.world())},GrayPaletteMorph.prototype=new ColorPaletteMorph,GrayPaletteMorph.prototype.constructor=GrayPaletteMorph,GrayPaletteMorph.uber=ColorPaletteMorph.prototype,GrayPaletteMorph.prototype.drawNew=function(){var t,e,i;e=this.extent(),this.image=newCanvas(this.extent(),!1,this.image),t=this.image.getContext(\"2d\"),this.choice=new Color,(i=t.createLinearGradient(0,0,e.x,e.y)).addColorStop(0,\"black\"),i.addColorStop(1,\"white\"),t.fillStyle=i,t.fillRect(0,0,e.x,e.y)},ColorPickerMorph.prototype=new Morph,ColorPickerMorph.prototype.constructor=ColorPickerMorph,ColorPickerMorph.uber=Morph.prototype,ColorPickerMorph.prototype.init=function(t){this.choice=t,ColorPickerMorph.uber.init.call(this),this.color=new Color(255,255,255),this.silentSetExtent(new Point(80,80)),this.drawNew()},ColorPickerMorph.prototype.drawNew=function(){ColorPickerMorph.uber.drawNew.call(this),this.buildSubmorphs()},ColorPickerMorph.prototype.buildSubmorphs=function(){var t,e,i,o;this.children.forEach((function(t){t.destroy()})),this.children=[],this.feedback=new Morph,this.feedback.color=this.choice,this.feedback.setExtent(new Point(20,20)),t=new ColorPaletteMorph(this.feedback,new Point(this.width(),50)),e=new GrayPaletteMorph(this.feedback,new Point(this.width(),5)),t.setPosition(this.bounds.origin),this.add(t),e.setPosition(t.bottomLeft()),this.add(e),i=e.left()+Math.floor((e.width()-this.feedback.width())/2),o=e.bottom()+Math.floor((this.bottom()-e.bottom()-this.feedback.height())/2),this.feedback.setPosition(new Point(i,o)),this.add(this.feedback)},ColorPickerMorph.prototype.getChoice=function(){return this.feedback.color},ColorPickerMorph.prototype.rootForGrab=function(){return this},BlinkerMorph.prototype=new Morph,BlinkerMorph.prototype.constructor=BlinkerMorph,BlinkerMorph.uber=Morph.prototype,BlinkerMorph.prototype.init=function(t){BlinkerMorph.uber.init.call(this),this.color=new Color(0,0,0),this.fps=t||2,this.drawNew()},BlinkerMorph.prototype.step=function(){this.toggleVisibility()},CursorMorph.prototype=new BlinkerMorph,CursorMorph.prototype.constructor=CursorMorph,CursorMorph.uber=BlinkerMorph.prototype,CursorMorph.prototype.viewPadding=1,CursorMorph.prototype.init=function(t){var e;this.keyDownEventUsed=!1,this.target=t,this.originalContents=this.target.text,this.originalAlignment=this.target.alignment,this.slot=this.target.text.length,this.textarea=null,CursorMorph.uber.init.call(this),e=fontHeight(this.target.fontSize),this.setExtent(new Point(Math.max(Math.floor(e/20),1),e)),this.drawNew(),this.image.getContext(\"2d\").font=this.target.font(),this.target instanceof TextMorph&&\"left\"!==this.target.alignment&&this.target.setAlignmentToLeft(),this.gotoSlot(this.slot),this.initializeTextarea()},CursorMorph.prototype.initializeTextarea=function(){var t=this;this.textarea=document.createElement(\"textarea\"),this.textarea.style.zIndex=-1,this.textarea.style.position=\"absolute\",this.textarea.wrap=\"off\",this.textarea.style.overflow=\"hidden\",this.textarea.style.fontSize=this.target.fontSize+\"px\",this.textarea.autofocus=!0,this.textarea.value=this.target.text,document.body.appendChild(this.textarea),this.updateTextAreaPosition(),this.syncTextareaSelectionWith(this.target),this.textarea.addEventListener(\"keydown\",(function(e){var i=e.key,o=e.shiftKey,r=t.target instanceof StringMorph;t.world().currentKey=e.keyCode,isNil(t.target.receiver)||!e.ctrlKey&&!e.metaKey?\"Tab\"===i||\"U+0009\"===i?(o?t.target.backTab(t.target):t.target.tab(t.target),e.preventDefault(),t.target.escalateEvent(\"reactToEdit\",t.target)):\"Escape\"===i?t.cancel():\"Enter\"===i&&(r||o)?t.accept():t.target.escalateEvent(\"reactToKeystroke\",e):(\"d\"===i?t.target.doIt():\"i\"===i?t.target.inspectIt():\"p\"===i&&t.target.showIt(),e.preventDefault())})),this.textarea.addEventListener(\"input\",(function(e){var i,o,r=t.target,n=t.textarea;t.world().currentKey=null,(i=r.isNumeric?function(t){var e,i,o=0,r=\"\";for(e=0;e<t.length;e+=1)(\"0\"<=(i=t.charAt(e))&&i<=\"9\"||0===e&&\"-\"===i||\".\"===i&&0===o)&&(r+=i,\".\"===i&&(o+=1));return r}(n.value):n.value).length<n.value.length&&(n.value=i,o=Math.min(n.selectionStart,i.length),n.selectionEnd=o,n.selectionStart=o),r.text=i,n.selectionStart===n.selectionEnd?(r.startMark=null,r.endMark=null):\"backward\"===n.selectionDirection?(r.startMark=n.selectionEnd,r.endMark=n.selectionStart):(r.startMark=n.selectionStart,r.endMark=n.selectionEnd),r.changed(),r.drawNew(),r.changed(),t.gotoSlot(n.selectionStart),t.updateTextAreaPosition(),t.target.escalateEvent(\"reactToInput\",e)})),this.textarea.addEventListener(\"keyup\",(function(e){var i=t.textarea,o=t.target;i.selectionStart===i.selectionEnd?(o.startMark=null,o.endMark=null):\"backward\"===i.selectionDirection?(o.startMark=i.selectionEnd,o.endMark=i.selectionStart):(o.startMark=i.selectionStart,o.endMark=i.selectionEnd),o.changed(),o.drawNew(),o.changed(),t.gotoSlot(i.selectionEnd)}))},CursorMorph.prototype.updateTextAreaPosition=function(){var t=this.target.bounds.origin;function e(t){return Math.ceil(t)+\"px\"}this.textarea.style.top=e(t.y),this.textarea.style.left=e(t.x)},CursorMorph.prototype.syncTextareaSelectionWith=function(t){var e=t.startMark,i=t.endMark;e===i?this.textarea.setSelectionRange(this.slot,this.slot,\"none\"):e<i?this.textarea.setSelectionRange(e,i,\"forward\"):this.textarea.setSelectionRange(i,e,\"backward\"),this.textarea.focus()},CursorMorph.prototype.processKeyPress=function(t){return this.keyDownEventUsed?(this.keyDownEventUsed=!1,null):40===t.keyCode||40===t.charCode?(this.insert(\"(\"),null):37===t.keyCode||37===t.charCode?(this.insert(\"%\"),null):(t.keyCode?t.ctrlKey&&!t.altKey?this.ctrl(t.keyCode,t.shiftKey):t.metaKey?this.cmd(t.keyCode,t.shiftKey):this.insert(String.fromCharCode(t.keyCode),t.shiftKey):t.charCode&&(t.ctrlKey&&!t.altKey?this.ctrl(t.charCode,t.shiftKey):t.metaKey?this.cmd(t.charCode,t.shiftKey):this.insert(String.fromCharCode(t.charCode),t.shiftKey)),void this.target.escalateEvent(\"reactToKeystroke\",t))},CursorMorph.prototype.processKeyDown=function(t){var e=t.shiftKey,i=t.ctrlKey||t.altKey,o=this.target.selection().length>0;switch(this.keyDownEventUsed=!1,t.ctrlKey&&!t.altKey&&(this.ctrl(t.keyCode,t.shiftKey),this.target.escalateEvent(\"reactToKeystroke\",t)),t.metaKey&&(this.cmd(t.keyCode,t.shiftKey),this.target.escalateEvent(\"reactToKeystroke\",t)),t.keyCode){case 37:!o||e||i?this.goLeft(e,i?this.slot-this.target.previousWordFrom(this.slot):1):(this.gotoSlot(Math.min(this.target.startMark,this.target.endMark)),this.target.clearSelection()),this.keyDownEventUsed=!0;break;case 39:!o||e||i?this.goRight(e,i?this.target.nextWordFrom(this.slot)-this.slot:1):(this.gotoSlot(Math.max(this.target.startMark,this.target.endMark)),this.target.clearSelection()),this.keyDownEventUsed=!0;break;case 38:this.goUp(e),this.keyDownEventUsed=!0;break;case 40:this.goDown(e),this.keyDownEventUsed=!0;break;case 36:this.goHome(e),this.keyDownEventUsed=!0;break;case 35:this.goEnd(e),this.keyDownEventUsed=!0;break;case 46:this.deleteRight(),this.keyDownEventUsed=!0;break;case 8:this.deleteLeft(),this.keyDownEventUsed=!0;break;case 13:this.target instanceof StringMorph||e?this.accept():this.insert(\"\\n\"),this.keyDownEventUsed=!0;break;case 27:this.cancel(),this.keyDownEventUsed=!0;break;default:nop()}this.target.escalateEvent(\"reactToKeystroke\",t)},CursorMorph.prototype.gotoSlot=function(t){var e,i,o=this.target.text.length,r=this.target.slotPosition(t);this.slot=t<0?0:t>o?o:t,this.parent&&this.target.isScrollable&&(e=this.parent.right()-this.viewPadding,i=this.parent.left()+this.viewPadding,r.x>e&&(this.target.setLeft(this.target.left()+e-r.x),r.x=e),r.x<i&&(i=Math.min(this.parent.left(),i),this.target.setLeft(this.target.left()+i-r.x),r.x=i),this.target.right()<e&&e-this.target.width()<i&&(r.x+=e-this.target.right(),this.target.setRight(e))),this.show(),this.setPosition(r),this.parent&&this.parent.parent instanceof ScrollFrameMorph&&this.target.isScrollable&&this.parent.parent.scrollCursorIntoView(this)},CursorMorph.prototype.goLeft=function(t,e){this.updateSelection(t),this.gotoSlot(this.slot-(e||1)),this.updateSelection(t)},CursorMorph.prototype.goRight=function(t,e){this.updateSelection(t),this.gotoSlot(this.slot+(e||1)),this.updateSelection(t)},CursorMorph.prototype.goUp=function(t){this.updateSelection(t),this.gotoSlot(this.target.upFrom(this.slot)),this.updateSelection(t)},CursorMorph.prototype.goDown=function(t){this.updateSelection(t),this.gotoSlot(this.target.downFrom(this.slot)),this.updateSelection(t)},CursorMorph.prototype.goHome=function(t){this.updateSelection(t),this.gotoSlot(this.target.startOfLine(this.slot)),this.updateSelection(t)},CursorMorph.prototype.goEnd=function(t){this.updateSelection(t),this.gotoSlot(this.target.endOfLine(this.slot)),this.updateSelection(t)},CursorMorph.prototype.gotoPos=function(t){this.gotoSlot(this.target.slotAt(t)),this.show()},CursorMorph.prototype.updateSelection=function(t){t?isNil(this.target.endMark)&&isNil(this.target.startMark)?(this.target.startMark=this.slot,this.target.endMark=this.slot):this.target.endMark!==this.slot&&(this.target.endMark=this.slot,this.target.drawNew(),this.target.changed()):this.target.clearSelection()},CursorMorph.prototype.accept=function(){var t=this.root();t&&t.stopEditing(),this.escalateEvent(\"accept\",this)},CursorMorph.prototype.cancel=function(){var t=this.root();this.undo(),t&&t.stopEditing(),this.escalateEvent(\"cancel\",this)},CursorMorph.prototype.undo=function(){this.target.text=this.originalContents,this.target.changed(),this.target.drawNew(),this.target.changed(),this.gotoSlot(0)},CursorMorph.prototype.insert=function(t,e){var i;if(\"\\t\"===t)return this.target.escalateEvent(\"reactToEdit\",this.target),e?this.target.backTab(this.target):this.target.tab(this.target);this.target.isNumeric&&isNaN(parseFloat(t))&&!contains([\"-\",\".\"],t)||(\"\"!==this.target.selection()&&(this.gotoSlot(this.target.selectionStartSlot()),this.target.deleteSelection()),i=(i=this.target.text).slice(0,this.slot)+t+i.slice(this.slot),this.target.text=i,this.target.drawNew(),this.target.changed(),this.goRight(!1,t.length))},CursorMorph.prototype.ctrl=function(t,e){64===t||65===t&&e?this.insert(\"@\"):65===t?this.target.selectAll():90===t?this.undo():123===t?this.insert(\"{\"):125===t?this.insert(\"}\"):91===t?this.insert(\"[\"):93===t?this.insert(\"]\"):isNil(this.target.receiver)||(68===t?this.target.doIt():73===t?this.target.inspectIt():80===t&&this.target.showIt())},CursorMorph.prototype.cmd=function(t,e){64===t||65===t&&e?this.insert(\"@\"):65===t?this.target.selectAll():90===t?this.undo():isNil(this.target.receiver)||(68===t?this.target.doIt():73===t?this.target.inspectIt():80===t&&this.target.showIt())},CursorMorph.prototype.deleteRight=function(){var t;\"\"!==this.target.selection()?(this.gotoSlot(this.target.selectionStartSlot()),this.target.deleteSelection()):(t=this.target.text,this.target.changed(),t=t.slice(0,this.slot)+t.slice(this.slot+1),this.target.text=t,this.target.drawNew())},CursorMorph.prototype.deleteLeft=function(){var t;if(this.target.selection())return this.gotoSlot(this.target.selectionStartSlot()),this.target.deleteSelection();t=this.target.text,this.target.changed(),this.target.text=t.substring(0,this.slot-1)+t.substr(this.slot),this.target.drawNew(),this.goLeft()},CursorMorph.prototype.destroy=function(){this.target.alignment!==this.originalAlignment&&(this.target.alignment=this.originalAlignment,this.target.drawNew(),this.target.changed()),this.destroyTextarea(),CursorMorph.uber.destroy.call(this)},CursorMorph.prototype.destroyTextarea=function(){document.body.removeChild(this.textarea),this.textarea=null},CursorMorph.prototype.inspectKeyEvent=function(t){this.inform(\"Key pressed: \"+String.fromCharCode(t.charCode)+\"\\n------------------------\\ncharCode: \"+t.charCode.toString()+\"\\nkeyCode: \"+t.keyCode.toString()+\"\\nkey: \"+t.key.toString()+\"\\nshiftKey: \"+t.shiftKey.toString()+\"\\naltKey: \"+t.altKey.toString()+\"\\nctrlKey: \"+t.ctrlKey.toString()+\"\\ncmdKey: \"+t.metaKey.toString())},BoxMorph.prototype=new Morph,BoxMorph.prototype.constructor=BoxMorph,BoxMorph.uber=Morph.prototype,BoxMorph.prototype.init=function(t,e,i){this.edge=t||4,this.border=e||(0===e?0:2),this.borderColor=i||new Color,BoxMorph.uber.init.call(this)},BoxMorph.prototype.drawNew=function(){var t;if(this.image=newCanvas(this.extent(),!1,this.image),t=this.image.getContext(\"2d\"),0===this.edge&&0===this.border)return BoxMorph.uber.drawNew.call(this),null;t.fillStyle=this.color.toString(),t.beginPath(),this.outlinePath(t,Math.max(this.edge-this.border,0),this.border),t.closePath(),t.fill(),this.border>0&&(t.lineWidth=this.border,t.strokeStyle=this.borderColor.toString(),t.beginPath(),this.outlinePath(t,this.edge,this.border/2),t.closePath(),t.stroke())},BoxMorph.prototype.outlinePath=function(t,e,i){var o=e+i,r=this.width(),n=this.height();t.arc(o,o,e,radians(-180),radians(-90),!1),t.arc(r-o,o,e,radians(-90),radians(-0),!1),t.arc(r-o,n-o,e,radians(0),radians(90),!1),t.arc(o,n-o,e,radians(90),radians(180),!1)},BoxMorph.prototype.developersMenu=function(){var t=BoxMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem(\"border width...\",(function(){this.prompt(t.title+\"\\nborder\\nwidth:\",this.setBorderWidth,this,this.border.toString(),null,0,100,!0)}),\"set the border's\\nline size\"),t.addItem(\"border color...\",(function(){this.pickColor(t.title+\"\\nborder color:\",this.setBorderColor,this,this.borderColor)}),\"set the border's\\nline color\"),t.addItem(\"corner size...\",(function(){this.prompt(t.title+\"\\ncorner\\nsize:\",this.setCornerSize,this,this.edge.toString(),null,0,100,!0)}),\"set the corner's\\nradius\"),t},BoxMorph.prototype.setBorderWidth=function(t){var e;\"number\"==typeof t?this.border=Math.max(t,0):(e=parseFloat(t),isNaN(e)||(this.border=Math.max(e,0))),this.drawNew(),this.changed()},BoxMorph.prototype.setBorderColor=function(t){t&&(this.borderColor=t,this.drawNew(),this.changed())},BoxMorph.prototype.setCornerSize=function(t){var e;\"number\"==typeof t?this.edge=Math.max(t,0):(e=parseFloat(t),isNaN(e)||(this.edge=Math.max(e,0))),this.drawNew(),this.changed()},BoxMorph.prototype.colorSetters=function(){return[\"color\",\"borderColor\"]},BoxMorph.prototype.numericalSetters=function(){var t=BoxMorph.uber.numericalSetters.call(this);return t.push(\"setBorderWidth\",\"setCornerSize\"),t},SpeechBubbleMorph.prototype=new BoxMorph,SpeechBubbleMorph.prototype.constructor=SpeechBubbleMorph,SpeechBubbleMorph.uber=BoxMorph.prototype,SpeechBubbleMorph.prototype.init=function(t,e,i,o,r,n,s){this.isPointingRight=!0,this.contents=t||\"\",this.padding=n||0,this.isThought=s||!1,this.isClickable=!1,SpeechBubbleMorph.uber.init.call(this,i||6,o||(0===o?0:1),r||new Color(140,140,140)),this.color=e||new Color(230,230,230),this.drawNew()},SpeechBubbleMorph.prototype.popUp=function(t,e,i){this.drawNew(),this.setPosition(e.subtract(new Point(0,this.height()))),this.addShadow(new Point(2,2),80),this.keepWithin(t),t.add(this),this.fullChanged(),t.hand.destroyTemporaries(),t.hand.temporaries.push(this),i?this.isClickable=!0:this.mouseEnter=function(){this.destroy()}},SpeechBubbleMorph.prototype.drawNew=function(){this.contentsMorph&&this.contentsMorph.destroy(),this.contents instanceof Morph?this.contentsMorph=this.contents:isString(this.contents)?this.contentsMorph=new TextMorph(this.contents,MorphicPreferences.bubbleHelpFontSize,null,!1,!0,\"center\"):this.contents instanceof HTMLCanvasElement?(this.contentsMorph=new Morph,this.contentsMorph.silentSetWidth(this.contents.width),this.contentsMorph.silentSetHeight(this.contents.height),this.contentsMorph.image=this.contents):this.contentsMorph=new TextMorph(this.contents.toString(),MorphicPreferences.bubbleHelpFontSize,null,!1,!0,\"center\"),this.add(this.contentsMorph),this.silentSetWidth(this.contentsMorph.width()+(this.padding?2*this.padding:2*this.edge)),this.silentSetHeight(this.contentsMorph.height()+this.edge+2*this.border+2*this.padding+2),SpeechBubbleMorph.uber.drawNew.call(this),this.contentsMorph.setPosition(this.position().add(new Point(this.padding||this.edge,this.border+this.padding+1)))},SpeechBubbleMorph.prototype.outlinePath=function(t,e,i){var o,r=e+i,n=this.width(),s=this.height();function h(e,i,o){t.moveTo(e+o,i),t.arc(e,i,o,radians(0),radians(360))}t.arc(r,r,e,radians(-180),radians(-90),!1),t.arc(n-r,r,e,radians(-90),radians(-0),!1),t.arc(n-r,s-r-e,e,radians(0),radians(90),!1),this.isThought||(this.isPointingRight?(t.lineTo(r+e,s-r),t.lineTo(e/2+i,s-i)):(t.lineTo(n-(e/2+i),s-i),t.lineTo(n-(r+e),s-r))),t.arc(r,s-r-e,e,radians(90),radians(180),!1),!0===this.isThought&&(t.lineTo(i,r),this.isPointingRight?(h((o=e/4)+i,s-o-i,o),h(2*(o=e/3.2)+i,s-o-2*i,o),h(3*(o=e/2.8)+2*i,s-o-4*i,o)):(h(n-((o=e/4)+i),s-o-i,o),h(n-(2*(o=e/3.2)+i),s-o-2*i,o),h(n-(3*(o=e/2.8)+2*i),s-o-4*i,o)))},SpeechBubbleMorph.prototype.shadowImage=function(t,e){var i,o,r,n,s,h=t||new Point(7,7),a=e||new Color(0,0,0);return i=this.extent(),o=this.image,(s=(r=newCanvas(i)).getContext(\"2d\")).drawImage(o,0,0),s.globalCompositeOperation=\"destination-out\",s.drawImage(o,-h.x,-h.y),(s=(n=newCanvas(i)).getContext(\"2d\")).drawImage(r,0,0),s.globalCompositeOperation=\"source-atop\",s.fillStyle=a.toString(),s.fillRect(0,0,i.x,i.y),n},SpeechBubbleMorph.prototype.shadowImageBlurred=function(t,e){var i,o,r,n,s=t||new Point(7,7),h=this.shadowBlur,a=e||new Color(0,0,0);return i=this.extent().add(2*h),o=this.image,(n=(r=newCanvas(i)).getContext(\"2d\")).shadowOffsetX=s.x,n.shadowOffsetY=s.y,n.shadowBlur=h,n.shadowColor=a.toString(),n.drawImage(o,h-s.x,h-s.y),n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=0,n.globalCompositeOperation=\"destination-out\",n.drawImage(o,h-s.x,h-s.y),r},SpeechBubbleMorph.prototype.fixLayout=function(){this.removeShadow(),this.drawNew(),this.addShadow(new Point(2,2),80)},DialMorph.prototype=new Morph,DialMorph.prototype.constructor=DialMorph,DialMorph.uber=Morph.prototype,DialMorph.prototype.init=function(t,e,i,o,r){this.target=null,this.action=null,this.min=t||0,this.max=e||360,this.value=Math.max(this.min,(i||0)%this.max),this.tick=o||15,this.fillColor=null,DialMorph.uber.init.call(this),this.color=new Color(230,230,230),this.noticesTransparentClick=!0,this.setRadius(r||4*MorphicPreferences.menuFontSize)},DialMorph.prototype.setRadius=function(t){this.radius=t,this.setExtent(new Point(2*this.radius,2*this.radius))},DialMorph.prototype.setValue=function(t,e,i){var o=this.max-this.min;t=t||0,this.value=this.min+(+t%o+o)%o,e&&(this.value<this.tick?this.value=this.min:this.value-=this.value%this.tick%this.value),this.drawNew(),this.changed(),i||this.updateTarget()},DialMorph.prototype.getValueOf=function(t){var e=this.max-this.min,i=this.center(),o=t.x-i.x,r=i.y-t.y;return e*(((Math.abs(o)<.001?r<0?90:270:Math.round((o>=0?0:180)-57.2957795131*Math.atan(r/o)))+90)/360)+this.min},DialMorph.prototype.setExtent=function(t){var e=Math.min(t.x,t.y);this.radius=e/2,DialMorph.uber.setExtent.call(this,new Point(e,e))},DialMorph.prototype.drawNew=function(){var t,e,i,o,r,n,s,h=this.color.lighter().toString(),a=this.max-this.min,l=a/this.tick,p=.75*this.radius,c=.85*p,u=.95*p;for(this.image=newCanvas(this.extent(),!1,this.image),(t=this.image.getContext(\"2d\")).fillStyle=h,t.beginPath(),t.arc(this.radius,this.radius,p+Math.min(1,this.radius-p),0,2*Math.PI,!1),t.closePath(),t.fill(),t.fillStyle=this.color.toString(),t.beginPath(),t.arc(this.radius,this.radius,p,0,2*Math.PI,!1),t.closePath(),t.fill(),i=(this.value-this.min)*(2*Math.PI)/a-Math.PI/2,t.fillStyle=(this.fillColor||this.color.darker()).toString(),t.beginPath(),t.arc(this.radius,this.radius,p,Math.PI/-2,i,!1),t.lineTo(this.radius,this.radius),t.closePath(),t.fill(),t.strokeStyle=new Color(35,35,35).toString(),t.lineWidth=1,e=0;e<l;e+=1)i=(e-3)*(2*Math.PI)/l-Math.PI/2,t.beginPath(),o=this.radius+Math.cos(i)*c,r=this.radius+Math.sin(i)*c,n=this.radius+Math.cos(i)*u,s=this.radius+Math.sin(i)*u,t.moveTo(o,r),t.lineTo(n,s),t.stroke();c=.05*p,t.fillStyle=\"black\",t.beginPath(),t.arc(this.radius,this.radius,c,0,2*Math.PI,!1),t.closePath(),t.fill(),t.strokeStyle=\"black\",t.lineWidth=1,i=(this.value-this.min)*(2*Math.PI)/a-Math.PI/2,u=.8*p,o=this.radius+Math.cos(i)*c,r=this.radius+Math.sin(i)*c,n=this.radius+Math.cos(i)*u,s=this.radius+Math.sin(i)*u,t.beginPath(),t.moveTo(o,r),t.lineTo(n,s),t.stroke(),c*=2,n=this.radius+Math.cos(i)*(u+c),s=this.radius+Math.sin(i)*(u+c),t.fillStyle=\"black\",t.beginPath(),t.arc(n,s,c,0,2*Math.PI,!1),t.closePath(),t.stroke(),i=(this.value-this.min)*(2*Math.PI)/a-Math.PI/2,o=this.radius+Math.cos(i)*p,r=this.radius+Math.sin(i)*p,n=this.radius+Math.cos(i)*(this.radius-1),s=this.radius+Math.sin(i)*(this.radius-1),t.beginPath(),t.moveTo(o,r),t.lineTo(n,s),t.lineWidth=3,t.strokeStyle=h,t.stroke(),t.lineWidth=1,t.strokeStyle=\"black\",t.stroke(),i=radians(degrees(i)-4),o=this.radius+Math.cos(i)*this.radius*.9,r=this.radius+Math.sin(i)*this.radius*.9,t.beginPath(),t.moveTo(o,r),i=radians(degrees(i)+8),o=this.radius+Math.cos(i)*this.radius*.9,r=this.radius+Math.sin(i)*this.radius*.9,t.lineTo(o,r),t.lineTo(n,s),t.closePath(),t.lineWidth=3,t.strokeStyle=h,t.stroke(),t.lineWidth=1,t.strokeStyle=\"black\",t.stroke(),t.fill()},DialMorph.prototype.step=null,DialMorph.prototype.mouseDownLeft=function(t){var e,i=this;e=this.root(),this.step=function(){e.hand.mouseButton?i.setValue(i.getValueOf(e.hand.bounds.origin),16!==e.currentKey):this.step=null}},DialMorph.prototype.developersMenu=function(){var t=DialMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem(\"set target\",\"setTarget\",\"select another morph\\nwhose numerical property\\nwill be controlled by this one\"),t},DialMorph.prototype.setTarget=function(){var t=this.overlappedMorphs(),e=new MenuMorph(this,\"choose target:\"),i=this;t.push(this.world()),t.forEach((function(t){e.addItem(t.toString().slice(0,50),(function(){i.target=t,i.setTargetSetter()}))})),1===t.length?(this.target=t[0],this.setTargetSetter()):t.length>0&&e.popUpAtHand(this.world())},DialMorph.prototype.setTargetSetter=function(){var t=this.target.numericalSetters(),e=new MenuMorph(this,\"choose target property:\"),i=this;t.forEach((function(t){e.addItem(t,(function(){i.action=t}))})),1===t.length?this.action=t[0]:t.length>0&&e.popUpAtHand(this.world())},DialMorph.prototype.updateTarget=function(){this.action&&(\"function\"==typeof this.action?this.action.call(this.target,this.value):this.target[this.action](this.value))},CircleBoxMorph.prototype=new Morph,CircleBoxMorph.prototype.constructor=CircleBoxMorph,CircleBoxMorph.uber=Morph.prototype,CircleBoxMorph.prototype.init=function(t){CircleBoxMorph.uber.init.call(this),this.orientation=t,this.autoOrient=!0,this.setExtent(new Point(20,100))},CircleBoxMorph.prototype.autoOrientation=function(){this.height()>this.width()?this.orientation=\"vertical\":this.orientation=\"horizontal\"},CircleBoxMorph.prototype.drawNew=function(){var t,e,i,o,r,n,s,h,a=this;this.autoOrient&&this.autoOrientation(),this.image=newCanvas(this.extent(),!1,this.image),s=this.image.getContext(\"2d\"),\"vertical\"===this.orientation?(t=this.width()/2,e=new Point(r=this.center().x,this.top()+t),i=new Point(r,this.bottom()-t),o=this.bounds.origin.add(new Point(0,t)).corner(this.bounds.corner.subtract(new Point(0,t)))):(t=this.height()/2,n=this.center().y,e=new Point(this.left()+t,n),i=new Point(this.right()-t,n),o=this.bounds.origin.add(new Point(t,0)).corner(this.bounds.corner.subtract(new Point(t,0)))),[e.subtract(this.bounds.origin),i.subtract(this.bounds.origin)].forEach((function(e){s.fillStyle=a.color.toString(),s.beginPath(),s.arc(e.x,e.y,t,0,2*Math.PI,!1),s.closePath(),s.fill()})),(h=(o=o.translateBy(this.bounds.origin.neg())).extent()).x>0&&h.y>0&&s.fillRect(o.origin.x,o.origin.y,o.width(),o.height())},CircleBoxMorph.prototype.developersMenu=function(){var t=CircleBoxMorph.uber.developersMenu.call(this);return t.addLine(),\"vertical\"===this.orientation?t.addItem(\"horizontal...\",\"toggleOrientation\",\"toggle the\\norientation\"):t.addItem(\"vertical...\",\"toggleOrientation\",\"toggle the\\norientation\"),t},CircleBoxMorph.prototype.toggleOrientation=function(){var t=this.center();this.changed(),\"vertical\"===this.orientation?this.orientation=\"horizontal\":this.orientation=\"vertical\",this.silentSetExtent(new Point(this.height(),this.width())),this.setCenter(t),this.drawNew(),this.changed()},SliderButtonMorph.prototype=new CircleBoxMorph,SliderButtonMorph.prototype.constructor=SliderButtonMorph,SliderButtonMorph.uber=CircleBoxMorph.prototype,SliderButtonMorph.prototype.init=function(t){this.color=new Color(80,80,80),this.highlightColor=new Color(90,90,140),this.pressColor=new Color(80,80,160),this.is3D=!1,this.hasMiddleDip=!0,SliderButtonMorph.uber.init.call(this,t)},SliderButtonMorph.prototype.autoOrientation=nop,SliderButtonMorph.prototype.drawNew=function(){var t=this.color.copy();SliderButtonMorph.uber.drawNew.call(this),!this.is3D&&MorphicPreferences.isFlat||this.drawEdges(),this.normalImage=this.image,this.image=null,this.color=this.highlightColor.copy(),SliderButtonMorph.uber.drawNew.call(this),!this.is3D&&MorphicPreferences.isFlat||this.drawEdges(),this.highlightImage=this.image,this.image=null,this.color=this.pressColor.copy(),SliderButtonMorph.uber.drawNew.call(this),!this.is3D&&MorphicPreferences.isFlat||this.drawEdges(),this.pressImage=this.image,this.color=t,this.image=this.normalImage},SliderButtonMorph.prototype.drawEdges=function(){var t,e,i=this.image.getContext(\"2d\"),o=this.width(),r=this.height();i.lineJoin=\"round\",i.lineCap=\"round\",\"vertical\"===this.orientation?(i.lineWidth=o/3,(t=i.createLinearGradient(0,0,i.lineWidth,0)).addColorStop(0,\"white\"),t.addColorStop(1,this.color.toString()),i.strokeStyle=t,i.beginPath(),i.moveTo(.5*i.lineWidth,o/2),i.lineTo(.5*i.lineWidth,r-o/2),i.stroke(),(t=i.createLinearGradient(o-i.lineWidth,0,o,0)).addColorStop(0,this.color.toString()),t.addColorStop(1,\"black\"),i.strokeStyle=t,i.beginPath(),i.moveTo(o-.5*i.lineWidth,o/2),i.lineTo(o-.5*i.lineWidth,r-o/2),i.stroke(),this.hasMiddleDip&&(e=o/4,(t=i.createLinearGradient(i.lineWidth,0,o-i.lineWidth,0)).addColorStop(0,\"black\"),t.addColorStop(.35,this.color.toString()),t.addColorStop(.65,this.color.toString()),t.addColorStop(1,\"white\"),i.fillStyle=t,i.beginPath(),i.arc(o/2,r/2,e,radians(0),radians(360),!1),i.closePath(),i.fill())):\"horizontal\"===this.orientation&&(i.lineWidth=r/3,(t=i.createLinearGradient(0,0,0,i.lineWidth)).addColorStop(0,\"white\"),t.addColorStop(1,this.color.toString()),i.strokeStyle=t,i.beginPath(),i.moveTo(r/2,.5*i.lineWidth),i.lineTo(o-r/2,.5*i.lineWidth),i.stroke(),(t=i.createLinearGradient(0,r-i.lineWidth,0,r)).addColorStop(0,this.color.toString()),t.addColorStop(1,\"black\"),i.strokeStyle=t,i.beginPath(),i.moveTo(r/2,r-.5*i.lineWidth),i.lineTo(o-r/2,r-.5*i.lineWidth),i.stroke(),this.hasMiddleDip&&(e=r/4,(t=i.createLinearGradient(0,i.lineWidth,0,r-i.lineWidth)).addColorStop(0,\"black\"),t.addColorStop(.35,this.color.toString()),t.addColorStop(.65,this.color.toString()),t.addColorStop(1,\"white\"),i.fillStyle=t,i.beginPath(),i.arc(this.width()/2,this.height()/2,e,radians(0),radians(360),!1),i.closePath(),i.fill()))},SliderButtonMorph.prototype.mouseEnter=function(){this.image=this.highlightImage,this.changed()},SliderButtonMorph.prototype.mouseLeave=function(){this.image=this.normalImage,this.changed()},SliderButtonMorph.prototype.mouseDownLeft=function(t){this.image=this.pressImage,this.changed(),this.escalateEvent(\"mouseDownLeft\",t)},SliderButtonMorph.prototype.mouseClickLeft=function(){this.image=this.highlightImage,this.changed()},SliderButtonMorph.prototype.mouseMove=function(){nop()},SliderMorph.prototype=new CircleBoxMorph,SliderMorph.prototype.constructor=SliderMorph,SliderMorph.uber=CircleBoxMorph.prototype,SliderMorph.prototype.init=function(t,e,i,o,r,n){this.target=null,this.action=null,this.start=t,this.stop=e,this.value=i,this.size=o,this.offset=null,this.button=new SliderButtonMorph,this.button.isDraggable=!1,this.button.color=new Color(200,200,200),this.button.highlightColor=new Color(210,210,255),this.button.pressColor=new Color(180,180,255),SliderMorph.uber.init.call(this,r),this.add(this.button),this.alpha=.3,this.color=n||new Color(0,0,0),this.setExtent(new Point(20,100))},SliderMorph.prototype.autoOrientation=nop,SliderMorph.prototype.rangeSize=function(){return this.stop-this.start},SliderMorph.prototype.ratio=function(){return this.size/(this.rangeSize()+1)},SliderMorph.prototype.unitSize=function(){return\"vertical\"===this.orientation?(this.height()-this.button.height())/this.rangeSize():(this.width()-this.button.width())/this.rangeSize()},SliderMorph.prototype.drawNew=function(){var t,e,i,o;SliderMorph.uber.drawNew.call(this),this.button.orientation=this.orientation,\"vertical\"===this.orientation?(t=this.width()-2,e=Math.max(t,Math.round(this.height()*this.ratio())),this.button.silentSetExtent(new Point(t,e)),i=1,o=Math.min(Math.round((this.value-this.start)*this.unitSize()),this.height()-this.button.height())):(e=this.height()-2,t=Math.max(e,Math.round(this.width()*this.ratio())),this.button.silentSetExtent(new Point(t,e)),o=1,i=Math.min(Math.round((this.value-this.start)*this.unitSize()),this.width()-this.button.width())),this.button.setPosition(new Point(i,o).add(this.bounds.origin)),this.button.drawNew(),this.button.changed()},SliderMorph.prototype.updateValue=function(){var t;t=\"vertical\"===this.orientation?this.button.top()-this.top():this.button.left()-this.left(),this.value=Math.round(t/this.unitSize()+this.start),this.updateTarget()},SliderMorph.prototype.updateTarget=function(){this.action&&(\"function\"==typeof this.action?this.action.call(this.target,this.value):this.target[this.action](this.value))},SliderMorph.prototype.developersMenu=function(){var t=SliderMorph.uber.developersMenu.call(this);return t.addItem(\"show value...\",\"showValue\",\"display a dialog box\\nshowing the selected number\"),t.addItem(\"floor...\",(function(){this.prompt(t.title+\"\\nfloor:\",this.setStart,this,this.start.toString(),null,0,this.stop-this.size,!0)}),\"set the minimum value\\nwhich can be selected\"),t.addItem(\"ceiling...\",(function(){this.prompt(t.title+\"\\nceiling:\",this.setStop,this,this.stop.toString(),null,this.start+this.size,100*this.size,!0)}),\"set the maximum value\\nwhich can be selected\"),t.addItem(\"button size...\",(function(){this.prompt(t.title+\"\\nbutton size:\",this.setSize,this,this.size.toString(),null,1,this.stop-this.start,!0)}),\"set the range\\ncovered by\\nthe slider button\"),t.addLine(),t.addItem(\"set target\",\"setTarget\",\"select another morph\\nwhose numerical property\\nwill be controlled by this one\"),t},SliderMorph.prototype.showValue=function(){this.inform(this.value)},SliderMorph.prototype.userSetStart=function(t){this.start=Math.max(t,this.stop)},SliderMorph.prototype.setStart=function(t,e){var i;\"number\"==typeof t?this.start=Math.min(t,this.stop-this.size):(i=parseFloat(t),isNaN(i)||(this.start=Math.min(i,this.stop-this.size))),this.value=Math.max(this.value,this.start),e||this.updateTarget(),this.drawNew(),this.changed()},SliderMorph.prototype.setStop=function(t,e){var i;\"number\"==typeof t?this.stop=Math.max(t,this.start+this.size):(i=parseFloat(t),isNaN(i)||(this.stop=Math.max(i,this.start+this.size))),this.value=Math.min(this.value,this.stop),e||this.updateTarget(),this.drawNew(),this.changed()},SliderMorph.prototype.setSize=function(t,e){var i;\"number\"==typeof t?this.size=Math.min(Math.max(t,1),this.stop-this.start):(i=parseFloat(t),isNaN(i)||(this.size=Math.min(Math.max(i,1),this.stop-this.start))),this.value=Math.min(this.value,this.stop-this.size),e||this.updateTarget(),this.drawNew(),this.changed()},SliderMorph.prototype.setTarget=function(){var t=this.overlappedMorphs(),e=new MenuMorph(this,\"choose target:\"),i=this;t.push(this.world()),t.forEach((function(t){e.addItem(t.toString().slice(0,50),(function(){i.target=t,i.setTargetSetter()}))})),1===t.length?(this.target=t[0],this.setTargetSetter()):t.length>0&&e.popUpAtHand(this.world())},SliderMorph.prototype.setTargetSetter=function(){var t=this.target.numericalSetters(),e=new MenuMorph(this,\"choose target property:\"),i=this;t.forEach((function(t){e.addItem(t,(function(){i.action=t}))})),1===t.length?this.action=t[0]:t.length>0&&e.popUpAtHand(this.world())},SliderMorph.prototype.numericalSetters=function(){var t=SliderMorph.uber.numericalSetters.call(this);return t.push(\"setStart\",\"setStop\",\"setSize\"),t},SliderMorph.prototype.step=null,SliderMorph.prototype.mouseDownLeft=function(t){var e,i=this;this.button.bounds.containsPoint(t)?this.offset=t.subtract(this.button.bounds.origin):this.offset=new Point,e=this.root(),this.step=function(){var t,o,r;e.hand.mouseButton?(t=e.hand.bounds.origin,\"vertical\"===i.orientation?(o=i.button.bounds.origin.x,r=Math.max(Math.min(t.y-i.offset.y,i.bottom()-i.button.height()),i.top())):(r=i.button.bounds.origin.y,o=Math.max(Math.min(t.x-i.offset.x,i.right()-i.button.width()),i.left())),i.button.setPosition(new Point(o,r)),i.updateValue()):this.step=null}},MouseSensorMorph.prototype=new BoxMorph,MouseSensorMorph.prototype.constructor=MouseSensorMorph,MouseSensorMorph.uber=BoxMorph.prototype,MouseSensorMorph.prototype.init=function(t,e,i){MouseSensorMorph.uber.init.call(this),this.edge=t||4,this.border=e||2,this.color=new Color(255,255,255),this.borderColor=i||new Color,this.isTouched=!1,this.upStep=.05,this.downStep=.02,this.noticesTransparentClick=!1,this.drawNew()},MouseSensorMorph.prototype.touch=function(){var t=this;this.isTouched||(this.isTouched=!0,this.alpha=.6,this.step=function(){t.isTouched?t.alpha<1&&(t.alpha=t.alpha+t.upStep):t.alpha>t.downStep?t.alpha=t.alpha-t.downStep:(t.alpha=0,t.step=null),t.changed()})},MouseSensorMorph.prototype.unTouch=function(){this.isTouched=!1},MouseSensorMorph.prototype.mouseEnter=function(){this.touch()},MouseSensorMorph.prototype.mouseLeave=function(){this.unTouch()},MouseSensorMorph.prototype.mouseDownLeft=function(){this.touch()},MouseSensorMorph.prototype.mouseClickLeft=function(){this.unTouch()},InspectorMorph.prototype=new BoxMorph,InspectorMorph.prototype.constructor=InspectorMorph,InspectorMorph.uber=BoxMorph.prototype,InspectorMorph.prototype.init=function(t){this.target=t,this.currentProperty=null,this.showing=\"attributes\",this.markOwnProperties=!1,this.hasUserEditedDetails=!1,InspectorMorph.uber.init.call(this),this.silentSetExtent(new Point(20*MorphicPreferences.handleSize,20*MorphicPreferences.handleSize*2/3)),this.isDraggable=!0,this.border=1,this.edge=MorphicPreferences.isFlat?1:5,this.color=new Color(60,60,60),this.borderColor=new Color(95,95,95),this.fps=25,this.drawNew(),this.label=null,this.list=null,this.detail=null,this.work=null,this.buttonInspect=null,this.buttonClose=null,this.buttonSubset=null,this.buttonEdit=null,this.resizer=null,this.target&&this.buildPanes()},InspectorMorph.prototype.setTarget=function(t){this.target=t,this.currentProperty=null,this.buildPanes()},InspectorMorph.prototype.updateCurrentSelection=function(){var t,e,i,o=this.list.selected,r=this.detail.contents.children[0],n=this.root();n&&n.keyboardReceiver instanceof CursorMorph&&n.keyboardReceiver.target===r?this.hasUserEditedDetails=!0:isNil(o)||this.hasUserEditedDetails||(t=this.target[o],this.currentProperty=t,e=isNil(t)?\"NULL\":isString(t)?t:t.toString(),r.text!==e&&((i=new TextMorph(e)).isEditable=!0,i.enableSelecting(),i.setReceiver(this.target),this.detail.setContents(i)))},InspectorMorph.prototype.buildPanes=function(){var t,e,i,o,r=[],n=this;for(t in this.children.forEach((function(t){t!==this.work&&t.destroy()})),this.children=[],this.label=new TextMorph(this.target.toString()),this.label.fontSize=MorphicPreferences.menuFontSize,this.label.isBold=!0,this.label.color=new Color(255,255,255),this.label.drawNew(),this.add(this.label),this.target)t&&r.push(t);\"attributes\"===this.showing?r=r.filter((function(t){return\"function\"!=typeof n.target[t]})):\"methods\"===this.showing&&(r=r.filter((function(t){return\"function\"==typeof n.target[t]}))),o=function(){var t,e;isObject(n.currentProperty)&&(t=n.world(),(e=new InspectorMorph(n.currentProperty)).setPosition(t.hand.position()),e.keepWithin(t),t.add(e),e.changed())},this.list=new ListMorph(this.target instanceof Array?r:r.sort(),null,this.markOwnProperties?[[new Color(0,0,180),function(t){return Object.prototype.hasOwnProperty.call(n.target,t)}]]:null,o),this.list.action=function(){n.hasUserEditedDetails=!1,n.updateCurrentSelection()},this.list.hBar.alpha=.6,this.list.vBar.alpha=.6,this.list.contents.step=null,this.add(this.list),this.detail=new ScrollFrameMorph,this.detail.acceptsDrops=!1,this.detail.contents.acceptsDrops=!1,this.detail.isTextLineWrapping=!0,this.detail.color=new Color(255,255,255),this.detail.hBar.alpha=.6,this.detail.vBar.alpha=.6,(e=new TextMorph(\"\")).isEditable=!0,e.enableSelecting(),e.setReceiver(this.target),this.detail.setContents(e),this.add(this.detail),null===this.work&&(this.work=new ScrollFrameMorph,this.work.acceptsDrops=!1,this.work.contents.acceptsDrops=!1,this.work.isTextLineWrapping=!0,this.work.color=new Color(255,255,255),this.work.hBar.alpha=.6,this.work.vBar.alpha=.6,(i=new TextMorph(\"\")).isEditable=!0,i.enableSelecting(),i.setReceiver(this.target),this.work.setContents(i)),this.add(this.work),this.buttonSubset=new TriggerMorph,this.buttonSubset.labelString=\"show...\",this.buttonSubset.action=function(){var t;(t=new MenuMorph).addItem(\"attributes\",(function(){n.showing=\"attributes\",n.buildPanes()})),t.addItem(\"methods\",(function(){n.showing=\"methods\",n.buildPanes()})),t.addItem(\"all\",(function(){n.showing=\"all\",n.buildPanes()})),t.addLine(),t.addItem(n.markOwnProperties?\"un-mark own\":\"mark own\",(function(){n.markOwnProperties=!n.markOwnProperties,n.buildPanes()}),\"highlight\\n'own' properties\"),t.popUpAtHand(n.world())},this.add(this.buttonSubset),this.buttonInspect=new TriggerMorph,this.buttonInspect.labelString=\"inspect...\",this.buttonInspect.action=function(){var t,e,i;isObject(n.currentProperty)?((t=new MenuMorph).addItem(\"in new inspector...\",(function(){e=n.world(),(i=new InspectorMorph(n.currentProperty)).setPosition(e.hand.position()),i.keepWithin(e),e.add(i),i.changed()})),t.addItem(\"here...\",(function(){n.setTarget(n.currentProperty)})),t.popUpAtHand(n.world())):n.inform((null===n.currentProperty?\"null\":typeof n.currentProperty)+\"\\nis not inspectable\")},this.add(this.buttonInspect),this.buttonEdit=new TriggerMorph,this.buttonEdit.labelString=\"edit...\",this.buttonEdit.action=function(){var t;(t=new MenuMorph(n)).addItem(\"save\",\"save\",\"accept changes\"),t.addLine(),t.addItem(\"add property...\",\"addProperty\"),t.addItem(\"rename...\",\"renameProperty\"),t.addItem(\"remove...\",\"removeProperty\"),t.popUpAtHand(n.world())},this.add(this.buttonEdit),this.buttonClose=new TriggerMorph,this.buttonClose.labelString=\"close\",this.buttonClose.action=function(){n.destroy()},this.add(this.buttonClose),this.resizer=new HandleMorph(this,150,100,this.edge,this.edge),this.fixLayout()},InspectorMorph.prototype.fixLayout=function(){var t,e,i,o;Morph.prototype.trackChanges=!1,t=this.left()+this.edge,e=this.top()+this.edge,i=this.right()-this.edge-t,this.label.setPosition(new Point(t,e)),this.label.setWidth(i),this.label.height()>this.height()-50&&(this.silentSetHeight(this.label.height()+50),this.drawNew(),this.changed(),this.resizer.drawNew()),e=this.label.bottom()+2,i=Math.min(Math.floor(this.width()/3),this.list.listContents.width()),i-=this.edge,o=this.bottom()-2*this.edge-MorphicPreferences.handleSize-e,this.list.setPosition(new Point(t,e)),this.list.setExtent(new Point(i,o)),t=this.list.right()+this.edge,i=this.right()-this.edge-t,this.detail.setPosition(new Point(t,e)),this.detail.setExtent(new Point(i,2*o/3-this.edge)),e=this.detail.bottom()+this.edge,this.work.setPosition(new Point(t,e)),this.work.setExtent(new Point(i,o/3)),t=this.list.left(),e=this.list.bottom()+this.edge,i=this.list.width(),o=MorphicPreferences.handleSize,this.buttonSubset.setPosition(new Point(t,e)),this.buttonSubset.setExtent(new Point(i,o)),t=this.detail.left(),i=(i=this.detail.width()-this.edge-MorphicPreferences.handleSize)/3-this.edge/3,this.buttonInspect.setPosition(new Point(t,e)),this.buttonInspect.setExtent(new Point(i,o)),t=this.buttonInspect.right()+this.edge,this.buttonEdit.setPosition(new Point(t,e)),this.buttonEdit.setExtent(new Point(i,o)),t=this.buttonEdit.right()+this.edge,i=this.detail.right()-this.edge-MorphicPreferences.handleSize-t,this.buttonClose.setPosition(new Point(t,e)),this.buttonClose.setExtent(new Point(i,o)),Morph.prototype.trackChanges=!0,this.changed()},InspectorMorph.prototype.setExtent=function(t){InspectorMorph.uber.setExtent.call(this,t),this.fixLayout()},InspectorMorph.prototype.save=function(){var t=this.detail.contents.children[0].text.toString(),e=this.list.selected;try{this.target.evaluateString(\"this.\"+e+\" = \"+t),this.hasUserEditedDetails=!1,this.target.drawNew&&(this.target.changed(),this.target.drawNew(),this.target.changed())}catch(t){this.inform(t)}},InspectorMorph.prototype.addProperty=function(){var t=this;this.prompt(\"new property name:\",(function(e){e&&(t.target[e]=null,t.buildPanes(),t.target.drawNew&&(t.target.changed(),t.target.drawNew(),t.target.changed()))}),this,\"property\")},InspectorMorph.prototype.renameProperty=function(){var t=this,e=this.list.selected;this.prompt(\"property name:\",(function(i){try{delete t.target[e],t.target[i]=t.currentProperty}catch(e){t.inform(e)}t.buildPanes(),t.target.drawNew&&(t.target.changed(),t.target.drawNew(),t.target.changed())}),this,e)},InspectorMorph.prototype.removeProperty=function(){var t=this.list.selected;try{delete this.target[t],this.currentProperty=null,this.buildPanes(),this.target.drawNew&&(this.target.changed(),this.target.drawNew(),this.target.changed())}catch(t){this.inform(t)}},InspectorMorph.prototype.step=function(){this.updateCurrentSelection();var t=this.target.toString();this.label.text!==t&&(this.label.text=t,this.label.drawNew(),this.fixLayout())},InspectorMorph.prototype.updateReferences=function(t){var e=this.list.activeIndex();InspectorMorph.uber.updateReferences.call(this,t),this.buildPanes(),this.list.activateIndex(e)},MenuMorph.prototype=new BoxMorph,MenuMorph.prototype.constructor=MenuMorph,MenuMorph.uber=BoxMorph.prototype,MenuMorph.prototype.init=function(t,e,i,o){this.target=t,this.title=e||null,this.environment=i||null,this.fontSize=o||null,this.items=[],this.label=null,this.world=null,this.isListContents=!1,this.hasFocus=!1,this.selection=null,this.submenu=null,MenuMorph.uber.init.call(this),this.isDraggable=!1,this.border=null,this.edge=null},MenuMorph.prototype.addItem=function(t,e,i,o,r,n,s,h,a){this.items.push([a?t||\"close\":localize(t||\"close\"),e||nop,i,o,r||!1,n||!1,s,h,a])},MenuMorph.prototype.addMenu=function(t,e,i,o){this.addPair(t,e,isNil(i)?\"►\":i,null,o)},MenuMorph.prototype.addPair=function(t,e,i,o,r){this.addItem(t,e,o,null,null,null,null,i,r)},MenuMorph.prototype.addLine=function(t){this.items.push([0,t||1])},MenuMorph.prototype.createLabel=function(){var t;null!==this.label&&this.label.destroy(),(t=new TextMorph(localize(this.title),this.fontSize||MorphicPreferences.menuFontSize,MorphicPreferences.menuFontName,!0,!1,\"center\")).alignment=\"center\",t.color=new Color(255,255,255),t.backgroundColor=this.borderColor,t.drawNew(),this.label=new BoxMorph(3,0),MorphicPreferences.isFlat&&(this.label.edge=0),this.label.color=this.borderColor,this.label.borderColor=this.borderColor,this.label.setExtent(t.extent().add(4)),this.label.drawNew(),this.label.add(t),this.label.text=t},MenuMorph.prototype.drawNew=function(){var t,e,i,o,r=this,n=!1;this.children.forEach((function(t){t.destroy()})),this.children=[],this.isListContents||(this.edge=MorphicPreferences.isFlat?0:5,this.border=MorphicPreferences.isFlat?1:2),this.color=new Color(255,255,255),this.borderColor=new Color(60,60,60),this.silentSetExtent(new Point(0,0)),o=2,i=this.left()+4,this.isListContents||(this.title?(this.createLabel(),this.label.setPosition(this.bounds.origin.add(4)),this.add(this.label),o=this.label.bottom()):o=this.top()+4),o+=1,this.items.forEach((function(e){n=!1,e instanceof StringFieldMorph||e instanceof ColorPickerMorph||e instanceof SliderMorph||e instanceof DialMorph?t=e:0===e[0]?(n=!0,(t=new Morph).color=r.borderColor,t.setHeight(e[1])):t=new MenuItemMorph(r.target,e[1],e[0],r.fontSize||MorphicPreferences.menuFontSize,MorphicPreferences.menuFontName,r.environment,e[2],e[3],e[4],e[5],e[6],e[7]),n&&(o+=1),t.setPosition(new Point(i,o)),r.add(t),o+=t.height(),n&&(o+=1)})),e=this.fullBounds(),this.silentSetExtent(e.extent().add(4)),this.adjustWidths(),MenuMorph.uber.drawNew.call(this)},MenuMorph.prototype.maxWidth=function(){var t=0;return this.parent instanceof FrameMorph&&this.parent.scrollFrame instanceof ScrollFrameMorph&&(t=this.parent.scrollFrame.width()),this.children.forEach((function(e){e instanceof MenuItemMorph?t=Math.max(t,e.label.width()+8+(e.shortcut?e.shortcut.width()+4:0)):(e instanceof StringFieldMorph||e instanceof ColorPickerMorph||e instanceof SliderMorph||e instanceof DialMorph)&&(t=Math.max(t,e.width()))})),this.label&&(t=Math.max(t,this.label.width())),t},MenuMorph.prototype.adjustWidths=function(){var t,e=this.maxWidth(),i=this;this.children.forEach((function(o){o instanceof DialMorph||o.silentSetWidth(e),o instanceof MenuItemMorph?(o.fixLayout(),t=o.image===o.pressImage,o.createBackgrounds(),t&&(o.image=o.pressImage)):(o.drawNew(),o===i.label&&o.text.setPosition(o.center().subtract(o.text.extent().floorDivideBy(2))))}))},MenuMorph.prototype.unselectAllItems=function(){this.children.forEach((function(t){t instanceof MenuItemMorph?t.image=t.normalImage:t instanceof ScrollFrameMorph&&t.contents.children.forEach((function(t){t instanceof MenuItemMorph&&(t.image=t.normalImage)}))})),this.changed()},MenuMorph.prototype.popup=function(t,e){var i;this.drawNew(),this.setPosition(e),this.addShadow(new Point(2,2),80),this.keepWithin(t),this.bottom()>t.bottom()&&(this.removeShadow(),i=this.scroll(),this.bounds.corner.y=t.bottom()-2,MenuMorph.uber.drawNew.call(this),this.addShadow(new Point(2,2),80),i.setHeight(t.bottom()-i.top()-6),i.adjustScrollBars()),t.activeMenu&&t.activeMenu.destroy(),this.items.length<1&&!this.title||(t.add(this),t.activeMenu=this,this.world=t,this.fullChanged())},MenuMorph.prototype.scroll=function(){var t=new ScrollFrameMorph,e=this.label?1:0,i=this.children[e];return t.setPosition(i.position()),this.children.slice(e).forEach((function(e){t.addContents(e)})),this.add(t),t.setWidth(i.width()),t},MenuMorph.prototype.popUpAtHand=function(t){var e=t||this.world;this.popup(e,e.hand.position())},MenuMorph.prototype.popUpCenteredAtHand=function(t){var e=t||this.world;this.drawNew(),this.popup(e,e.hand.position().subtract(this.extent().floorDivideBy(2)))},MenuMorph.prototype.popUpCenteredInWorld=function(t){var e=t||this.world;this.drawNew(),this.popup(e,e.center().subtract(this.extent().floorDivideBy(2)))},MenuMorph.prototype.closeRootMenu=function(){this.parent instanceof MenuMorph?this.parent.closeRootMenu():this.destroy()},MenuMorph.prototype.closeSubmenu=function(){this.submenu&&(this.submenu.destroy(),this.submenu=null,this.unselectAllItems())},MenuMorph.prototype.getFocus=function(){this.world.keyboardReceiver=this,this.selection=null,this.selectFirst(),this.hasFocus=!0},MenuMorph.prototype.processKeyDown=function(t){switch(t.keyCode){case 13:case 32:return void(this.selection&&(this.selection.mouseClickLeft(),this.submenu&&this.submenu.getFocus()));case 27:return this.destroy();case 37:return this.leaveSubmenu();case 38:return this.selectUp();case 39:return this.enterSubmenu();case 40:return this.selectDown();default:nop()}},MenuMorph.prototype.processKeyUp=function(t){nop(t)},MenuMorph.prototype.processKeyPress=function(t){nop(t)},MenuMorph.prototype.selectFirst=function(){var t,e,i;for(e=(t=detect(this.children,(function(t){return t instanceof ScrollFrameMorph})))?t.contents.children:this.children,i=0;i<e.length;i+=1)if(e[i]instanceof MenuItemMorph)return void this.select(e[i])},MenuMorph.prototype.selectUp=function(){var t,e,i;e=((t=detect(this.children,(function(t){return t instanceof ScrollFrameMorph})))?t.contents.children:this.children).filter((function(t){return t instanceof MenuItemMorph})),this.selection?((i=e.indexOf(this.selection)-1)<0&&(i=e.length-1),this.select(e[i])):e.length&&this.select(e[0])},MenuMorph.prototype.selectDown=function(){var t,e,i;e=((t=detect(this.children,(function(t){return t instanceof ScrollFrameMorph})))?t.contents.children:this.children).filter((function(t){return t instanceof MenuItemMorph})),this.selection?((i=e.indexOf(this.selection)+1)>=e.length&&(i=0),this.select(e[i])):e.length&&this.select(e[0])},MenuMorph.prototype.enterSubmenu=function(){this.selection&&this.selection.action instanceof MenuMorph&&(this.selection.popUpSubmenu(),this.submenu&&this.submenu.getFocus())},MenuMorph.prototype.leaveSubmenu=function(){var t=this.parent;this.parent instanceof MenuMorph&&(t.submenu=null,t.hasFocus=!0,this.destroy(),t.world.keyboardReceiver=t)},MenuMorph.prototype.select=function(t){this.unselectAllItems(),t.image=t.highlightImage,t.changed(),t.scrollIntoView(),this.selection=t},MenuMorph.prototype.destroy=function(){this.hasFocus&&(this.world.keyboardReceiver=null),MenuMorph.uber.destroy.call(this)},StringMorph.prototype=new Morph,StringMorph.prototype.constructor=StringMorph,StringMorph.uber=Morph.prototype,StringMorph.prototype.measureCtx=newCanvas().getContext(\"2d\"),StringMorph.prototype.init=function(t,e,i,o,r,n,s,h,a,l){this.text=t||(\"\"===t?\"\":\"StringMorph\"),this.fontSize=e||12,this.fontName=l||MorphicPreferences.globalFontFamily,this.fontStyle=i||\"sans-serif\",this.isBold=o||!1,this.isItalic=r||!1,this.isEditable=!1,this.enableLinks=!1,this.isNumeric=n||!1,this.isPassword=!1,this.shadowOffset=s||new Point(0,0),this.shadowColor=h||null,this.isShowingBlanks=!1,this.blanksColor=new Color(180,140,140),this.isScrollable=!0,this.currentlySelecting=!1,this.startMark=0,this.endMark=0,this.markedTextColor=new Color(255,255,255),this.markedBackgoundColor=new Color(60,60,120),StringMorph.uber.init.call(this,!0),this.color=a||new Color(0,0,0),this.noticesTransparentClick=!0,this.drawNew()},StringMorph.prototype.toString=function(){return\"a \"+(this.constructor.name||this.constructor.toString().split(\" \")[1].split(\"(\")[0])+'(\"'+this.text.slice(0,30)+'...\")'},StringMorph.prototype.password=function(t,e){var i,o=\"\";for(i=0;i<e;i+=1)o+=t;return o},StringMorph.prototype.font=function(){var t=\"\";return this.isBold&&(t+=\"bold \"),this.isItalic&&(t+=\"italic \"),t+this.fontSize+\"px \"+(this.fontName?this.fontName+\", \":\"\")+this.fontStyle},StringMorph.prototype.drawNew=function(){var t,e,i,o,r,n,s,h,a,l=this.shadowOffset||new Point,p=this.isPassword?this.password(\"*\",this.text.length):this.text;for(this.measureCtx.font=this.font(),e=Math.max(this.measureCtx.measureText(p).width+Math.abs(l.x),1),this.bounds.corner=this.bounds.origin.add(new Point(e,fontHeight(this.fontSize)+Math.abs(l.y))),this.image=newCanvas(this.extent(),!1,this.image),(t=this.image.getContext(\"2d\")).font=this.font(),t.textAlign=\"left\",t.textBaseline=\"bottom\",this.shadowColor&&(h=Math.max(l.x,0),a=Math.max(l.y,0),t.fillStyle=this.shadowColor.toString(),t.fillText(p,h,fontHeight(this.fontSize)+a)),h=Math.abs(Math.min(l.x,0)),a=Math.abs(Math.min(l.y,0)),t.fillStyle=this.color.toString(),this.isShowingBlanks?this.renderWithBlanks(t,h,fontHeight(this.fontSize)+a):t.fillText(p,h,fontHeight(this.fontSize)+a),i=Math.min(this.startMark,this.endMark),o=Math.max(this.startMark,this.endMark),r=i;r<o;r+=1)n=this.slotPosition(r).subtract(this.position()),s=p.charAt(r),t.fillStyle=this.markedBackgoundColor.toString(),t.fillRect(n.x,n.y,t.measureText(s).width+1+h,fontHeight(this.fontSize)+a),t.fillStyle=this.markedTextColor.toString(),t.fillText(s,n.x+h,fontHeight(this.fontSize)+a);this.parent&&this.parent.fixLayout&&this.parent.fixLayout()},StringMorph.prototype.renderWithBlanks=function(t,e,i){var o=t.measureText(\" \").width,r=newCanvas(new Point(o,this.height())),n=r.getContext(\"2d\"),s=this.text.split(\" \"),h=e||0,a=!0;n.fillStyle=this.blanksColor.toString(),n.arc(o/2,r.height/2,o/2,radians(0),radians(360)),n.fill(),s.forEach((function(e){a||(t.drawImage(r,h,0),h+=o),a=!1,\"\"!==e&&(t.fillText(e,h,i),h+=t.measureText(e).width)}))},StringMorph.prototype.slotPosition=function(t){var e,i,o=this.isPassword?this.password(\"*\",this.text.length):this.text,r=Math.min(Math.max(t,0),o.length),n=this.image.getContext(\"2d\");for(e=0,i=0;i<r;i+=1)e+=n.measureText(o[i]).width;return this.pos=r,new Point(this.left()+e,this.top())},StringMorph.prototype.slotAt=function(t){for(var e=this.isPassword?this.password(\"*\",this.text.length):this.text,i=0,o=0,r=this.image.getContext(\"2d\");t.x-this.left()>o;)if(o+=r.measureText(e[i]).width,(i+=1)===e.length&&r.measureText(e).width-r.measureText(e[i-1]).width/2<t.x-this.left())return i;return t.x-this.left()>o-r.measureText(e[i-1]).width/2?i:i-1},StringMorph.prototype.upFrom=function(t){return t},StringMorph.prototype.downFrom=function(t){return t},StringMorph.prototype.startOfLine=function(){return 0},StringMorph.prototype.endOfLine=function(){return this.text.length},StringMorph.prototype.previousWordFrom=function(t){for(var e=t-1;e>0&&!isWordChar(this.text[e]);)e-=1;for(;e>0&&isWordChar(this.text[e-1]);)e-=1;return e},StringMorph.prototype.nextWordFrom=function(t){for(var e=t;e<this.endOfLine()&&!isWordChar(this.text[e]);)e+=1;for(;e<this.endOfLine()&&isWordChar(this.text[e]);)e+=1;return e},StringMorph.prototype.rawHeight=function(){return this.height()/1.2},StringMorph.prototype.developersMenu=function(){var t=StringMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem(\"edit\",\"edit\"),t.addItem(\"font size...\",(function(){this.prompt(t.title+\"\\nfont\\nsize:\",this.setFontSize,this,this.fontSize.toString(),null,6,500,!0)}),\"set this String's\\nfont point size\"),\"serif\"!==this.fontStyle&&t.addItem(\"serif\",\"setSerif\"),\"sans-serif\"!==this.fontStyle&&t.addItem(\"sans-serif\",\"setSansSerif\"),this.isBold?t.addItem(\"normal weight\",\"toggleWeight\"):t.addItem(\"bold\",\"toggleWeight\"),this.isItalic?t.addItem(\"normal style\",\"toggleItalic\"):t.addItem(\"italic\",\"toggleItalic\"),this.isShowingBlanks?t.addItem(\"hide blanks\",\"toggleShowBlanks\"):t.addItem(\"show blanks\",\"toggleShowBlanks\"),this.isPassword?t.addItem(\"show characters\",\"toggleIsPassword\"):t.addItem(\"hide characters\",\"toggleIsPassword\"),t},StringMorph.prototype.toggleIsDraggable=function(){this.isDraggable=!this.isDraggable,this.isDraggable?this.disableSelecting():this.enableSelecting()},StringMorph.prototype.toggleShowBlanks=function(){this.isShowingBlanks=!this.isShowingBlanks,this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.toggleWeight=function(){this.isBold=!this.isBold,this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.toggleItalic=function(){this.isItalic=!this.isItalic,this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.toggleIsPassword=function(){this.isPassword=!this.isPassword,this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.setSerif=function(){this.fontStyle=\"serif\",this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.setSansSerif=function(){this.fontStyle=\"sans-serif\",this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.setFontSize=function(t){var e;\"number\"==typeof t?this.fontSize=Math.round(Math.min(Math.max(t,4),500)):(e=parseFloat(t),isNaN(e)||(this.fontSize=Math.round(Math.min(Math.max(e,4),500)))),this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.setText=function(t){this.text=Math.round(t).toString(),this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.numericalSetters=function(){return[\"setLeft\",\"setTop\",\"setAlphaScaled\",\"setFontSize\",\"setText\"]},StringMorph.prototype.edit=function(){this.root().edit(this)},StringMorph.prototype.selection=function(){var t,e;return t=Math.min(this.startMark,this.endMark),e=Math.max(this.startMark,this.endMark),this.text.slice(t,e)},StringMorph.prototype.selectionStartSlot=function(){return Math.min(this.startMark,this.endMark)},StringMorph.prototype.clearSelection=function(){!this.currentlySelecting&&isNil(this.startMark)&&isNil(this.endMark)||(this.currentlySelecting=!1,this.startMark=null,this.endMark=null,this.drawNew(),this.changed())},StringMorph.prototype.deleteSelection=function(){var t,e,i;i=this.text,t=Math.min(this.startMark,this.endMark),e=Math.max(this.startMark,this.endMark),this.text=i.slice(0,t)+i.slice(e),this.changed(),this.clearSelection()},StringMorph.prototype.selectAll=function(){var t;this.isEditable&&(this.startMark=0,t=this.root().cursor,this.endMark=this.text.length,t&&(t.gotoSlot(this.text.length),t.syncTextareaSelectionWith(this)),this.drawNew(),this.changed())},StringMorph.prototype.mouseDownLeft=function(t){16===this.world().currentKey?this.shiftClick(t):this.isEditable?this.clearSelection():this.escalateEvent(\"mouseDownLeft\",t)},StringMorph.prototype.shiftClick=function(t){var e=this.root().cursor;e&&(this.startMark||(this.startMark=e.slot),e.gotoPos(t),this.endMark=e.slot,e.syncTextareaSelectionWith(this),this.drawNew(),this.changed()),this.currentlySelecting=!1,this.escalateEvent(\"mouseDownLeft\",t)},StringMorph.prototype.mouseClickLeft=function(t){var e;if(this.isEditable)this.currentlySelecting||this.edit(),(e=this.root().cursor)&&e.gotoPos(t),this.currentlySelecting=!0;else if(this.enableLinks){var i,o,r,n=this.slotAt(t);for(n===this.text.length&&(n-=1),o=n;o>1&&isURLChar(this.text[o-1]);)o-=1;for(r=n;r<this.text.length-1&&isURLChar(this.text[r+1]);)r+=1;isURL(i=this.text.substring(o,r+1))?window.open(i,\"_blank\"):this.escalateEvent(\"mouseClickLeft\",t)}else this.escalateEvent(\"mouseClickLeft\",t)},StringMorph.prototype.mouseDoubleClick=function(t){var e=this.slotAt(t);this.isEditable?(this.edit(),e===this.text.length&&(e-=1),this.text[e]&&isWordChar(this.text[e])?this.selectWordAt(e):this.text[e]?this.selectBetweenWordsAt(e):this.selectAll(),this.root().cursor.syncTextareaSelectionWith(this)):this.escalateEvent(\"mouseDoubleClick\",t)},StringMorph.prototype.selectWordAt=function(t){var e=this.root().cursor;0===t||isWordChar(this.text[t-1])?(e.gotoSlot(this.previousWordFrom(t)),this.startMark=e.slot,this.endMark=this.nextWordFrom(e.slot)):(e.gotoSlot(t),this.startMark=t,this.endMark=this.nextWordFrom(t)),this.drawNew(),this.changed()},StringMorph.prototype.selectBetweenWordsAt=function(t){var e=this.root().cursor;for(e.gotoSlot(this.nextWordFrom(this.previousWordFrom(t))),this.startMark=e.slot,this.endMark=e.slot;this.endMark<this.text.length&&!isWordChar(this.text[this.endMark]);)this.endMark+=1;this.drawNew(),this.changed()},StringMorph.prototype.enableSelecting=function(){this.mouseDownLeft=function(t){var e=this.root().cursor,i=!!e&&e.target===this;16===this.world().currentKey?this.shiftClick(t):(this.clearSelection(),this.isEditable&&!this.isDraggable&&(this.edit(),this.root().cursor.gotoPos(t),this.startMark=this.slotAt(t),this.endMark=this.startMark,this.currentlySelecting=!0,this.root().cursor.syncTextareaSelectionWith(this),i||this.escalateEvent(\"mouseDownLeft\",t)))},this.mouseMove=function(t){if(this.isEditable&&this.currentlySelecting&&!this.isDraggable){var e=this.slotAt(t);e!==this.endMark&&(this.endMark=e,this.root().cursor.syncTextareaSelectionWith(this),this.drawNew(),this.changed())}}},StringMorph.prototype.disableSelecting=function(){this.mouseDownLeft=StringMorph.prototype.mouseDownLeft,delete this.mouseMove},TextMorph.prototype=new Morph,TextMorph.prototype.constructor=TextMorph,TextMorph.uber=Morph.prototype,TextMorph.prototype.measureCtx=StringMorph.prototype.measureCtx,TextMorph.prototype.init=function(t,e,i,o,r,n,s,h,a,l){this.text=t||(\"\"===t?t:\"TextMorph\"),this.words=[],this.lines=[],this.lineSlots=[],this.fontSize=e||12,this.fontName=h||MorphicPreferences.globalFontFamily,this.fontStyle=i||\"sans-serif\",this.isBold=o||!1,this.isItalic=r||!1,this.alignment=n||\"left\",this.shadowOffset=a||new Point(0,0),this.shadowColor=l||null,this.maxWidth=s||0,this.maxLineWidth=0,this.backgroundColor=null,this.isEditable=!1,this.enableLinks=!1,this.receiver=null,this.isScrollable=!0,this.currentlySelecting=!1,this.startMark=0,this.endMark=0,this.markedTextColor=new Color(255,255,255),this.markedBackgoundColor=new Color(60,60,120),TextMorph.uber.init.call(this),this.color=new Color(0,0,0),this.noticesTransparentClick=!0,this.drawNew()},TextMorph.prototype.toString=function(){return'a TextMorph(\"'+this.text.slice(0,30)+'...\")'},TextMorph.prototype.font=StringMorph.prototype.font,TextMorph.prototype.parse=function(){var t,e=this,i=this.text.split(\"\\n\"),o=this.measureCtx,r=\"\",n=0;o.font=this.font(),this.maxLineWidth=0,this.lines=[],this.lineSlots=[0],this.words=[],i.forEach((function(t){e.words=e.words.concat(t.split(\" \")),e.words.push(\"\\n\")})),this.words.forEach((function(i){\"\\n\"===i?(e.lines.push(r),e.lineSlots.push(n),e.maxLineWidth=Math.max(e.maxLineWidth,o.measureText(r).width),r=\"\"):(e.maxWidth>0?(t=r+i+\" \",o.measureText(t).width>e.maxWidth?(e.lines.push(r),e.lineSlots.push(n),e.maxLineWidth=Math.max(e.maxLineWidth,o.measureText(r).width),r=i+\" \"):r=t):r=r+i+\" \",n+=i.length+1)}))},TextMorph.prototype.drawNew=function(){var t,e,i,o,r,n,s,h,a,l,p,c,u,d,g;if(this.parse(),s=Math.abs(this.shadowOffset.x),n=Math.abs(this.shadowOffset.y),e=this.lines.length*(fontHeight(this.fontSize)+n),0===this.maxWidth?this.bounds=this.bounds.origin.extent(new Point(this.maxLineWidth+s,e)):this.bounds=this.bounds.origin.extent(new Point(this.maxWidth+s,e)),this.image=newCanvas(this.extent(),!1,this.image),(t=this.image.getContext(\"2d\")).font=this.font(),t.textAlign=\"left\",t.textBaseline=\"bottom\",this.backgroundColor&&(t.fillStyle=this.backgroundColor.toString(),t.fillRect(0,0,this.width(),this.height())),this.shadowColor)for(h=Math.max(this.shadowOffset.x,0),a=Math.max(this.shadowOffset.y,0),t.fillStyle=this.shadowColor.toString(),i=0;i<this.lines.length;i+=1)o=this.lines[i],r=t.measureText(o).width+s,l=\"right\"===this.alignment?this.width()-r:\"center\"===this.alignment?(this.width()-r)/2:0,p=(i+1)*(fontHeight(this.fontSize)+n)-n,t.fillText(o,l+h,p+a);for(h=Math.abs(Math.min(this.shadowOffset.x,0)),a=Math.abs(Math.min(this.shadowOffset.y,0)),t.fillStyle=this.color.toString(),i=0;i<this.lines.length;i+=1)o=this.lines[i],r=t.measureText(o).width+s,l=\"right\"===this.alignment?this.width()-r:\"center\"===this.alignment?(this.width()-r)/2:0,p=(i+1)*(fontHeight(this.fontSize)+n)-n,t.fillText(o,l+h,p+a);for(c=Math.min(this.startMark,this.endMark),u=Math.max(this.startMark,this.endMark),i=c;i<u;i+=1)d=this.slotPosition(i).subtract(this.position()),g=this.text.charAt(i),t.fillStyle=this.markedBackgoundColor.toString(),t.fillRect(d.x,d.y,t.measureText(g).width+1,fontHeight(this.fontSize)),t.fillStyle=this.markedTextColor.toString(),t.fillText(g,d.x,d.y+fontHeight(this.fontSize));this.parent&&this.parent.layoutChanged&&this.parent.layoutChanged()},TextMorph.prototype.setExtent=function(t){this.maxWidth=Math.max(t.x,0),this.changed(),this.drawNew()},TextMorph.prototype.columnRow=function(t){var e,i,o=0;for(e=0;e<this.lines.length;e+=1)for(o=this.lineSlots[e],i=0;i<this.lines[e].length;i+=1){if(o===t)return new Point(i,e);o+=1}return new Point(this.lines[this.lines.length-1].length-1,this.lines.length-1)},TextMorph.prototype.slotPosition=function(t){var e,i,o=this.columnRow(t),r=this.image.getContext(\"2d\"),n=Math.abs(this.shadowOffset.y),s=0;for(e=o.y*(fontHeight(this.fontSize)+n),i=0;i<o.x;i+=1)s+=r.measureText(this.lines[o.y][i]).width;return new Point(this.left()+s,this.top()+e)},TextMorph.prototype.slotAt=function(t){for(var e,i,o,r=0,n=0,s=Math.abs(this.shadowOffset.y),h=this.image.getContext(\"2d\");t.y-this.top()>(fontHeight(this.fontSize)+s)*r;)r+=1;for(r=Math.max(r,1),o=h.measureText(this.lines[r-1]).width,e=\"right\"===this.alignment?this.width()-o:\"center\"===this.alignment?(this.width()-o)/2:0,i=this.lines[r-1].length;n<i-2&&t.x-this.left()>e;)e+=h.measureText(this.lines[r-1][n]).width,n+=1;return t.x-this.left()>e-h.measureText(this.lines[r-1][n]).width/2?this.lineSlots[Math.max(r-1,0)]+n:this.lineSlots[Math.max(r-1,0)]+n-1},TextMorph.prototype.upFrom=function(t){var e,i=this.columnRow(t);return i.y<1?t:(e=this.lines[i.y-1]).length<i.x-1?this.lineSlots[i.y-1]+e.length:this.lineSlots[i.y-1]+i.x},TextMorph.prototype.downFrom=function(t){var e,i=this.columnRow(t);return i.y>this.lines.length-2?t:(e=this.lines[i.y+1]).length<i.x-1?this.lineSlots[i.y+1]+e.length:this.lineSlots[i.y+1]+i.x},TextMorph.prototype.startOfLine=function(t){return this.lineSlots[this.columnRow(t).y]},TextMorph.prototype.endOfLine=function(t){return this.startOfLine(t)+this.lines[this.columnRow(t).y].length-1},TextMorph.prototype.previousWordFrom=StringMorph.prototype.previousWordFrom,TextMorph.prototype.nextWordFrom=StringMorph.prototype.nextWordFrom,TextMorph.prototype.edit=StringMorph.prototype.edit,TextMorph.prototype.selection=StringMorph.prototype.selection,TextMorph.prototype.selectionStartSlot=StringMorph.prototype.selectionStartSlot,TextMorph.prototype.clearSelection=StringMorph.prototype.clearSelection,TextMorph.prototype.deleteSelection=StringMorph.prototype.deleteSelection,TextMorph.prototype.selectAll=StringMorph.prototype.selectAll,TextMorph.prototype.mouseDownLeft=StringMorph.prototype.mouseDownLeft,TextMorph.prototype.shiftClick=StringMorph.prototype.shiftClick,TextMorph.prototype.mouseClickLeft=StringMorph.prototype.mouseClickLeft,TextMorph.prototype.mouseDoubleClick=StringMorph.prototype.mouseDoubleClick,TextMorph.prototype.selectWordAt=StringMorph.prototype.selectWordAt,TextMorph.prototype.selectBetweenWordsAt=StringMorph.prototype.selectBetweenWordsAt,TextMorph.prototype.enableSelecting=StringMorph.prototype.enableSelecting,TextMorph.prototype.disableSelecting=StringMorph.prototype.disableSelecting,TextMorph.prototype.selectAllAndEdit=function(){this.edit(),this.selectAll()},TextMorph.prototype.developersMenu=function(){var t=TextMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem(\"edit\",\"edit\"),t.addItem(\"font size...\",(function(){this.prompt(t.title+\"\\nfont\\nsize:\",this.setFontSize,this,this.fontSize.toString(),null,6,100,!0)}),\"set this Text's\\nfont point size\"),\"left\"!==this.alignment&&t.addItem(\"align left\",\"setAlignmentToLeft\"),\"right\"!==this.alignment&&t.addItem(\"align right\",\"setAlignmentToRight\"),\"center\"!==this.alignment&&t.addItem(\"align center\",\"setAlignmentToCenter\"),t.addLine(),\"serif\"!==this.fontStyle&&t.addItem(\"serif\",\"setSerif\"),\"sans-serif\"!==this.fontStyle&&t.addItem(\"sans-serif\",\"setSansSerif\"),this.isBold?t.addItem(\"normal weight\",\"toggleWeight\"):t.addItem(\"bold\",\"toggleWeight\"),this.isItalic?t.addItem(\"normal style\",\"toggleItalic\"):t.addItem(\"italic\",\"toggleItalic\"),t},TextMorph.prototype.setAlignmentToLeft=function(){this.alignment=\"left\",this.drawNew(),this.changed()},TextMorph.prototype.setAlignmentToRight=function(){this.alignment=\"right\",this.drawNew(),this.changed()},TextMorph.prototype.setAlignmentToCenter=function(){this.alignment=\"center\",this.drawNew(),this.changed()},TextMorph.prototype.toggleIsDraggable=StringMorph.prototype.toggleIsDraggable,TextMorph.prototype.toggleWeight=StringMorph.prototype.toggleWeight,TextMorph.prototype.toggleItalic=StringMorph.prototype.toggleItalic,TextMorph.prototype.setSerif=StringMorph.prototype.setSerif,TextMorph.prototype.setSansSerif=StringMorph.prototype.setSansSerif,TextMorph.prototype.setText=StringMorph.prototype.setText,TextMorph.prototype.setFontSize=StringMorph.prototype.setFontSize,TextMorph.prototype.numericalSetters=StringMorph.prototype.numericalSetters,TextMorph.prototype.evaluationMenu=function(){var t=new MenuMorph(this,null);return t.addItem(\"do it\",\"doIt\",\"evaluate the\\nselected expression\"),t.addItem(\"show it\",\"showIt\",\"evaluate the\\nselected expression\\nand show the result\"),t.addItem(\"inspect it\",\"inspectIt\",\"evaluate the\\nselected expression\\nand inspect the result\"),t.addLine(),t.addItem(\"select all\",\"selectAllAndEdit\"),t},TextMorph.prototype.setReceiver=function(t){this.receiver=t,this.customContextMenu=this.evaluationMenu()},TextMorph.prototype.doIt=function(){this.receiver.evaluateString(this.selection()),this.edit()},TextMorph.prototype.showIt=function(){var t=this.receiver.evaluateString(this.selection());null!==t&&this.inform(t)},TextMorph.prototype.inspectIt=function(){var t,e=this.receiver.evaluateString(this.selection()),i=this.world();isObject(e)&&((t=new InspectorMorph(e)).setPosition(i.hand.position()),t.keepWithin(i),i.add(t),t.changed())},TriggerMorph.prototype=new Morph,TriggerMorph.prototype.constructor=TriggerMorph,TriggerMorph.uber=Morph.prototype,TriggerMorph.prototype.init=function(t,e,i,o,r,n,s,h,a,l,p){this.target=t||null,this.action=e||null,this.doubleClickAction=p||null,this.environment=n||null,this.labelString=i||null,this.label=null,this.hint=s||null,this.schedule=null,this.fontSize=o||MorphicPreferences.menuFontSize,this.fontStyle=r||\"sans-serif\",this.highlightColor=new Color(192,192,192),this.pressColor=new Color(128,128,128),this.labelColor=h||new Color(0,0,0),this.labelBold=a||!1,this.labelItalic=l||!1,TriggerMorph.uber.init.call(this),this.color=new Color(255,255,255),this.drawNew()},TriggerMorph.prototype.drawNew=function(){this.createBackgrounds(),null!==this.labelString&&this.createLabel()},TriggerMorph.prototype.createBackgrounds=function(){var t,e=this.extent();this.normalImage=newCanvas(e,!1,this.normalImage),(t=this.normalImage.getContext(\"2d\")).fillStyle=this.color.toString(),t.fillRect(0,0,e.x,e.y),this.highlightImage=newCanvas(e,!1,this.highlightImage),(t=this.highlightImage.getContext(\"2d\")).fillStyle=this.highlightColor.toString(),t.fillRect(0,0,e.x,e.y),this.pressImage=newCanvas(e,!1,this.pressImage),(t=this.pressImage.getContext(\"2d\")).fillStyle=this.pressColor.toString(),t.fillRect(0,0,e.x,e.y),this.image=this.normalImage},TriggerMorph.prototype.createLabel=function(){null!==this.label&&this.label.destroy(),this.label=new StringMorph(this.labelString,this.fontSize,this.fontStyle,this.labelBold,this.labelItalic,!1,null,null,this.labelColor),this.label.setPosition(this.center().subtract(this.label.extent().floorDivideBy(2))),this.add(this.label)},TriggerMorph.prototype.trigger=function(){this.schedule&&(this.schedule.isActive=!1),\"function\"==typeof this.target?\"function\"==typeof this.action?this.target.call(this.environment,this.action.call(),this):this.target.call(this.environment,this.action,this):\"function\"==typeof this.action?this.action.call(this.target):this.target[this.action]()},TriggerMorph.prototype.triggerDoubleClick=function(){this.doubleClickAction&&(this.schedule&&(this.schedule.isActive=!1),\"function\"==typeof this.target?\"function\"==typeof this.doubleClickAction?this.target.call(this.environment,this.doubleClickAction.call(),this):this.target.call(this.environment,this.doubleClickAction,this):\"function\"==typeof this.doubleClickAction?this.doubleClickAction.call(this.target):this.target[this.doubleClickAction]())},TriggerMorph.prototype.mouseEnter=function(){var t=this.hint instanceof Function?this.hint():this.hint;this.image=this.highlightImage,this.changed(),t&&this.bubbleHelp(t)},TriggerMorph.prototype.mouseLeave=function(){this.image=this.normalImage,this.changed(),this.schedule&&(this.schedule.isActive=!1),this.hint&&this.world().hand.destroyTemporaries()},TriggerMorph.prototype.mouseDownLeft=function(){this.image=this.pressImage,this.changed()},TriggerMorph.prototype.mouseClickLeft=function(){this.image=this.highlightImage,this.changed(),this.trigger()},TriggerMorph.prototype.mouseDoubleClick=function(){this.triggerDoubleClick()},TriggerMorph.prototype.rootForGrab=function(){return this.isDraggable?TriggerMorph.uber.rootForGrab.call(this):null},TriggerMorph.prototype.bubbleHelp=function(t){var e=this.world(),i=this;this.schedule=new Animation(nop,nop,0,500,nop,(function(){i.popUpbubbleHelp(t)})),e.animations.push(this.schedule)},TriggerMorph.prototype.popUpbubbleHelp=function(t){new SpeechBubbleMorph(localize(t),null,null,1).popUp(this.world(),this.rightCenter().add(new Point(-8,0)))},MenuItemMorph.prototype=new TriggerMorph,MenuItemMorph.prototype.constructor=MenuItemMorph,MenuItemMorph.uber=TriggerMorph.prototype,MenuItemMorph.prototype.createLabel=function(){var t,e;this.label&&this.label.destroy(),this.label=this.createLabelPart(this.labelString),this.add(this.label),t=this.label.width(),e=this.label.height(),this.shortcut&&this.shortcut.destroy(),this.shortcutString&&(this.shortcut=this.createLabelPart(this.shortcutString),t+=this.shortcut.width()+4,e=Math.max(e,this.shortcut.height()),this.add(this.shortcut)),this.silentSetExtent(new Point(t+8,e)),this.fixLayout()},MenuItemMorph.prototype.fixLayout=function(){var t=this.center();this.label.setCenter(t),this.label.setLeft(this.left()+4),this.shortcut&&(this.shortcut.setCenter(t),this.shortcut.setRight(this.right()-4))},MenuItemMorph.prototype.createLabelPart=function(t){var e,i,o;return isString(t)?this.createLabelString(t):t instanceof Array?((e=new Morph).alpha=0,i=this.createIcon(t[0]),e.add(i),o=this.createLabelString(t[1]),e.add(o),o.setCenter(i.center()),o.setLeft(i.right()+4),e.bounds=i.bounds.merge(o.bounds),e.drawNew(),e):this.createIcon(t)},MenuItemMorph.prototype.createIcon=function(t){var e,i=new Morph;return i.image=t instanceof Morph?t.fullImage():t,t instanceof Morph&&t.getShadow()&&(e=i.image,i.image=newCanvas(t.fullBounds().extent().subtract(this.shadowBlur*(useBlurredShadows?1:2))),i.image.getContext(\"2d\").drawImage(e,0,0)),i.silentSetWidth(i.image.width),i.silentSetHeight(i.image.height),i},MenuItemMorph.prototype.createLabelString=function(t){var e=new TextMorph(t,this.fontSize,this.fontStyle,this.labelBold,this.labelItalic);return e.setColor(this.labelColor),e},MenuItemMorph.prototype.mouseEnter=function(){var t=this.parentThatIsA(MenuMorph);this.isShowingSubmenu()||(t&&t.closeSubmenu(),this.isListItem()||(this.image=this.highlightImage,this.changed()),this.action instanceof MenuMorph?this.delaySubmenu():this.hint&&this.bubbleHelp(this.hint))},MenuItemMorph.prototype.mouseLeave=function(){this.isListItem()||(this.isShowingSubmenu()?this.image=this.highlightImage:this.image=this.normalImage,this.changed()),this.schedule&&(this.schedule.isActive=!1),this.hint&&this.world().hand.destroyTemporaries()},MenuItemMorph.prototype.mouseDownLeft=function(t){this.isListItem()&&(this.parentThatIsA(MenuMorph).unselectAllItems(),this.escalateEvent(\"mouseDownLeft\",t)),this.image=this.pressImage,this.changed()},MenuItemMorph.prototype.mouseMove=function(){this.isListItem()&&this.escalateEvent(\"mouseMove\")},MenuItemMorph.prototype.mouseClickLeft=function(){this.action instanceof MenuMorph?this.popUpSubmenu():(this.isListItem()||(this.parentThatIsA(MenuMorph).closeRootMenu(),this.world().activeMenu=null),this.trigger())},MenuItemMorph.prototype.isListItem=function(){var t=this.parentThatIsA(MenuMorph);return!!t&&t.isListContents},MenuItemMorph.prototype.isSelectedListItem=function(){return!!this.isListItem()&&this.image===this.pressImage},MenuItemMorph.prototype.isShowingSubmenu=function(){var t=this.parentThatIsA(MenuMorph);return!!(t&&this.action instanceof MenuMorph)&&t.submenu===this.action},MenuItemMorph.prototype.delaySubmenu=function(){var t=this.world(),e=this;this.schedule=new Animation(nop,nop,0,500,nop,(function(){e.popUpSubmenu()})),t.animations.push(this.schedule)},MenuItemMorph.prototype.popUpSubmenu=function(){var t=this.parentThatIsA(MenuMorph);this.action instanceof MenuMorph&&(this.action.drawNew(),this.action.setPosition(this.topRight().subtract(new Point(0,5))),this.action.addShadow(new Point(2,2),80),this.action.keepWithin(this.world()),this.action.items.length<1&&!this.action.title||(t.add(this.action),t.submenu=this.action,t.submenu.world=t.world,this.action.fullChanged()))},FrameMorph.prototype=new Morph,FrameMorph.prototype.constructor=FrameMorph,FrameMorph.uber=Morph.prototype,FrameMorph.prototype.init=function(t){this.scrollFrame=t||null,FrameMorph.uber.init.call(this),this.color=new Color(255,250,245),this.drawNew(),this.acceptsDrops=!0,this.scrollFrame&&(this.isDraggable=!1,this.noticesTransparentClick=!1,this.alpha=0)},FrameMorph.prototype.fullBounds=function(){var t=this.getShadow();return null!==t?this.bounds.merge(t.bounds):this.bounds},FrameMorph.prototype.fullImage=function(){return this.image},FrameMorph.prototype.fullDrawOn=function(t,e){var i,o;return this.isVisible?(i=e||this.fullBounds(),(o=this.bounds.intersect(i)).extent().gt(new Point(0,0))?(this.drawOn(t,o),void this.children.forEach((function(e){e instanceof ShadowMorph?e.fullDrawOn(t,i):e.fullDrawOn(t,o)}))):null):null},FrameMorph.prototype.topMorphAt=function(t){var e,i;if(!this.isVisible||!this.bounds.containsPoint(t))return null;for(e=this.children.length-1;e>=0;e-=1)if(i=this.children[e].topMorphAt(t))return i;return this.noticesTransparentClick||!this.isTransparentAt(t)?this:null},FrameMorph.prototype.submorphBounds=function(){var t=null;return this.children.length>0&&(t=this.children[0].bounds,this.children.forEach((function(e){t=t.merge(e.fullBounds())}))),t},FrameMorph.prototype.keepInScrollFrame=function(){if(null===this.scrollFrame)return null;this.left()>this.scrollFrame.left()&&this.moveBy(new Point(this.scrollFrame.left()-this.left(),0)),this.right()<this.scrollFrame.right()&&this.moveBy(new Point(this.scrollFrame.right()-this.right(),0)),this.top()>this.scrollFrame.top()&&this.moveBy(new Point(0,this.scrollFrame.top()-this.top())),this.bottom()<this.scrollFrame.bottom()&&this.moveBy(0,new Point(this.scrollFrame.bottom()-this.bottom(),0))},FrameMorph.prototype.adjustBounds=function(){var t,e,i=this;if(null===this.scrollFrame)return null;e=(t=this.submorphBounds())&&!this.scrollFrame.isTextLineWrapping?t.expandBy(this.scrollFrame.padding).growBy(this.scrollFrame.growth).merge(this.scrollFrame.bounds):this.scrollFrame.bounds.copy(),this.bounds.eq(e)||(this.bounds=e,this.drawNew(),this.keepInScrollFrame()),this.scrollFrame.isTextLineWrapping&&this.children.forEach((function(t){t instanceof TextMorph&&(t.setWidth(i.width()),i.setHeight(Math.max(t.height(),i.scrollFrame.height())))})),this.scrollFrame.adjustScrollBars()},FrameMorph.prototype.reactToDropOf=function(){this.adjustBounds()},FrameMorph.prototype.reactToGrabOf=function(){this.adjustBounds()},FrameMorph.prototype.developersMenu=function(){var t=FrameMorph.uber.developersMenu.call(this);return this.children.length>0&&(t.addLine(),t.addItem(\"move all inside...\",\"keepAllSubmorphsWithin\",\"keep all submorphs\\nwithin and visible\")),t},FrameMorph.prototype.keepAllSubmorphsWithin=function(){var t=this;this.children.forEach((function(e){e.keepWithin(t)}))},ScrollFrameMorph.prototype=new FrameMorph,ScrollFrameMorph.prototype.constructor=ScrollFrameMorph,ScrollFrameMorph.uber=FrameMorph.prototype,ScrollFrameMorph.prototype.init=function(t,e,i){var o=this;ScrollFrameMorph.uber.init.call(this),this.scrollBarSize=e||MorphicPreferences.scrollBarSize,this.autoScrollTrigger=null,this.enableAutoScrolling=!0,this.isScrollingByDragging=!0,this.hasVelocity=!0,this.padding=0,this.growth=0,this.isTextLineWrapping=!1,this.contents=t||new FrameMorph(this),this.add(this.contents),this.hBar=new SliderMorph(null,null,null,null,\"horizontal\",i),this.hBar.setHeight(this.scrollBarSize),this.hBar.action=function(t){o.contents.setPosition(new Point(o.left()-t,o.contents.position().y))},this.hBar.isDraggable=!1,this.add(this.hBar),this.vBar=new SliderMorph(null,null,null,null,\"vertical\",i),this.vBar.setWidth(this.scrollBarSize),this.vBar.action=function(t){o.contents.setPosition(new Point(o.contents.position().x,o.top()-t))},this.vBar.isDraggable=!1,this.add(this.vBar),this.toolBar=null},ScrollFrameMorph.prototype.adjustScrollBars=function(){var t=this.width()-this.scrollBarSize,e=this.height()-this.scrollBarSize;this.changed(),this.contents.width()>this.width()?(this.hBar.show(),this.hBar.width()!==t&&this.hBar.setWidth(t),this.hBar.setPosition(new Point(this.left(),this.bottom()-this.hBar.height())),this.hBar.start=0,this.hBar.stop=this.contents.width()-this.width()+this.scrollBarSize,this.hBar.size=this.width()/this.contents.width()*this.hBar.stop,this.hBar.value=this.left()-this.contents.left(),this.hBar.drawNew()):this.hBar.hide(),this.contents.height()>this.height()?(this.vBar.show(),this.vBar.height()!==e&&this.vBar.setHeight(e),this.vBar.setPosition(new Point(this.right()-this.vBar.width(),this.top())),this.vBar.start=0,this.vBar.stop=this.contents.height()-this.height()+this.scrollBarSize,this.vBar.size=this.height()/this.contents.height()*this.vBar.stop,this.vBar.value=this.top()-this.contents.top(),this.vBar.drawNew()):this.vBar.hide(),this.adjustToolBar()},ScrollFrameMorph.prototype.adjustToolBar=function(){this.toolBar&&(this.toolBar.setTop(this.top()+3),this.toolBar.setRight((this.vBar.isVisible?this.vBar.left():this.right())-3))},ScrollFrameMorph.prototype.addContents=function(t){this.contents.add(t),this.contents.adjustBounds()},ScrollFrameMorph.prototype.setContents=function(t){this.contents.children.forEach((function(t){t.destroy()})),this.contents.children=[],t.setPosition(this.position().add(this.padding+2)),this.addContents(t)},ScrollFrameMorph.prototype.setExtent=function(t){this.isTextLineWrapping&&this.contents.setPosition(this.position().copy()),ScrollFrameMorph.uber.setExtent.call(this,t),this.contents.adjustBounds()},ScrollFrameMorph.prototype.scrollX=function(t){var e,i=this.contents.left(),o=this.left(),r=this.contents.width(),n=this.right();this.vBar.isVisible&&(n-=this.scrollBarSize),(e=i+t)+r<n&&(e=n-r),e>o&&(e=o),e!==i&&this.contents.setLeft(e)},ScrollFrameMorph.prototype.scrollY=function(t){var e,i=this.contents.top(),o=this.top(),r=this.contents.height(),n=this.bottom();this.hBar.isVisible&&(n-=this.scrollBarSize),(e=i+t)+r<n&&(e=n-r),e>o&&(e=o),e!==i&&this.contents.setTop(e)},ScrollFrameMorph.prototype.step=nop,ScrollFrameMorph.prototype.mouseDownLeft=function(t){if(!this.isScrollingByDragging)return null;var e=this.root().hand,i=t,o=this,r=0,n=0;this.step=function(){var t;if(e.mouseButton&&0===e.children.length&&o.bounds.containsPoint(e.bounds.origin)){if(e.grabPosition&&e.grabPosition.distanceTo(e.position())<=MorphicPreferences.grabThreshold)return null;t=e.bounds.origin,0!==(r=t.x-i.x)&&o.scrollX(r),0!==(n=t.y-i.y)&&o.scrollY(n),i=t}else o.hasVelocity?Math.abs(r)<.5&&Math.abs(n)<.5?o.step=function(){nop()}:(r*=.8,o.scrollX(Math.round(r)),n*=.8,o.scrollY(Math.round(n))):o.step=function(){nop()};this.adjustScrollBars()}},ScrollFrameMorph.prototype.startAutoScrolling=function(){var t,e,i,o=this,r=3*MorphicPreferences.scrollBarSize,n=this.world();if(!n)return null;t=n.hand,this.autoScrollTrigger||(this.autoScrollTrigger=Date.now()),this.step=function(){i=t.bounds.origin,e=o.bounds.insetBy(r),o.bounds.containsPoint(i)&&!e.containsPoint(i)&&t.children.length>0?o.autoScroll(i):(o.step=function(){nop()},o.autoScrollTrigger=null)}},ScrollFrameMorph.prototype.autoScroll=function(t){var e;if(Date.now()-this.autoScrollTrigger<500)return null;e=3*MorphicPreferences.scrollBarSize,this.topLeft().extent(new Point(this.width(),e)).containsPoint(t)&&this.scrollY(e-(t.y-this.top())),this.topLeft().extent(new Point(e,this.height())).containsPoint(t)&&this.scrollX(e-(t.x-this.left())),new Point(this.right()-e,this.top()).extent(new Point(e,this.height())).containsPoint(t)&&this.scrollX(-(e-(this.right()-t.x))),new Point(this.left(),this.bottom()-e).extent(new Point(this.width(),e)).containsPoint(t)&&this.scrollY(-(e-(this.bottom()-t.y))),this.adjustScrollBars()},ScrollFrameMorph.prototype.scrollCursorIntoView=function(t){var e=t.target,i=e.position().subtract(this.contents.position()),o=this.top()+this.padding,r=this.bottom()-this.padding;this.contents.setExtent(e.extent().add(i).add(this.padding)),t.top()<o?(this.contents.setTop(this.contents.top()+o-t.top()),t.setTop(o)):t.bottom()>r&&(this.contents.setBottom(this.contents.bottom()+r-t.bottom()),t.setBottom(r)),this.adjustScrollBars()},ScrollFrameMorph.prototype.mouseScroll=function(t,e){t&&this.scrollY(t*MorphicPreferences.mouseScrollAmount),e&&this.scrollX(e*MorphicPreferences.mouseScrollAmount),this.adjustScrollBars()},ScrollFrameMorph.prototype.updateReferences=function(t){var e=this;ScrollFrameMorph.uber.updateReferences.call(this,t),this.hBar&&(this.hBar.action=function(t){e.contents.setPosition(new Point(e.left()-t,e.contents.position().y))}),this.vBar&&(this.vBar.action=function(t){e.contents.setPosition(new Point(e.contents.position().x,e.top()-t))})},ScrollFrameMorph.prototype.developersMenu=function(){var t=ScrollFrameMorph.uber.developersMenu.call(this);return this.isTextLineWrapping?t.addItem(\"auto line wrap off...\",\"toggleTextLineWrapping\",\"turn automatic\\nline wrapping\\noff\"):t.addItem(\"auto line wrap on...\",\"toggleTextLineWrapping\",\"enable automatic\\nline wrapping\"),t},ScrollFrameMorph.prototype.toggleTextLineWrapping=function(){this.isTextLineWrapping=!this.isTextLineWrapping},ListMorph.prototype=new ScrollFrameMorph,ListMorph.prototype.constructor=ListMorph,ListMorph.uber=ScrollFrameMorph.prototype,ListMorph.prototype.init=function(t,e,i,o){ListMorph.uber.init.call(this),this.contents.acceptsDrops=!1,this.color=new Color(255,255,255),this.hBar.alpha=.6,this.vBar.alpha=.6,this.elements=t||[],this.labelGetter=e,this.format=i,this.listContents=null,this.selected=null,this.active=null,this.action=null,this.doubleClickAction=o||null,this.acceptsDrops=!1,this.buildListContents()},ListMorph.prototype.buildListContents=function(){var t=this;this.listContents&&this.listContents.destroy(),this.listContents=new MenuMorph(this.select,null,this),0===this.elements.length&&(this.elements=[\"(empty)\"]),this.elements.forEach((function(e){var i=null,o=!1,r=!1;t.format.forEach((function(t){t[1].call(null,e)&&(\"bold\"===t[0]?o=!0:\"italic\"===t[0]?r=!0:i=t[0])})),t.listContents.addItem(t.labelGetter(e),e,null,i,o,r,t.doubleClickAction)})),this.listContents.isListContents=!0,this.listContents.drawNew(),this.listContents.setPosition(this.contents.position()),this.addContents(this.listContents)},ListMorph.prototype.select=function(t,e){isNil(t)||(this.selected=t,this.active=e,this.action&&this.action.call(null,t))},ListMorph.prototype.setExtent=function(t){var e=this.listContents.bounds,i=this.bounds.origin.copy().corner(this.bounds.origin.add(t));i.right()>e.right()&&i.width()<=e.width()&&this.listContents.setRight(i.right()),i.bottom()>e.bottom()&&i.height()<=e.height()&&this.listContents.setBottom(i.bottom()),ListMorph.uber.setExtent.call(this,t)},ListMorph.prototype.activeIndex=function(){return this.listContents.children.indexOf(this.active)},ListMorph.prototype.activateIndex=function(t){var e=this.listContents.children[t];e&&(e.image=e.pressImage,e.changed(),e.trigger())},StringFieldMorph.prototype=new FrameMorph,StringFieldMorph.prototype.constructor=StringFieldMorph,StringFieldMorph.uber=FrameMorph.prototype,StringFieldMorph.prototype.init=function(t,e,i,o,r,n,s){this.defaultContents=t,this.minWidth=e,this.fontSize=i,this.fontStyle=o,this.isBold=r,this.isItalic=n,this.isNumeric=s||!1,this.text=null,StringFieldMorph.uber.init.call(this),this.color=new Color(255,255,255),this.isEditable=!0,this.acceptsDrops=!1,this.drawNew()},StringFieldMorph.prototype.drawNew=function(){var t;t=this.text?this.string():this.defaultContents,this.text=null,this.children.forEach((function(t){t.destroy()})),this.children=[],this.text=new StringMorph(t,this.fontSize,this.fontStyle,this.isBold,this.isItalic,this.isNumeric),this.text.isNumeric=this.isNumeric,this.text.setPosition(this.bounds.origin.copy()),this.text.isEditable=this.isEditable,this.text.isDraggable=!1,this.text.enableSelecting(),this.silentSetExtent(new Point(Math.max(this.width(),this.minWidth),this.text.height())),StringFieldMorph.uber.drawNew.call(this),this.add(this.text)},StringFieldMorph.prototype.string=function(){return this.text.text},StringFieldMorph.prototype.mouseClickLeft=function(t){this.isEditable?this.text.edit():this.escalateEvent(\"mouseClickLeft\",t)},BouncerMorph.prototype=new Morph,BouncerMorph.prototype.constructor=BouncerMorph,BouncerMorph.uber=Morph.prototype,BouncerMorph.prototype.init=function(t,e){BouncerMorph.uber.init.call(this),this.fps=50,this.isStopped=!1,this.type=t||\"vertical\",\"vertical\"===this.type?this.direction=\"down\":this.direction=\"right\",this.speed=e||1},BouncerMorph.prototype.moveUp=function(){this.moveBy(new Point(0,-this.speed))},BouncerMorph.prototype.moveDown=function(){this.moveBy(new Point(0,this.speed))},BouncerMorph.prototype.moveRight=function(){this.moveBy(new Point(this.speed,0))},BouncerMorph.prototype.moveLeft=function(){this.moveBy(new Point(-this.speed,0))},BouncerMorph.prototype.step=function(){this.isStopped||(\"vertical\"===this.type?(\"down\"===this.direction?this.moveDown():this.moveUp(),this.fullBounds().top()<this.parent.top()&&\"up\"===this.direction&&(this.direction=\"down\"),this.fullBounds().bottom()>this.parent.bottom()&&\"down\"===this.direction&&(this.direction=\"up\")):\"horizontal\"===this.type&&(\"right\"===this.direction?this.moveRight():this.moveLeft(),this.fullBounds().left()<this.parent.left()&&\"left\"===this.direction&&(this.direction=\"right\"),this.fullBounds().right()>this.parent.right()&&\"right\"===this.direction&&(this.direction=\"left\")))},HandMorph.prototype=new Morph,HandMorph.prototype.constructor=HandMorph,HandMorph.uber=Morph.prototype,HandMorph.prototype.init=function(t){HandMorph.uber.init.call(this,!0),this.bounds=new Rectangle,this.world=t,this.mouseButton=null,this.mouseOverList=[],this.morphToGrab=null,this.grabPosition=null,this.grabOrigin=null,this.temporaries=[],this.touchHoldTimeout=null,this.contextMenuEnabled=!1},HandMorph.prototype.changed=function(){var t;null!==this.world&&((t=this.fullBounds()).extent().eq(new Point)||this.world.broken.push(t.spread()))},HandMorph.prototype.fullChanged=HandMorph.prototype.changed,HandMorph.prototype.morphAtPointer=function(){return this.world.topMorphAt(this.bounds.origin)||this.world},HandMorph.prototype.allMorphsAtPointer=function(){var t=this.world.allChildren(),e=this;return t.filter((function(t){return t.isVisible&&t.visibleBounds().containsPoint(e.bounds.origin)}))},HandMorph.prototype.dropTargetFor=function(t){for(var e=this.morphAtPointer();!e.wantsDropOf(t);)e=e.parent;return e},HandMorph.prototype.grab=function(t){var e=t.parent;if(t instanceof WorldMorph)return null;0===this.children.length&&(this.world.stopEditing(),this.grabOrigin=t.situation(),t instanceof MenuMorph||t.addShadow(),t.prepareToBeGrabbed&&t.prepareToBeGrabbed(this),t.cachedFullImage=t.fullImageClassic(),t.cachedFullBounds=t.fullBounds(),this.add(t),this.changed(),e&&e.reactToGrabOf&&e.reactToGrabOf(t))},HandMorph.prototype.drop=function(){var t,e;0!==this.children.length&&(e=this.children[0],t=(t=this.dropTargetFor(e)).selectForEdit?t.selectForEdit():t,this.changed(),t.add(e),e.cachedFullImage=null,e.cachedFullBounds=null,e.changed(),e instanceof MenuMorph||e.removeShadow(),this.children=[],this.setExtent(new Point),e.justDropped&&e.justDropped(this),t.reactToDropOf&&t.reactToDropOf(e,this))},HandMorph.prototype.processMouseDown=function(t){var e,i;if(this.destroyTemporaries(),this.contextMenuEnabled=!0,this.morphToGrab=null,this.grabPosition=null,0!==this.children.length)this.drop(),this.mouseButton=null;else{for(e=this.morphAtPointer(),this.world.activeMenu&&(contains(e.allParents(),this.world.activeMenu)?clearInterval(this.touchHoldTimeout):this.world.activeMenu.destroy()),this.world.activeHandle&&e!==this.world.activeHandle&&this.world.activeHandle.destroy(),this.world.cursor&&e!==this.world.cursor.target&&this.world.stopEditing(),e.mouseMove||(this.morphToGrab=e.rootForGrab(),this.grabPosition=this.bounds.origin.copy()),2===t.button||t.ctrlKey?(this.mouseButton=\"right\",i=\"mouseDownRight\"):(this.mouseButton=\"left\",i=\"mouseDownLeft\");!e[i];)e=e.parent;e[i](this.bounds.origin)}},HandMorph.prototype.processTouchStart=function(t){var e=this;MorphicPreferences.isTouchDevice=!0,clearInterval(this.touchHoldTimeout),1===t.touches.length&&(this.touchHoldTimeout=setInterval((function(){e.processMouseDown({button:2}),e.processMouseUp({button:2}),t.preventDefault(),clearInterval(e.touchHoldTimeout)}),400),this.processMouseMove(t.touches[0]),this.processMouseDown({button:0}),t.preventDefault())},HandMorph.prototype.processTouchMove=function(t){if(MorphicPreferences.isTouchDevice=!0,1===t.touches.length){var e=t.touches[0];this.processMouseMove(e),clearInterval(this.touchHoldTimeout)}},HandMorph.prototype.processTouchEnd=function(t){MorphicPreferences.isTouchDevice=!0,clearInterval(this.touchHoldTimeout),nop(t),this.processMouseUp({button:0})},HandMorph.prototype.processMouseUp=function(){var t,e,i,o=this.morphAtPointer();if(this.destroyTemporaries(),0!==this.children.length)this.drop();else{if(\"left\"===this.mouseButton)i=\"mouseClickLeft\";else if(i=\"mouseClickRight\",this.mouseButton&&this.contextMenuEnabled){for(e=(t=o).contextMenu();!e&&t.parent;)e=(t=t.parent).contextMenu();e&&e.popUpAtHand(this.world)}for(;!o[i];)o=o.parent;o[i](this.bounds.origin)}this.mouseButton=null},HandMorph.prototype.processDoubleClick=function(){var t=this.morphAtPointer();if(this.destroyTemporaries(),0!==this.children.length)this.drop();else{for(;t&&!t.mouseDoubleClick;)t=t.parent;t&&t.mouseDoubleClick(this.bounds.origin)}this.mouseButton=null},HandMorph.prototype.processMouseMove=function(t){var e,i,o,r,n=getDocumentPositionOf(this.world.worldCanvas),s=this;e=new Point(t.pageX-n.x,t.pageY-n.y),this.setPosition(e),i=this.morphAtPointer().allParents(),!this.children.length&&this.mouseButton&&(o=(r=this.morphAtPointer()).rootForGrab(),r.mouseMove&&(r.mouseMove(e,this.mouseButton),\"right\"===this.mouseButton&&(this.contextMenuEnabled=!1)),\"left\"===this.mouseButton&&this.morphToGrab&&this.grabPosition.distanceTo(this.bounds.origin)>MorphicPreferences.grabThreshold&&(this.setPosition(this.grabPosition),this.morphToGrab.isDraggable?(o=this.morphToGrab.selectForEdit?this.morphToGrab.selectForEdit():this.morphToGrab,this.grab(o)):this.morphToGrab.isTemplate&&(this.world.stopEditing(),(o=this.morphToGrab.fullCopy()).isTemplate=!1,o.isDraggable=!0,o.reactToTemplateCopy&&o.reactToTemplateCopy(),this.grab(o),this.grabOrigin=this.morphToGrab.situation()),this.setPosition(e))),this.mouseOverList.forEach((function(t){contains(i,t)||(t.mouseLeave&&t.mouseLeave(),t.mouseLeaveDragging&&s.mouseButton&&t.mouseLeaveDragging())})),i.forEach((function(t){contains(s.mouseOverList,t)||(t.mouseEnter&&t.mouseEnter(),t.mouseEnterDragging&&s.mouseButton&&t.mouseEnterDragging()),s.children.length>0&&t instanceof ScrollFrameMorph&&t.enableAutoScrolling&&t.contents.allChildren().some((function(t){return t.wantsDropOf(s.children[0])}))&&(t.bounds.insetBy(3*MorphicPreferences.scrollBarSize).containsPoint(s.bounds.origin)||t.startAutoScrolling())})),this.mouseOverList=i},HandMorph.prototype.processMouseScroll=function(t){for(var e=this.morphAtPointer();e&&!e.mouseScroll;)e=e.parent;e&&e.mouseScroll(t.detail/-3||(Object.prototype.hasOwnProperty.call(t,\"wheelDeltaY\")?t.wheelDeltaY/120:t.wheelDelta/120),t.wheelDeltaX/120||0)},HandMorph.prototype.processDrop=function(t){var e,i,o,r,n,s=t instanceof FileList?t:t.target.files||t.dataTransfer.files,h=t.dataTransfer?t.dataTransfer.getData(\"URL\"):null,a=t.dataTransfer?t.dataTransfer.getData(\"Text/HTML\"):null,l=this.morphAtPointer(),p=new Image;function c(t){for(var e=new Image,i=new FileReader;!l.droppedSVG;)l=l.parent;e.onload=function(){l.droppedSVG(e,t.name)},(i=new FileReader).onloadend=function(t){e.src=t.target.result},i.readAsDataURL(t)}function u(t){for(var e=new Image,i=new FileReader;!l.droppedImage;)l=l.parent;e.onload=function(){(r=newCanvas(new Point(e.width,e.height),!0)).getContext(\"2d\").drawImage(e,0,0),l.droppedImage(r,t.name)},(i=new FileReader).onloadend=function(t){e.src=t.target.result},i.readAsDataURL(t)}function d(t){for(var e=new Audio,i=new FileReader;!l.droppedAudio;)l=l.parent;i.onloadend=function(i){e.src=i.target.result,l.droppedAudio(e,t.name)},i.readAsDataURL(t)}function g(t){for(var e=new FileReader;!l.droppedText;)l=l.parent;e.onloadend=function(e){l.droppedText(e.target.result,t.name,t.type)},e.readAsText(t)}function f(t){for(var e=new FileReader;!l.droppedBinary;)l=l.parent;e.onloadend=function(e){l.droppedBinary(e.target.result,t.name)},e.readAsArrayBuffer(t)}if(s.length>0)for(n=0;n<s.length;n+=1)i=(e=s[n]).name.slice(e.name.lastIndexOf(\".\")+1).toLowerCase(),-1===e.type.indexOf(\"svg\")||MorphicPreferences.rasterizeSVGs?0===e.type.indexOf(\"image\")?u(e):0===e.type.indexOf(\"audio\")||e.type.indexOf(\"ogg\")>-1?d(e):0===e.type.indexOf(\"text\")||contains([\"txt\",\"csv\",\"json\"],i)?g(e):f(e):c(e);else if(h){if(contains([\"gif\",\"png\",\"jpg\",\"jpeg\",\"bmp\"],i=h.slice(h.lastIndexOf(\".\")+1).toLowerCase())){for(;!l.droppedImage;)l=l.parent;(p=new Image).onload=function(){(r=newCanvas(new Point(p.width,p.height),!0)).getContext(\"2d\").drawImage(p,0,0),l.droppedImage(r)},p.src=h}else if(\"svg\"===i&&!MorphicPreferences.rasterizeSVGs){for(;!l.droppedSVG;)l=l.parent;!function(t,e){var i=new XMLHttpRequest;i.open(\"GET\",t),i.onreadystatechange=function(){if(4===i.readyState){if(!i.responseText)throw new Error(\"unable to retrieve \"+t);e(i.responseText)}},i.send()}(h,(function(t){var e=new Image;e.onload=function(){l.droppedSVG(e,h.slice(h.lastIndexOf(\"/\")+1,h.lastIndexOf(\".\")))},e.src=\"data:image/svg+xml;utf8,\"+encodeURIComponent(t)}))}}else if(a){for(;!l.droppedImage;)l=l.parent;(p=new Image).onload=function(){(r=newCanvas(new Point(p.width,p.height),!0)).getContext(\"2d\").drawImage(p,0,0),l.droppedImage(r)},(o=function(t){var e,i,o=\"\",r=t.indexOf('<img src=\"');if(-1===r)return null;for(e=r+=10;e<t.length;e+=1){if('\"'===(i=t[e]))return o;o=o.concat(i)}return null}(a))&&(p.src=o)}},HandMorph.prototype.destroyTemporaries=function(){var t=this;this.temporaries.forEach((function(e){e.isClickable&&e.bounds.containsPoint(t.position())||(e.destroy(),t.temporaries.splice(t.temporaries.indexOf(e),1))}))},WorldMorph.prototype=new FrameMorph,WorldMorph.prototype.constructor=WorldMorph,WorldMorph.uber=FrameMorph.prototype,WorldMorph.prototype.init=function(t,e){for(WorldMorph.uber.init.call(this),this.color=new Color(205,205,205),this.alpha=1,this.bounds=new Rectangle(0,0,t.width,t.height),this.drawNew(),this.isVisible=!0,this.isDraggable=!1,this.currentKey=null,this.worldCanvas=t,this.noticesTransparentClick=!0,this.stamp=Date.now();this.stamp===Date.now();)nop();this.stamp=Date.now(),this.useFillPage=e,void 0===this.useFillPage&&(this.useFillPage=!0),this.isDevMode=!1,this.broken=[],this.animations=[],this.hand=new HandMorph(this),this.keyboardReceiver=null,this.cursor=null,this.lastEditedText=null,this.activeMenu=null,this.activeHandle=null,this.virtualKeyboard=null,this.initEventListeners()},WorldMorph.prototype.brokenFor=function(t){var e=t.fullBounds();return this.broken.filter((function(t){return t.intersects(e)}))},WorldMorph.prototype.fullDrawOn=function(t,e){WorldMorph.uber.fullDrawOn.call(this,t,e),this.hand.fullDrawOn(t,e)},WorldMorph.prototype.updateBroken=function(){var t=this;this.condenseDamages(),this.broken.forEach((function(e){e.extent().gt(new Point(0,0))&&t.fullDrawOn(t.worldCanvas,e)})),this.broken=[]},WorldMorph.prototype.stepAnimations=function(){this.animations.forEach((function(t){t.step()})),this.animations=this.animations.filter((function(t){return t.isActive}))},WorldMorph.prototype.condenseDamages=function(){function t(t){var e,i=[];return t.forEach((function(t){(e=detect(i,(function(e){return e.isNearTo(t,20)})))?e.mergeWith(t):i.push(t)})),i}for(var e=!0,i=this.broken.length;e;)this.broken=t(this.broken),e=this.broken.length<i,i=this.broken.length},WorldMorph.prototype.doOneCycle=function(){this.stepFrame(),this.stepAnimations(),this.updateBroken()},WorldMorph.prototype.fillPage=function(){var t=window.innerHeight,e=window.innerWidth,i=this;this.worldCanvas.style.position=\"absolute\",this.worldCanvas.style.left=\"0px\",this.worldCanvas.style.right=\"0px\",this.worldCanvas.style.width=\"100%\",this.worldCanvas.style.height=\"100%\",document.documentElement.scrollTop&&(t=document.documentElement.clientHeight),document.documentElement.scrollLeft&&(e=document.documentElement.clientWidth),this.worldCanvas.width!==e&&(this.worldCanvas.width=e,this.setWidth(e)),this.worldCanvas.height!==t&&(this.worldCanvas.height=t,this.setHeight(t)),this.children.forEach((function(t){t.reactToWorldResize&&t.reactToWorldResize(i.bounds.copy())}))},WorldMorph.prototype.getGlobalPixelColor=function(t){return this.topMorphAt(t).getPixelColor(t)},WorldMorph.prototype.initVirtualKeyboard=function(){var t=this;this.virtualKeyboard&&(document.body.removeChild(this.virtualKeyboard),this.virtualKeyboard=null),MorphicPreferences.isTouchDevice&&MorphicPreferences.useVirtualKeyboard&&(this.virtualKeyboard=document.createElement(\"input\"),this.virtualKeyboard.type=\"text\",this.virtualKeyboard.style.color=\"transparent\",this.virtualKeyboard.style.backgroundColor=\"transparent\",this.virtualKeyboard.style.border=\"none\",this.virtualKeyboard.style.outline=\"none\",this.virtualKeyboard.style.position=\"absolute\",this.virtualKeyboard.style.top=\"0px\",this.virtualKeyboard.style.left=\"0px\",this.virtualKeyboard.style.width=\"0px\",this.virtualKeyboard.style.height=\"0px\",this.virtualKeyboard.autocapitalize=\"none\",document.body.appendChild(this.virtualKeyboard),this.virtualKeyboard.addEventListener(\"keydown\",(function(e){t.currentKey=e.keyCode,t.keyboardReceiver&&t.keyboardReceiver.processKeyDown(e),8===e.keyCode&&e.preventDefault(),9===e.keyCode&&(t.keyboardReceiver&&t.keyboardReceiver.processKeyPress(e),e.preventDefault())}),!1),this.virtualKeyboard.addEventListener(\"keyup\",(function(e){t.currentKey=null,t.keyboardReceiver&&t.keyboardReceiver.processKeyUp&&t.keyboardReceiver.processKeyUp(e),e.preventDefault()}),!1),this.virtualKeyboard.addEventListener(\"keypress\",(function(e){t.keyboardReceiver&&t.keyboardReceiver.processKeyPress(e),e.preventDefault()}),!1))},WorldMorph.prototype.initEventListeners=function(){var t=this.worldCanvas,e=this;e.useFillPage?e.fillPage():this.changed(),t.addEventListener(\"mousedown\",(function(i){i.preventDefault(),t.focus(),e.hand.processMouseDown(i)}),!1),t.addEventListener(\"touchstart\",(function(t){e.hand.processTouchStart(t)}),!1),t.addEventListener(\"mouseup\",(function(t){t.preventDefault(),e.hand.processMouseUp(t)}),!1),t.addEventListener(\"dblclick\",(function(t){t.preventDefault(),e.hand.processDoubleClick(t)}),!1),t.addEventListener(\"touchend\",(function(t){e.hand.processTouchEnd(t)}),!1),t.addEventListener(\"mousemove\",(function(t){e.hand.processMouseMove(t)}),!1),t.addEventListener(\"touchmove\",(function(t){e.hand.processTouchMove(t)}),!1),t.addEventListener(\"contextmenu\",(function(t){t.preventDefault()}),!1),t.addEventListener(\"keydown\",(function(t){e.currentKey=t.keyCode,e.keyboardReceiver&&e.keyboardReceiver.processKeyDown(t),8===t.keyCode&&t.preventDefault(),9===t.keyCode&&(e.keyboardReceiver&&e.keyboardReceiver.processKeyPress(t),t.preventDefault()),(t.ctrlKey&&!t.altKey||t.metaKey)&&86!==t.keyCode&&t.preventDefault()}),!1),t.addEventListener(\"keyup\",(function(t){e.currentKey=null,e.keyboardReceiver&&e.keyboardReceiver.processKeyUp&&e.keyboardReceiver.processKeyUp(t),t.preventDefault()}),!1),t.addEventListener(\"keypress\",(function(t){e.keyboardReceiver&&e.keyboardReceiver.processKeyPress(t),t.preventDefault()}),!1),t.addEventListener(\"mousewheel\",(function(t){e.hand.processMouseScroll(t),t.preventDefault()}),!1),t.addEventListener(\"DOMMouseScroll\",(function(t){e.hand.processMouseScroll(t),t.preventDefault()}),!1),document.body.addEventListener(\"paste\",(function(t){var i=t.clipboardData.getData(\"Text\");i&&e.cursor&&e.cursor.insert(i)}),!1),window.addEventListener(\"dragover\",(function(t){t.preventDefault()}),!1),window.addEventListener(\"drop\",(function(t){e.hand.processDrop(t),t.preventDefault()}),!1),window.addEventListener(\"resize\",(function(){e.useFillPage&&e.fillPage()}),!1),window.onbeforeunload=function(t){var e=t||window.event,i=\"Are you sure you want to leave?\";return e&&(e.returnValue=i),i}},WorldMorph.prototype.mouseDownLeft=nop,WorldMorph.prototype.mouseClickLeft=nop,WorldMorph.prototype.mouseDownRight=nop,WorldMorph.prototype.mouseClickRight=nop,WorldMorph.prototype.wantsDropOf=function(){return this.acceptsDrops},WorldMorph.prototype.droppedImage=function(){return null},WorldMorph.prototype.droppedSVG=function(){return null},WorldMorph.prototype.nextTab=function(t){var e=this.nextEntryField(t);e&&(t.clearSelection(),e.selectAll(),e.edit())},WorldMorph.prototype.previousTab=function(t){var e=this.previousEntryField(t);e&&(t.clearSelection(),e.selectAll(),e.edit())},WorldMorph.prototype.contextMenu=function(){var t;return t=this.isDevMode?new MenuMorph(this,this.constructor.name||this.constructor.toString().split(\" \")[1].split(\"(\")[0]):new MenuMorph(this,\"Morphic\"),this.isDevMode&&(t.addItem(\"demo...\",\"userCreateMorph\",\"sample morphs\"),t.addLine(),t.addItem(\"hide all...\",\"hideAll\"),t.addItem(\"show all...\",\"showAllHiddens\"),t.addItem(\"move all inside...\",\"keepAllSubmorphsWithin\",\"keep all submorphs\\nwithin and visible\"),t.addItem(\"inspect...\",\"inspect\",\"open a window on\\nall properties\"),t.addItem(\"screenshot...\",(function(){window.open(this.fullImageClassic().toDataURL())}),\"open a new window\\nwith a picture of this morph\"),t.addLine(),t.addItem(\"restore display\",\"changed\",\"redraw the\\nscreen once\"),t.addItem(\"fill page...\",\"fillPage\",\"let the World automatically\\nadjust to browser resizing\"),useBlurredShadows?t.addItem(\"sharp shadows...\",\"toggleBlurredShadows\",\"sharp drop shadows\\nuse for old browsers\"):t.addItem(\"blurred shadows...\",\"toggleBlurredShadows\",\"blurry shades,\\n use for new browsers\"),t.addItem(\"color...\",(function(){this.pickColor(t.title+localize(\"\\ncolor:\"),this.setColor,this,this.color)}),\"choose the World's\\nbackground color\"),MorphicPreferences===standardSettings?t.addItem(\"touch screen settings\",\"togglePreferences\",\"bigger menu fonts\\nand sliders\"):t.addItem(\"standard settings\",\"togglePreferences\",\"smaller menu fonts\\nand sliders\"),t.addLine()),this.isDevMode?t.addItem(\"user mode...\",\"toggleDevMode\",\"disable developers'\\ncontext menus\"):t.addItem(\"development mode...\",\"toggleDevMode\"),t.addItem(\"about morphic.js...\",\"about\"),t},WorldMorph.prototype.userCreateMorph=function(){function t(t){t.isDraggable=!0,t.pickUp(myself)}menu=new MenuMorph(this,\"make a morph\"),menu.addItem(\"rectangle\",(function(){t(new Morph)})),menu.addItem(\"box\",(function(){t(new BoxMorph)})),menu.addItem(\"circle box\",(function(){t(new CircleBoxMorph)})),menu.addLine(),menu.addItem(\"slider\",(function(){t(new SliderMorph)})),menu.addItem(\"dial\",(function(){newMorph=new DialMorph,newMorph.pickUp(this)})),menu.addItem(\"frame\",(function(){newMorph=new FrameMorph,newMorph.setExtent(new Point(350,250)),t(newMorph)})),menu.addItem(\"scroll frame\",(function(){newMorph=new ScrollFrameMorph,newMorph.contents.acceptsDrops=!0,newMorph.contents.adjustBounds(),newMorph.setExtent(new Point(350,250)),t(newMorph)})),menu.addItem(\"handle\",(function(){t(new HandleMorph)})),menu.addLine(),menu.addItem(\"string\",(function(){newMorph=new StringMorph(\"Hello, World!\"),newMorph.isEditable=!0,t(newMorph)})),menu.addItem(\"text\",(function(){newMorph=new TextMorph(\"Ich weiß nicht, was soll es bedeuten, dass ich so traurig bin, ein Märchen aus uralten Zeiten, das kommt mir nicht aus dem Sinn. Die Luft ist kühl und es dunkelt, und ruhig fließt der Rhein; der Gipfel des Berges funkelt im Abendsonnenschein. Die schönste Jungfrau sitzet dort oben wunderbar, ihr gold'nes Geschmeide blitzet, sie kämmt ihr goldenes Haar, sie kämmt es mit goldenem Kamme, und singt ein Lied dabei; das hat eine wundersame, gewalt'ge Melodei. Den Schiffer im kleinen Schiffe, ergreift es mit wildem Weh; er schaut nicht die Felsenriffe, er schaut nur hinauf in die Höh'. Ich glaube, die Wellen verschlingen am Ende Schiffer und Kahn, und das hat mit ihrem Singen, die Loreley getan.\"),newMorph.isEditable=!0,newMorph.maxWidth=300,newMorph.drawNew(),t(newMorph)})),menu.addItem(\"speech bubble\",(function(){newMorph=new SpeechBubbleMorph(\"Hello, World!\"),t(newMorph)})),menu.addLine(),menu.addItem(\"gray scale palette\",(function(){t(new GrayPaletteMorph)})),menu.addItem(\"color palette\",(function(){t(new ColorPaletteMorph)})),menu.addItem(\"color picker\",(function(){t(new ColorPickerMorph)})),menu.addLine(),menu.addItem(\"sensor demo\",(function(){newMorph=new MouseSensorMorph,newMorph.setColor(new Color(230,200,100)),newMorph.edge=35,newMorph.border=15,newMorph.borderColor=new Color(200,100,50),newMorph.alpha=.2,newMorph.setExtent(new Point(100,100)),t(newMorph)})),menu.addItem(\"animation demo\",(function(){var e,i,o,r,n;(e=new BouncerMorph).setPosition(new Point(50,20)),e.setExtent(new Point(300,200)),e.alpha=.9,e.speed=3,(i=new BouncerMorph).setColor(new Color(50,50,50)),i.setPosition(new Point(80,80)),i.setExtent(new Point(80,250)),i.type=\"horizontal\",i.direction=\"right\",i.alpha=.9,i.speed=5,(o=new BouncerMorph).setColor(new Color(20,20,20)),o.setPosition(new Point(90,140)),o.setExtent(new Point(40,30)),o.type=\"horizontal\",o.direction=\"right\",o.speed=3,(r=new BouncerMorph).setColor(new Color(200,20,20)),r.setPosition(new Point(90,140)),r.setExtent(new Point(20,20)),r.type=\"vertical\",r.direction=\"up\",r.speed=8,(n=new BouncerMorph).setColor(new Color(20,200,20)),n.setPosition(new Point(120,140)),n.setExtent(new Point(20,20)),n.type=\"vertical\",n.direction=\"down\",n.speed=4,i.add(r),i.add(o),e.add(n),e.add(i),t(e)})),menu.addItem(\"pen\",(function(){t(new PenMorph)})),myself.customMorphs&&(menu.addLine(),myself.customMorphs().forEach((function(e){menu.addItem(e.toString(),(function(){t(e)}))}))),menu.popUpAtHand(this)},WorldMorph.prototype.toggleDevMode=function(){this.isDevMode=!this.isDevMode},WorldMorph.prototype.hideAll=function(){this.children.forEach((function(t){t.hide()}))},WorldMorph.prototype.showAllHiddens=function(){this.forAllChildren((function(t){t.isVisible||t.show()}))},WorldMorph.prototype.about=function(){var t,e=\"\";for(t in modules)Object.prototype.hasOwnProperty.call(modules,t)&&(e+=\"\\n\"+t+\" (\"+modules[t]+\")\");\"\"!==e&&(e=\"\\n\\nmodules:\\n\\nmorphic (\"+morphicVersion+\")\"+e),this.inform(\"morphic.js\\n\\na lively Web GUI\\ninspired by Squeak\\n\"+morphicVersion+\"\\n\\nwritten by Jens Mönig\\njens@moenig.org\"+e)},WorldMorph.prototype.edit=function(t){if(this.lastEditedText!==t){isNil(this.lastEditedText)||this.stopEditing();var e=getDocumentPositionOf(this.worldCanvas);if(!t.isEditable)return null;this.cursor&&this.cursor.destroy(),this.cursor=new CursorMorph(t),t.parent.add(this.cursor),this.keyboardReceiver=this.cursor,this.initVirtualKeyboard(),MorphicPreferences.isTouchDevice&&MorphicPreferences.useVirtualKeyboard&&(this.virtualKeyboard.style.top=this.cursor.top()+e.y+\"px\",this.virtualKeyboard.style.left=this.cursor.left()+e.x+\"px\",this.virtualKeyboard.focus()),MorphicPreferences.useSliderForInput&&(t.parentThatIsA(MenuMorph)||this.slide(t)),this.lastEditedText!==t&&t.escalateEvent(\"freshTextEdit\",t),this.lastEditedText=t}},WorldMorph.prototype.slide=function(t){var e,i,o=parseFloat(t.text);isNaN(o)&&(o=0),e=new MenuMorph,(i=new SliderMorph(o-25,o+25,o,10,\"horizontal\")).alpha=1,i.color=new Color(225,225,225),i.button.color=e.borderColor,i.button.highlightColor=i.button.color.copy(),i.button.highlightColor.b+=100,i.button.pressColor=i.button.color.copy(),i.button.pressColor.b+=150,i.silentSetHeight(MorphicPreferences.scrollBarSize),i.silentSetWidth(10*MorphicPreferences.menuFontSize),i.drawNew(),i.action=function(e){t.changed(),t.text=Math.round(e).toString(),t.drawNew(),t.changed(),t.escalateEvent(\"reactToSliderEdit\",t)},e.items.push(i),e.popup(this,t.bottomLeft().add(new Point(0,5)))},WorldMorph.prototype.stopEditing=function(){this.cursor&&(this.cursor.target.escalateEvent(\"reactToEdit\",this.cursor.target),this.cursor.target.clearSelection(),this.cursor.destroy(),this.cursor=null),this.keyboardReceiver&&this.keyboardReceiver.stopEditing&&this.keyboardReceiver.stopEditing(),this.keyboardReceiver=null,this.virtualKeyboard&&(this.virtualKeyboard.blur(),document.body.removeChild(this.virtualKeyboard),this.virtualKeyboard=null),this.lastEditedText=null,this.worldCanvas.focus()},WorldMorph.prototype.toggleBlurredShadows=function(){useBlurredShadows=!useBlurredShadows},WorldMorph.prototype.togglePreferences=function(){MorphicPreferences=MorphicPreferences===standardSettings?touchScreenSettings:standardSettings}},function(t,e,i){\"use strict\";i.r(e);var o,r=i(0),n=(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.drawOn=function(t){},e}(r.c),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.processMouseUp=function(e){this.morphAtPointer()instanceof s||(t.prototype.processMouseUp.call(this,e),e.stopImmediatePropagation())},e.prototype.processMouseDown=function(e){this.morphAtPointer()instanceof s||(t.prototype.processMouseDown.call(this,e),e.stopImmediatePropagation())},e}(r.b),a=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}n(e,t),e.prototype.init=function(t,e){for(r.e.uber.init.call(this),this.color=new r.a(205,205,205),this.alpha=1,this.bounds=new r.d(0,0,t.width,t.height),this.drawNew(),this.isVisible=!0,this.isDraggable=!1,this.currentKey=null,this.worldCanvas=t,this.noticesTransparentClick=!0,this.stamp=Date.now();this.stamp===Date.now(););this.stamp=Date.now(),this.useFillPage=e,void 0===this.useFillPage&&(this.useFillPage=!0),this.isDevMode=!1,this.broken=[],this.animations=[],this.hand=new h(this),this.keyboardReceiver=null,this.cursor=null,this.lastEditedText=null,this.activeMenu=null,this.activeHandle=null,this.virtualKeyboard=null,this.initEventListeners(),this.addMorph(new s)}}(r.e),document.createElement(\"script\"));a.type=\"module\",a.src=chrome.extension.getURL(\"./content.js\"),document.head.appendChild(a)}]);","extractedComments":[]}